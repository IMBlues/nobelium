<!DOCTYPE html><html lang="zh-CN"><head><meta name="viewport" content="width=device-width"/><title>FileBeat 启动假死问题</title><meta name="robots" content="follow, index"/><meta charSet="UTF-8"/><meta name="keywords" content="Blog, Notion, Tech, Python, Django"/><meta name="description" content="日常工作记录"/><meta property="og:locale" content="zh-CN"/><meta property="og:title" content="FileBeat 启动假死问题"/><meta property="og:description" content="日常工作记录"/><meta property="og:url" content="https://next.emergencyexit.xyz/"/><meta property="og:image" content="https://og-image-craigary.vercel.app/FileBeat%20%E5%90%AF%E5%8A%A8%E5%81%87%E6%AD%BB%E9%97%AE%E9%A2%98.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:description" content="日常工作记录"/><meta name="twitter:title" content="FileBeat 启动假死问题"/><meta name="twitter:image" content="https://og-image-craigary.vercel.app/FileBeat%20%E5%90%AF%E5%8A%A8%E5%81%87%E6%AD%BB%E9%97%AE%E9%A2%98.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg"/><meta property="article:published_time"/><meta property="article:author" content="bluesyu"/><meta name="next-head-count" content="18"/><link rel="preload" href="/fonts/IBMPlexSansVar-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/fonts/IBMPlexSansVar-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="preload" as="style" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/><noscript><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/></noscript><link rel="icon" href="/favicon.svg" type="image/svg+xml"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="192x192" href="/apple-touch-icon.png"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/feed"/><meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)"/><meta name="theme-color" content="#18181B" media="(prefers-color-scheme: dark)"/><link rel="preload" href="/_next/static/css/8e8bd7c50b2739f5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e8bd7c50b2739f5.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6a5815369e10547f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6a5815369e10547f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-c0a56147c8fcef8f.js" defer=""></script><script src="/_next/static/chunks/main-e557dee8cfeafd6c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-7c8400856d0a7e46.js" defer=""></script><script src="/_next/static/chunks/b5f2ed29-08db60af0c3043ba.js" defer=""></script><script src="/_next/static/chunks/684-63c1a25e215d8bed.js" defer=""></script><script src="/_next/static/chunks/580-c0214944b9e37cce.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-5e131ae0621e9945.js" defer=""></script><script src="/_next/static/whNozGoNnKrTnthLemfFf/_buildManifest.js" defer=""></script><script src="/_next/static/whNozGoNnKrTnthLemfFf/_ssgManifest.js" defer=""></script><script src="/_next/static/whNozGoNnKrTnthLemfFf/_middlewareManifest.js" defer=""></script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"/></head><body class="bg-day dark:bg-night"><div id="__next" data-reactroot=""><div><div class="wrapper font-sans"><div class="observer-element h-4 md:h-12"></div><div class="sticky-nav m-auto w-full h-6 flex flex-row justify-between items-center mb-2 md:mb-12 py-8 bg-opacity-60 max-w-3xl px-4" id="sticky-nav"><div class="flex items-center"><a aria-label="布鲁斯鱼的妙想天开" href="/"><div class="h-6"><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="14" cy="14" r="14" class="fill-current text-black dark:text-white"></circle><circle cx="14" cy="14" r="14" fill="url(#paint0_radial)"></circle><circle cx="8" cy="8" r="2" fill="white"></circle><defs><radialGradient id="paint0_radial" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="rotate(45) scale(39.598)"><stop stop-color="#7FF72A" stop-opacity="1"></stop><stop offset="1" stop-color="#001FCC" stop-opacity="0.1"></stop></radialGradient></defs></svg></div></a><p class="ml-2 font-medium text-day dark:text-night header-name">FileBeat 启动假死问题</p></div><div class="flex-shrink-0"><ul class="flex flex-row"><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/about">关于</a></li><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/surfing">冲浪</a></li><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/search">搜索</a></li></ul></div></div><main class="m-auto flex-grow w-full transition-all max-w-3xl px-4"><article><h1 class="font-bold text-3xl text-black dark:text-white">🧟‍♂️<!-- --> <!-- -->FileBeat 启动假死问题</h1><nav class="flex mt-7 items-start text-gray-500 dark:text-gray-400"><div class="flex mb-4"><a href="https://twitter.com/bluesedenyu" class="flex"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2724%27%20height=%2724%27/%3e"/></span><img alt="bluesyu" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="bluesyu" srcSet="https://gravatar.com/avatar/d54f099771ff5f17709b76693f693e2e?imwidth=32 1x, https://gravatar.com/avatar/d54f099771ff5f17709b76693f693e2e?imwidth=48 2x" src="https://gravatar.com/avatar/d54f099771ff5f17709b76693f693e2e?imwidth=48" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full" loading="lazy"/></noscript></span><p class="ml-2 md:block">bluesyu</p></a><span class="block"> / </span></div><div class="mr-2 mb-4 md:ml-0">2021 年 6 月 1 日</div><div class="flex flex-nowrap max-w-full overflow-x-auto article-tags"><a href="/tag/best-practice"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">best-practice</p></a><a href="/tag/tech"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">tech</p></a><a href="/tag/ELK"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">ELK</p></a><a href="/tag/k8s"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">k8s</p></a></div></nav><div class="-mt-4"><main class="notion light-mode notion-page notion-block-ebd711554a5946a0bbb240687ddbcf9d"><div class="notion-viewport"></div><div class="notion-collection-row"><div class="notion-collection-row-body"><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M10.889 5.5H3.11v1.556h7.778V5.5zm1.555-4.444h-.777V0H10.11v1.056H3.89V0H2.333v1.056h-.777c-.864 0-1.548.7-1.548 1.555L0 12.5c0 .856.692 1.5 1.556 1.5h10.888C13.3 14 14 13.356 14 12.5V2.611c0-.855-.7-1.555-1.556-1.555zm0 11.444H1.556V3.944h10.888V12.5zM8.556 8.611H3.11v1.556h5.445V8.61z"></path></svg><div class="notion-collection-column-title-body">date</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-date">Jun 1, 2021</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">slug</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text">filebeat-hangs-problem.html</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">status</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"><div class="notion-property-select-item notion-item-red">Published</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M4 3a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zM2 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2z"></path></svg><div class="notion-collection-column-title-body">tags</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-multi_select"><div class="notion-property-multi_select-item notion-item-yellow">best-practice</div><div class="notion-property-multi_select-item notion-item-orange">tech</div><div class="notion-property-multi_select-item notion-item-purple">ELK</div><div class="notion-property-multi_select-item notion-item-brown">k8s</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">summary</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text">日常工作记录</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">type</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"><div class="notion-property-select-item notion-item-purple">Post</div></span></div></div></div></div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-03d2472b4ef54001b66bdd7229f1ddc0" data-id="03d2472b4ef54001b66bdd7229f1ddc0"><span><div id="03d2472b4ef54001b66bdd7229f1ddc0" class="notion-header-anchor"></div><a class="notion-hash-link" href="#03d2472b4ef54001b66bdd7229f1ddc0" title="问题"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">问题</span></span></h3><div class="notion-text notion-block-15022a9896b2424d9e70583f870933b6">上周因为 OOM 问题，某个集群内的 Filebeat 被迫重启后，观测了许久，仍不见事件流恢复，查看 Filebeat 输出日志，发现只有其自监控的日志：</div><pre class="notion-code language-plain text"><code class="language-plain text"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span>28T03<span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">41</span><span class="token punctuation">.</span>061Z	<span class="token constant">INFO</span>	<span class="token punctuation">[</span>monitoring<span class="token punctuation">]</span>	log<span class="token operator">/</span>log<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">145</span>	Non<span class="token operator">-</span>zero metrics <span class="token keyword">in</span> the last 30s	<span class="token punctuation">{</span><span class="token string-property property">"monitoring"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">"metrics"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">"beat"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"cpu"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"system"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"ticks"</span><span class="token operator">:</span><span class="token number">6249680</span><span class="token punctuation">,</span><span class="token string-property property">"time"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"ms"</span><span class="token operator">:</span><span class="token number">3024</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"total"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"ticks"</span><span class="token operator">:</span><span class="token number">13659880</span><span class="token punctuation">,</span><span class="token string-property property">"time"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"ms"</span><span class="token operator">:</span><span class="token number">6612</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"value"</span><span class="token operator">:</span><span class="token number">13659880</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"user"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"ticks"</span><span class="token operator">:</span><span class="token number">7410200</span><span class="token punctuation">,</span><span class="token string-property property">"time"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"ms"</span><span class="token operator">:</span><span class="token number">3588</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"handles"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"limit"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"hard"</span><span class="token operator">:</span><span class="token number">1048576</span><span class="token punctuation">,</span><span class="token string-property property">"soft"</span><span class="token operator">:</span><span class="token number">1048576</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"open"</span><span class="token operator">:</span><span class="token number">46</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"info"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"ephemeral_id"</span><span class="token operator">:</span><span class="token string">"ca641ad8-e10a-496f-a087-6924e456aaea"</span><span class="token punctuation">,</span><span class="token string-property property">"uptime"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"ms"</span><span class="token operator">:</span><span class="token number">60180037</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"memstats"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"gc_next"</span><span class="token operator">:</span><span class="token number">42518272</span><span class="token punctuation">,</span><span class="token string-property property">"memory_alloc"</span><span class="token operator">:</span><span class="token number">31026880</span><span class="token punctuation">,</span><span class="token string-property property">"memory_total"</span><span class="token operator">:</span><span class="token number">1715304668248</span><span class="token punctuation">,</span><span class="token string-property property">"rss"</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1552384</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"runtime"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"goroutines"</span><span class="token operator">:</span><span class="token number">206</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"filebeat"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"events"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"added"</span><span class="token operator">:</span><span class="token number">139</span><span class="token punctuation">,</span><span class="token string-property property">"done"</span><span class="token operator">:</span><span class="token number">139</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"harvester"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"open_files"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string-property property">"running"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"libbeat"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"config"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"module"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"running"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"pipeline"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"clients"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string-property property">"events"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"active"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string-property property">"filtered"</span><span class="token operator">:</span><span class="token number">139</span><span class="token punctuation">,</span><span class="token string-property property">"total"</span><span class="token operator">:</span><span class="token number">139</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"registrar"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"states"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"current"</span><span class="token operator">:</span><span class="token number">55084</span><span class="token punctuation">,</span><span class="token string-property property">"update"</span><span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"writes"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"success"</span><span class="token operator">:</span><span class="token number">139</span><span class="token punctuation">,</span><span class="token string-property property">"total"</span><span class="token operator">:</span><span class="token number">139</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">"system"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"load"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"1"</span><span class="token operator">:</span><span class="token number">9.21</span><span class="token punctuation">,</span><span class="token string-property property">"15"</span><span class="token operator">:</span><span class="token number">10.97</span><span class="token punctuation">,</span><span class="token string-property property">"5"</span><span class="token operator">:</span><span class="token number">10.87</span><span class="token punctuation">,</span><span class="token string-property property">"norm"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"1"</span><span class="token operator">:</span><span class="token number">0.3838</span><span class="token punctuation">,</span><span class="token string-property property">"15"</span><span class="token operator">:</span><span class="token number">0.4571</span><span class="token punctuation">,</span><span class="token string-property property">"5"</span><span class="token operator">:</span><span class="token number">0.4529</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><div class="notion-text notion-block-726a644628ee43298887d490282d3142">从 <code class="notion-inline-code">&quot;harvester&quot;:{&quot;open_files&quot;:0,&quot;running&quot;:0}}</code> 我们可以判断出  <code class="notion-inline-code">harvester</code> 尚未启动采集，这让我非常疑惑，Filebeat 究竟在做什么？</div><div class="notion-text notion-block-d18194d61a624342a6afa3cf3855dda0">接着观察日志，发现除开自监控，最后输出一条日志的内容是：</div><pre class="notion-code language-plain text"><code class="language-plain text"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span>28T02<span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">39</span><span class="token punctuation">.</span>019Z	<span class="token constant">INFO</span>	beater<span class="token operator">/</span>crawler<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">73</span>	Loading Inputs<span class="token operator">:</span> <span class="token number">1</span></code></pre><div class="notion-text notion-block-d47fa924df4b4254995237de5d8fa0c6"><code class="notion-inline-code">Loading Inputs</code> 看起来也是符合逻辑的，短时间没有太多的头绪，放下忙其他工作了。</div><div class="notion-text notion-block-bd4bcb3a63974ae2a5e433bc268bc7ae">随着时间推移，当我再次观测 Filebeat 时，发现它已经在正常工作了，但是日志内依旧没有错误输出，找到恢复时间点的最早日志：</div><pre class="notion-code language-plain text"><code class="language-plain text"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span>28T05<span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">17</span><span class="token punctuation">.</span>822Z	<span class="token constant">INFO</span>	log<span class="token operator">/</span>input<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">152</span>	Configured paths<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">/</span>data<span class="token operator">/</span>logs<span class="token comment">/*/*.log* /data/v3logs/*/</span><span class="token operator">*</span><span class="token comment">/*.log*]
2021-05-28T05:55:17.822Z	INFO	input/input.go:114	Starting input of type: log; ID: 3062577341473220485
2021-05-28T05:55:17.822Z	INFO	beater/crawler.go:105	Loading and starting Inputs completed. Enabled inputs: 1</span></code></pre><div class="notion-text notion-block-14164461d36b44dab01c7ddabf249b1c">好家伙，从 <code class="notion-inline-code">Loading Inputs</code> → <code class="notion-inline-code">Loading and starting Inputs completed</code> 花费了3个多小时，这更让我疑惑了，Filebeat 究竟为什么一直装死？</div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-c8af4e47327d467cb1afc6d0b3c85c75" data-id="c8af4e47327d467cb1afc6d0b3c85c75"><span><div id="c8af4e47327d467cb1afc6d0b3c85c75" class="notion-header-anchor"></div><a class="notion-hash-link" href="#c8af4e47327d467cb1afc6d0b3c85c75" title="原因"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">原因</span></span></h3><div class="notion-text notion-block-91f1c3ec86e646bd8de43288cad6c36e">根据日志打印翻阅了 Filebeat 源码</div><a style="width:100%" href="https://github.com/elastic/beats/blob/23e4403ae093fcc8f7905345cad2c7ad256976d8/filebeat/beater/crawler.go#L71" target="blank_"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-528e7c59ad7b425da0b50d7e0cb42543"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Ffile.notion.so%2Ff%2Fs%2Fc55eecdf-b786-4a27-8d0a-af5a9f355d59%2FUntitled.png%3Fid%3D528e7c59-ad7b-425d-a0b5-0d7e0cb42543%26table%3Dblock%26spaceId%3Db0a64676-90b9-4734-9c63-2d704ee573b6%26expirationTimestamp%3D1686129269810%26signature%3DLoeLzua3EOfuihEcxRkpsI6-g9-3u7I1r0ySbCW2k10?table=block&amp;id=528e7c59-ad7b-425d-a0b5-0d7e0cb42543&amp;cache=v2" loading="lazy" alt="https://github.com/elastic/beats/blob/23e4403ae093fcc8f7905345cad2c7ad256976d8/filebeat/beater/crawler.go#L71" decoding="async"/></div></figure></a><a style="width:100%" href="https://github.com/elastic/beats/blob/2ee21d95aef89af7f7e7aef8d07f679a24d690b4/filebeat/registrar/registrar.go#L172" target="blank_"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-33e420b7be024b7b83d89f71d509cc1f"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Ffile.notion.so%2Ff%2Fs%2Fff54b1b7-4b7d-4054-9a17-0e073d4820bb%2FUntitled.png%3Fid%3D33e420b7-be02-4b7b-83d8-9f71d509cc1f%26table%3Dblock%26spaceId%3Db0a64676-90b9-4734-9c63-2d704ee573b6%26expirationTimestamp%3D1686129269810%26signature%3D8fetlCpK0bgMYyGWUgrknEeJRTHxg7lPzHdAXojYj28?table=block&amp;id=33e420b7-be02-4b7b-83d8-9f71d509cc1f&amp;cache=v2" loading="lazy" alt="https://github.com/elastic/beats/blob/2ee21d95aef89af7f7e7aef8d07f679a24d690b4/filebeat/registrar/registrar.go#L172" decoding="async"/></div></figure></a><div class="notion-text notion-block-c57520ac2c5348019c8ebe47c7f5448b">Filebeat 使用 <code class="notion-inline-code">registry file</code> 作为采集的状态存储，实际上就是一个纯文本的 JSON 文件。每次启动时都会检查 JSON 文件中的 <code class="notion-inline-code">states</code> 是否需要更新（新增或者删除文件），而当任何一个 <code class="notion-inline-code">state</code> 需要更新， <code class="notion-inline-code">registry file</code> 将会全量序列化(读) → 持久化(写)，随着 <code class="notion-inline-code">states</code> 越来越多，JSON 文件会越来越大（接近20MB），每次全量读写都会越来越慢，并且 CPU、内存的使用量都会暴涨。</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-d50702a4ca424507b96e4bbbebdecdd8"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Ffile.notion.so%2Ff%2Fs%2Fb20f6619-c30b-4392-85ae-fd16c4ca5296%2FUntitled.png%3Fid%3Dd50702a4-ca42-4507-b96e-4bbbebdecdd8%26table%3Dblock%26spaceId%3Db0a64676-90b9-4734-9c63-2d704ee573b6%26expirationTimestamp%3D1686129269810%26signature%3DDSndmHhRAHwfomZtQCfdPIZYldK7uB8X0d4UubPixUg?table=block&amp;id=d50702a4-ca42-4507-b96e-4bbbebdecdd8&amp;cache=v2" loading="lazy" alt="notion image" decoding="async"/></div></figure><div class="notion-blank notion-block-79a574b49ed348e8ad118c78803f95f8"> </div><div class="notion-blank notion-block-3cf9cda1891f43838ee230892a2230e3"> </div><div class="notion-text notion-block-a533684c7abc4f51b4c0ce0df44d1eb6">总的来说，在当前的数据存储选型下，Filebeat 无法应对过多的文件数据数量，启动时的数据核验时间过长（几小时→几天不等，视数据量而定），就会产生了“假死”的现象。</div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-f13c3053ee0f4f569f934e20fb36912c" data-id="f13c3053ee0f4f569f934e20fb36912c"><span><div id="f13c3053ee0f4f569f934e20fb36912c" class="notion-header-anchor"></div><a class="notion-hash-link" href="#f13c3053ee0f4f569f934e20fb36912c" title="解决方案"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">解决方案</span></span></h3><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-8dcb354845b24fd992ec1426009155ea" data-id="8dcb354845b24fd992ec1426009155ea"><span><div id="8dcb354845b24fd992ec1426009155ea" class="notion-header-anchor"></div><a class="notion-hash-link" href="#8dcb354845b24fd992ec1426009155ea" title="临时的解决方案"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">临时的解决方案</span></span></h4><div class="notion-text notion-block-ab4203e1570242bd84c6c682aea249ac">暂停 Filebeat 进程，删除 <code class="notion-inline-code">registry file</code> ，重启 Filebeat 进程。这时候由于 JSON 文件是比较小的，所有 <code class="notion-inline-code">state</code> 均处于增量状态，数据同步是比较快的。但是所有已经发送过的事件将难以<b>避免地重复发送一次，</b>所以这种做法只能应急，不能长久处理。</div><div class="notion-blank notion-block-7b92e6297bc74f1c8a60df90b33f3bbf"> </div><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-0e800b7170d84241b08e10bc1a58b6b7" data-id="0e800b7170d84241b08e10bc1a58b6b7"><span><div id="0e800b7170d84241b08e10bc1a58b6b7" class="notion-header-anchor"></div><a class="notion-hash-link" href="#0e800b7170d84241b08e10bc1a58b6b7" title="长久的权宜之计"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">长久的权宜之计</span></span></h4><div class="notion-text notion-block-159dd38c73b647b18a6cc197da0c711e">Filebeat 的纯文本的 JSON 存储选型天生就是存在问题的，社区内也曾做过一些<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://github.com/elastic/beats/pull/12908">小改进的尝试</a>，最终并没有被合并到柱分枝。所以 Filebeat 无法应用过多的日志文件，这是一个短期内无法改变的事实。</div><div class="notion-blank notion-block-e96af924c17540919600f1b51f9107e4"> </div><div class="notion-text notion-block-cca6280a169149858cb1483d569b055f">而在当前选择的<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://emergencyexit.xyz/elk-back-pressure-study.html">依赖背压的采集方案</a> 中，我们并不倾向将日志文件留在采集管道中，而是将日志留在原处——机器的磁盘上，然后尽量保证管道的通畅，将日志实时采集到 ES 中。</div><div class="notion-text notion-block-b042a145ffa9487eaa0dc623550ba8ed">这样做的好处，就是避免因为过多的管道传输导致日志丢失（例如 Redis 写满后崩溃）。</div><div class="notion-text notion-block-8b91fed4dd3740a9be5357eb07bee16e">同时也会引入另一个问题：如果采集链路阻塞，同时过多的日志（采集条目每日2亿+）大于机器的磁盘承载能力时，日志丢失的风险依旧存在。</div><div class="notion-text notion-block-c3ac9538006e4d30826a4fb2723d206b">所以我们需要定期清理过期的日志，但问题也没那么简单：</div><ul class="notion-list notion-list-disc notion-block-2c9f5dd17ae6486c95d00250d4508427"><li>直接删除日志文件  → 写日志的<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://stackoverflow.com/a/2031100/6122939">应用进程无法感知，将向无效文件句柄写日志</a> → 导致日志丢失</li></ul><ul class="notion-list notion-list-disc notion-block-924da4c093344a959f552b60adb83120"><li>清空文件日志内容( <code class="notion-inline-code">echo &#x27;&#x27; &gt; {}</code>) → 导致文件数量不会减少</li></ul><ul class="notion-list notion-list-disc notion-block-910c8a100ee441d8bd769b3dca9e1ca7"><li>如果因为硬盘容量限制，删除日志的周期小于<em>产品许诺的日志保存时长</em>，当链路出现堵塞又未能及时处理 → 导致日志丢失</li></ul><div class="notion-blank notion-block-2257bf302f084bdcba330fc49020e1be"> </div><div class="notion-text notion-block-899e1e0a06d649009552d38f3e8180f4">所以我写了一个 <a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://gist.github.com/IMBlues/2803c02420d01309d33f9d26ee501223">删除脚本</a>，在保证清理过期日志的同时，会判断日志文件的句柄使用情况，跳过那些仍在被写入的文件，保证日志不丢失。</div><pre class="notion-code language-python"><code class="language-python"># <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span> coding<span class="token operator">:</span> utf<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span>
<span class="token keyword">import</span> datetime
<span class="token keyword">import</span> getopt
<span class="token keyword">import</span> glob
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> subprocess
<span class="token keyword">import</span> sys
from collections <span class="token keyword">import</span> namedtuple
from pathlib <span class="token keyword">import</span> Path
from typing <span class="token keyword">import</span> Generator<span class="token punctuation">,</span> Dict

logging<span class="token punctuation">.</span><span class="token function">basicConfig</span><span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span>


Process <span class="token operator">=</span> <span class="token function">namedtuple</span><span class="token punctuation">(</span><span class="token string">"Process"</span><span class="token punctuation">,</span> <span class="token string">"command,pid,user"</span><span class="token punctuation">)</span>


def <span class="token function">get_processes_open</span><span class="token punctuation">(</span>file_regex<span class="token operator">:</span> str<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span>str<span class="token punctuation">,</span> Process<span class="token punctuation">]</span><span class="token operator">:</span>
    <span class="token string">""</span><span class="token string">"Find processes with open handles for the specified file(s)."</span><span class="token string">""</span>

    open_file_process_map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">try</span><span class="token operator">:</span>
        # maybe not safe
        output <span class="token operator">=</span> subprocess<span class="token punctuation">.</span><span class="token function">getoutput</span><span class="token punctuation">(</span>f<span class="token string">"echo {file_regex} | xargs lsof"</span><span class="token punctuation">)</span>
    except Exception<span class="token operator">:</span>
        logging<span class="token punctuation">.</span><span class="token function">exception</span><span class="token punctuation">(</span><span class="token string">"exec error"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> open_file_process_map

    lines <span class="token operator">=</span> output<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token literal-property property">lines</span><span class="token operator">:</span>
        parts <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x<span class="token punctuation">]</span>
        open_file_process_map<span class="token punctuation">[</span>parts<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Process</span><span class="token punctuation">(</span><span class="token operator">*</span>parts<span class="token punctuation">[</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> open_file_process_map


def <span class="token function">try_to_delete_files</span><span class="token punctuation">(</span>file_regex<span class="token operator">:</span> str<span class="token punctuation">,</span> <span class="token literal-property property">minutes</span><span class="token operator">:</span> int<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token string">""</span><span class="token string">"Try to delete files"</span><span class="token string">""</span>
    skipped_count <span class="token operator">=</span> deleted_count <span class="token operator">=</span> <span class="token number">0</span>

    def <span class="token function">filter_files_by_expire_minutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Generator<span class="token punctuation">[</span>Path<span class="token punctuation">,</span> None<span class="token punctuation">,</span> None<span class="token punctuation">]</span><span class="token operator">:</span>
        <span class="token string">""</span><span class="token string">"Get all expired files"</span><span class="token string">""</span>
        now <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> name <span class="token keyword">in</span> glob<span class="token punctuation">.</span><span class="token function">glob</span><span class="token punctuation">(</span>file_regex<span class="token punctuation">,</span> recursive<span class="token operator">=</span>True<span class="token punctuation">)</span><span class="token operator">:</span>
            file_obj <span class="token operator">=</span> <span class="token function">Path</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
            updated <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span><span class="token function">fromtimestamp</span><span class="token punctuation">(</span>file_obj<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>st_mtime<span class="token punctuation">)</span>
            <span class="token keyword">if</span> updated <span class="token operator">&lt;</span> now <span class="token operator">-</span> datetime<span class="token punctuation">.</span><span class="token function">timedelta</span><span class="token punctuation">(</span>minutes<span class="token operator">=</span>minutes<span class="token punctuation">)</span><span class="token operator">:</span>
                <span class="token keyword">yield</span> file_obj

    open_file_process_map <span class="token operator">=</span> <span class="token function">get_processes_open</span><span class="token punctuation">(</span>file_regex<span class="token punctuation">)</span>
    <span class="token keyword">for</span> f <span class="token keyword">in</span> <span class="token function">filter_files_by_expire_minutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token function">str</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> not <span class="token keyword">in</span> <span class="token literal-property property">open_file_process_map</span><span class="token operator">:</span>
            logging<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>f<span class="token string">"deleting {f}"</span><span class="token punctuation">)</span>
            <span class="token keyword">try</span><span class="token operator">:</span>
                f<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                deleted_count <span class="token operator">+=</span> <span class="token number">1</span>
            except Exception <span class="token keyword">as</span> <span class="token literal-property property">e</span><span class="token operator">:</span>
                skipped_count <span class="token operator">+=</span> <span class="token number">1</span>
                logging<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">"failed to delete file: %s, for: %s"</span><span class="token punctuation">,</span> <span class="token function">str</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
                <span class="token keyword">continue</span>
        <span class="token keyword">else</span><span class="token operator">:</span>
            skipped_count <span class="token operator">+=</span> <span class="token number">1</span>
            logging<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>f<span class="token string">"skipping {f}, for process: {open_file_process_map[str(f)]}"</span><span class="token punctuation">)</span>

    <span class="token function">print</span><span class="token punctuation">(</span>f<span class="token string">"Skipped: {skipped_count}, deleted: {deleted_count}"</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token operator">:</span>
    <span class="token keyword">try</span><span class="token operator">:</span>
        opts<span class="token punctuation">,</span> args <span class="token operator">=</span> getopt<span class="token punctuation">.</span><span class="token function">getopt</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"hf:m:"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"files="</span><span class="token punctuation">,</span> <span class="token string">"minutes="</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    except getopt<span class="token punctuation">.</span>GetoptError<span class="token operator">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Example: python delete_files.py -f /data/*/*.log* -m 1440"</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

    arg_files <span class="token operator">=</span> <span class="token string">""</span>
    arg_minutes <span class="token operator">=</span> <span class="token number">1440</span>
    <span class="token keyword">for</span> opt<span class="token punctuation">,</span> arg <span class="token keyword">in</span> <span class="token literal-property property">opts</span><span class="token operator">:</span>
        <span class="token keyword">if</span> opt <span class="token operator">==</span> <span class="token string">"-h"</span><span class="token operator">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Usage: python delete_files.py -f /data/*/*.log* -m 1440"</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        elif opt <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">"-f"</span><span class="token punctuation">,</span> <span class="token string">"--files"</span><span class="token punctuation">)</span><span class="token operator">:</span>
            arg_files <span class="token operator">=</span> arg
        elif opt <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">"-m"</span><span class="token punctuation">,</span> <span class="token string">"--minutes"</span><span class="token punctuation">)</span><span class="token operator">:</span>
            arg_minutes <span class="token operator">=</span> <span class="token function">int</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>

    started <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>f<span class="token string">"Started: {started}\n>>>>>>>>>>>>"</span><span class="token punctuation">)</span>
    <span class="token function">try_to_delete_files</span><span class="token punctuation">(</span>arg_files<span class="token punctuation">,</span> arg_minutes<span class="token punctuation">)</span>
    finished <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>
        f<span class="token string">">>>>>>>>>>>>\nFinished: {finished}, total cost: {(finished - started).total_seconds()} seconds \n"</span>
    <span class="token punctuation">)</span></code></pre><figcaption class="notion-asset-caption">delete_files.py</figcaption><div class="notion-text notion-block-8a68e38071d3449e8fb328657f546363">当然你也可以根据需求用 Bash 实现，这里就不展开了。<em><s>（其实就是我不会 Bash）</s></em></div><div class="notion-blank notion-block-b2e7b975dcf3474a8ffd0729669c155c"> </div><div class="notion-text notion-block-bf4d2695b5ab40b299f68564a33a5244">然后我们需要将它跑在集群中的每一个节点上，定期执行清理工作：</div><div class="notion-text notion-block-2a4a9228b5f94d3f9b4fd736f1090b42">首先定义镜像</div><pre class="notion-code language-docker"><code class="language-docker"><span class="token constant">FROM</span> <span class="token literal-property property">python</span><span class="token operator">:</span><span class="token number">3</span>
<span class="token constant">RUN</span> apt<span class="token operator">-</span><span class="token keyword">get</span> update <span class="token operator">&amp;&amp;</span> apt<span class="token operator">-</span><span class="token keyword">get</span> install <span class="token operator">-</span>y lsof
<span class="token constant">ADD</span> delete_files<span class="token punctuation">.</span>py <span class="token operator">/</span>
<span class="token constant">CMD</span> <span class="token punctuation">[</span> <span class="token string">"python"</span><span class="token punctuation">,</span> <span class="token string">"./delete_files.py"</span><span class="token punctuation">,</span> <span class="token string">"-f"</span><span class="token punctuation">,</span> <span class="token string">"./*.no"</span><span class="token punctuation">,</span> <span class="token string">"-m"</span><span class="token punctuation">,</span> <span class="token string">"1440"</span> <span class="token punctuation">]</span></code></pre><div class="notion-blank notion-block-52a3eb5b750b4f2ca178277a18ece916"> </div><div class="notion-text notion-block-840ef338ca454fe5bc0cfcfdfb159f66">Kubernetes DaemonSet 定义，在每一个节点上都尝试清理日志：</div><pre class="notion-code language-yaml"><code class="language-yaml"><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> apps<span class="token operator">/</span>v1
<span class="token literal-property property">kind</span><span class="token operator">:</span> DaemonSet
<span class="token literal-property property">metadata</span><span class="token operator">:</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> log<span class="token operator">-</span>cleaner
  <span class="token literal-property property">namespace</span><span class="token operator">:</span> kube<span class="token operator">-</span>system
  <span class="token literal-property property">labels</span><span class="token operator">:</span>
    k8s<span class="token operator">-</span>app<span class="token operator">:</span> log<span class="token operator">-</span>cleaner
<span class="token literal-property property">spec</span><span class="token operator">:</span>
  <span class="token literal-property property">selector</span><span class="token operator">:</span>
    <span class="token literal-property property">matchLabels</span><span class="token operator">:</span>
      k8s<span class="token operator">-</span>app<span class="token operator">:</span> log<span class="token operator">-</span>cleaner
  <span class="token literal-property property">template</span><span class="token operator">:</span>
    <span class="token literal-property property">metadata</span><span class="token operator">:</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> log<span class="token operator">-</span>cleaner
      <span class="token literal-property property">labels</span><span class="token operator">:</span>
        k8s<span class="token operator">-</span>app<span class="token operator">:</span> log<span class="token operator">-</span>cleaner
    <span class="token literal-property property">spec</span><span class="token operator">:</span>
      <span class="token literal-property property">hostPID</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token literal-property property">containers</span><span class="token operator">:</span>
      <span class="token operator">-</span> name<span class="token operator">:</span> batch<span class="token operator">-</span><span class="token keyword">delete</span><span class="token operator">-</span>files
        <span class="token literal-property property">image</span><span class="token operator">:</span> some<span class="token operator">-</span>registry<span class="token operator">/</span>batch<span class="token operator">-</span><span class="token keyword">delete</span><span class="token operator">-</span>files<span class="token operator">:</span>v1<span class="token punctuation">.</span><span class="token number">0.0</span>
        <span class="token literal-property property">imagePullPolicy</span><span class="token operator">:</span> Always
        <span class="token literal-property property">command</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"bash"</span><span class="token punctuation">]</span>
        <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"while true; do python delete_files.py -f /some-path/*/*/*.log* -m 1440; sleep 3600; done;"</span><span class="token punctuation">]</span>
        <span class="token literal-property property">resources</span><span class="token operator">:</span>
          <span class="token literal-property property">limits</span><span class="token operator">:</span>
            <span class="token literal-property property">cpu</span><span class="token operator">:</span> 2560m
            <span class="token literal-property property">memory</span><span class="token operator">:</span> 256Mi
          <span class="token literal-property property">requests</span><span class="token operator">:</span>
            <span class="token literal-property property">cpu</span><span class="token operator">:</span> 25m
            <span class="token literal-property property">memory</span><span class="token operator">:</span> 32Mi
        <span class="token literal-property property">volumeMounts</span><span class="token operator">:</span>
        <span class="token operator">-</span> mountPath<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">some-path</span><span class="token regex-delimiter">/</span></span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> some<span class="token operator">-</span>volume
      <span class="token literal-property property">volumes</span><span class="token operator">:</span>
      <span class="token operator">-</span> name<span class="token operator">:</span> some<span class="token operator">-</span>volume
        <span class="token literal-property property">hostPath</span><span class="token operator">:</span>
          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">some-path</span><span class="token regex-delimiter">/</span></span></code></pre><div class="notion-text notion-block-8f6a1ee67e8a4538a50bb3a38c75a22a">值得注意的是，由于我们需要在容器内使用 <code class="notion-inline-code">lsof</code> 来看查看母机文件的 <code class="notion-inline-code">fd</code> 使用情况，所以这里需要额外添加 <code class="notion-inline-code">hostPID: true</code> 来保证能够读取到母机的进程信息。</div><div class="notion-text notion-block-6dab5d2e67664627a45e3926be2f3a3e">由于我们需要定时执行，所以通过 <code class="notion-inline-code">while true; do ... sleep 3600; done;</code> 来要额外控制执行周期。</div><div class="notion-blank notion-block-f5dc7655a4c54a4c9ca37bba92be8c13"> </div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-7377dacec15240a9a188d2c4e3d4fb13" data-id="7377dacec15240a9a188d2c4e3d4fb13"><span><div id="7377dacec15240a9a188d2c4e3d4fb13" class="notion-header-anchor"></div><a class="notion-hash-link" href="#7377dacec15240a9a188d2c4e3d4fb13" title="结语"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">结语</span></span></h3><div class="notion-text notion-block-3c51eb0d7bbc41d88d64913bbf47e15e">由于 Filebeat 存在天生的存储缺陷，我们需要通过额外的脚本较为精确的控制 Filebeat 的输入文件数量，当前的方案断然达不到完善，仍需要我们继续探索。</div><div class="notion-blank notion-block-7f0a1a3c5d844372a19cf5c0bf4bb404"> </div><div class="notion-text notion-block-59cae06d10854ff195958103340260d8">参考：</div><ul class="notion-list notion-list-disc notion-block-aaee6289a55e44a199da9199b605f91e"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://github.com/elastic/beats/issues/16076">https://github.com/elastic/beats/issues/16076</a></li></ul><ul class="notion-list notion-list-disc notion-block-38b560e7554e49479fac3f4e4f8f6ad0"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://stackoverflow.com/questions/36186630/python-error-subprocess-calledprocesserror-command-returned-non-zero-exit-stat">https://stackoverflow.com/questions/36186630/python-error-subprocess-calledprocesserror-command-returned-non-zero-exit-stat</a></li></ul><ul class="notion-list notion-list-disc notion-block-df49019244bb4946aba55798398e2841"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://stackoverflow.com/questions/55901375/is-this-possible-to-schedule-cronjob-to-execute-on-each-of-kubernetes-nodes">https://stackoverflow.com/questions/55901375/is-this-possible-to-schedule-cronjob-to-execute-on-each-of-kubernetes-nodes</a></li></ul><div class="notion-blank notion-block-c6282ec3a04c4e8c85699b0f40b7e663"> </div></main></div></article><div class="flex justify-between font-medium text-gray-500 dark:text-gray-400"><a><button class="mt-2 cursor-pointer hover:text-black dark:hover:text-gray-100">← <!-- -->返回</button></a><a><button class="mt-2 cursor-pointer hover:text-black dark:hover:text-gray-100">↑ <!-- -->回到顶部</button></a></div><div></div></main><div class="mt-6 flex-shrink-0 m-auto w-full text-gray-500 dark:text-gray-400 transition-all max-w-3xl px-4"><hr class="border-gray-200 dark:border-gray-600"/><div class="my-4 text-sm leading-6"><div class="flex align-baseline justify-between flex-wrap"><p>© <!-- -->bluesyu<!-- --> <!-- -->2019 - 2023</p><p>powered by <a href="https://github.com/craigary/nobelium"><u>nobelium</u></a></p></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","date":{"start_date":"2021-06-01"},"type":["Post"],"slug":"filebeat-hangs-problem.html","tags":["best-practice","tech","ELK","k8s"],"summary":"日常工作记录","title":"FileBeat 启动假死问题","status":["Published"],"createdTime":"Tue Oct 18 2022 02:10:09 GMT+0000 (Coordinated Universal Time)","fullWidth":false,"pageIcon":"🧟‍♂️","pageCover":null},"blockMap":{"block":{"ebd71155-4a59-46a0-bbb2-40687ddbcf9d":{"value":{"id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","version":43,"type":"page","properties":{"NX\\Q":[["‣",[["d",{"type":"date","start_date":"2021-06-01"}]]]],"`gQ~":[["Post"]],"d]hq":[["filebeat-hangs-problem.html"]],"sD^m":[["best-practice,tech,ELK,k8s"]],"wz|S":[["日常工作记录"]],"title":[["FileBeat 启动假死问题"]],"26ff3130-393a-45ac-92b5-7490d9b87515":[["post"]],"29e679ed-47a3-46c2-9eb4-9070171591b8":[["Yes"]],"b6d830ff-ce1d-4e76-a484-f0fc3f148c52":[["Yes"]],"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":[["Published"]]},"content":["03d2472b-4ef5-4001-b66b-dd7229f1ddc0","15022a98-96b2-424d-9e70-583f870933b6","bb6e27b3-fb54-4231-a1c8-ceb77fb977b8","726a6446-28ee-4329-8887-d490282d3142","d18194d6-1a62-4342-a6af-a3cf3855dda0","2fc5e936-47db-4a0e-bb93-3e05589d9cab","d47fa924-df4b-4254-9952-37de5d8fa0c6","bd4bcb3a-6397-4ae2-a5e4-33bc268bc7ae","3a206e28-24ab-446a-a6c9-b5637b357e1e","14164461-d36b-44da-b01c-7ddabf249b1c","c8af4e47-327d-467c-b1af-c6d0b3c85c75","91f1c3ec-86e6-46bd-8de4-3288cad6c36e","528e7c59-ad7b-425d-a0b5-0d7e0cb42543","33e420b7-be02-4b7b-83d8-9f71d509cc1f","c57520ac-2c53-4801-9c8e-be47c7f5448b","d50702a4-ca42-4507-b96e-4bbbebdecdd8","79a574b4-9ed3-48e8-ad11-8c78803f95f8","3cf9cda1-891f-4383-8ee2-30892a2230e3","a533684c-7abc-4f51-b4c0-ce0df44d1eb6","f13c3053-ee0f-4f56-9f93-4e20fb36912c","8dcb3548-45b2-4fd9-92ec-1426009155ea","ab4203e1-5702-42bd-84c6-c682aea249ac","7b92e629-7bc7-4f1c-8a60-df90b33f3bbf","0e800b71-70d8-4241-b08e-10bc1a58b6b7","159dd38c-73b6-47b1-8a6c-c197da0c711e","e96af924-c175-4091-9600-f1b51f9107e4","cca6280a-1691-4985-8cb1-483d569b055f","b042a145-ffa9-487e-aa0d-c623550ba8ed","8b91fed4-dd37-40a9-be53-57eb07bee16e","c3ac9538-006e-4d30-826a-4fb2723d206b","2c9f5dd1-7ae6-486c-95d0-0250d4508427","924da4c0-9334-4a95-9f55-2b60adb83120","910c8a10-0ee4-41d8-bd76-9b3dca9e1ca7","2257bf30-2f08-4bdc-ba33-0fc49020e1be","899e1e0a-06d6-4900-9552-d38f3e8180f4","97a1156b-538d-482c-9658-8ad0f429889b","8a68e380-71d3-449e-8fb3-28657f546363","b2e7b975-dcf3-474a-8ffd-0729669c155c","bf4d2695-b5ab-40b2-99f6-8564a33a5244","2a4a9228-b5f9-4d3f-9b4f-d736f1090b42","33dd6e54-0743-4ad8-a509-c9e86b936c30","52a3eb5b-750b-4f2c-a178-277a18ece916","840ef338-ca45-4fe5-bc0c-fcfdfb159f66","f21e5ba3-9f5a-4bc3-b28d-6de4bc4bfa73","8f6a1ee6-7e8a-4538-a50b-b3a38c75a22a","6dab5d2e-6766-4627-a45e-3926be2f3a3e","f5dc7655-a4c5-4a4c-9ca3-7bba92be8c13","7377dace-c152-40a9-a188-d2c4e3d4fb13","3c51eb0d-7bbc-41d8-8d64-913bbf47e15e","7f0a1a3c-5d84-4372-a19c-f5c0bf4bb404","59cae06d-1085-4ff1-9595-8103340260d8","aaee6289-a55e-44a1-99da-9199b605f91e","38b560e7-554e-4947-9fac-3f4e4f8f6ad0","df490192-44bb-4946-aba5-5798398e2841","c6282ec3-a04c-4e8c-8569-9b0f40b7e663"],"format":{"page_icon":"🧟‍♂️","copied_from_pointer":{"id":"7467a602-0c23-4cb3-8746-b5a8826a6ea3","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009258,"last_edited_time":1666200480000,"parent_id":"e34bec60-9b02-4ad8-aaf8-83369409cc9f","parent_table":"collection","alive":true,"copied_from":"7467a602-0c23-4cb3-8746-b5a8826a6ea3","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"a6089909-2d0d-43ef-af93-5e041712e826":{"value":{"id":"a6089909-2d0d-43ef-af93-5e041712e826","version":121,"type":"collection_view_page","view_ids":["065b98d2-d3b4-4dab-8b96-4eb118a3f311"],"collection_id":"e34bec60-9b02-4ad8-aaf8-83369409cc9f","format":{"block_locked":false,"block_locked_by":"2c0e0b01-f59e-4e03-b7b6-7d706eecada3","collection_pointer":{"id":"e34bec60-9b02-4ad8-aaf8-83369409cc9f","table":"collection","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"copied_from_pointer":{"id":"adc3552c-fc73-442a-b504-8d4b1eb0079a","table":"block","spaceId":"ac4cb96d-c8f8-4040-9bb2-868d9fc7f526"}},"permissions":[{"role":"editor","type":"user_permission","user_id":"f594524b-0941-4aea-99a2-9b9304033287"},{"role":"reader","type":"public_permission","added_timestamp":1666006306008}],"created_time":1665993658476,"last_edited_time":1685590782024,"parent_id":"b0a64676-90b9-4734-9c63-2d704ee573b6","parent_table":"space","alive":true,"copied_from":"adc3552c-fc73-442a-b504-8d4b1eb0079a","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"03d2472b-4ef5-4001-b66b-dd7229f1ddc0":{"value":{"id":"03d2472b-4ef5-4001-b66b-dd7229f1ddc0","version":1,"type":"sub_header","properties":{"title":[["问题"]]},"format":{"copied_from_pointer":{"id":"93bb54d0-0092-4de6-907a-7dbb4ac97395","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"93bb54d0-0092-4de6-907a-7dbb4ac97395","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"15022a98-96b2-424d-9e70-583f870933b6":{"value":{"id":"15022a98-96b2-424d-9e70-583f870933b6","version":1,"type":"text","properties":{"title":[["上周因为 OOM 问题，某个集群内的 Filebeat 被迫重启后，观测了许久，仍不见事件流恢复，查看 Filebeat 输出日志，发现只有其自监控的日志："]]},"format":{"copied_from_pointer":{"id":"4dd7d70a-4153-4804-aaf6-a17fc567396f","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"4dd7d70a-4153-4804-aaf6-a17fc567396f","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"bb6e27b3-fb54-4231-a1c8-ceb77fb977b8":{"value":{"id":"bb6e27b3-fb54-4231-a1c8-ceb77fb977b8","version":1,"type":"code","properties":{"title":[["2021-05-28T03:19:41.061Z",[["h","red"]]],["\tINFO\t[monitoring]\tlog/log.go:145\tNon-zero metrics in the last 30s\t{\"monitoring\": {\"metrics\": {\"beat\":{\"cpu\":{\"system\":{\"ticks\":6249680,\"time\":{\"ms\":3024}},\"total\":{\"ticks\":13659880,\"time\":{\"ms\":6612},\"value\":13659880},\"user\":{\"ticks\":7410200,\"time\":{\"ms\":3588}}},\"handles\":{\"limit\":{\"hard\":1048576,\"soft\":1048576},\"open\":46},\"info\":{\"ephemeral_id\":\"ca641ad8-e10a-496f-a087-6924e456aaea\",\"uptime\":{\"ms\":60180037}},\"memstats\":{\"gc_next\":42518272,\"memory_alloc\":31026880,\"memory_total\":1715304668248,\"rss\":-1552384},\"runtime\":{\"goroutines\":206}},\"filebeat\":{\"events\":{\"added\":139,\"done\":139},"],["\"harvester\":{\"open_files\":0,\"running\":0}}",[["h","red"],["b"]]],[",\"libbeat\":{\"config\":{\"module\":{\"running\":0}},\"pipeline\":{\"clients\":1,\"events\":{\"active\":1,\"filtered\":139,\"total\":139},\"registrar\":{\"states\":{\"current\":55084,\"update\":13},\"writes\":{\"success\":139,\"total\":139}},\"system\":{\"load\":{\"1\":9.21,\"15\":10.97,\"5\":10.87,\"norm\":{\"1\":0.3838,\"15\":0.4571,\"5\":0.4529}}}}}}"]],"language":[["Plain Text"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"559bd659-1420-47d1-9bc5-08dfff4bba9e","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"559bd659-1420-47d1-9bc5-08dfff4bba9e","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"726a6446-28ee-4329-8887-d490282d3142":{"value":{"id":"726a6446-28ee-4329-8887-d490282d3142","version":1,"type":"text","properties":{"title":[["从 "],["\"harvester\":{\"open_files\":0,\"running\":0}}",[["c"]]],[" 我们可以判断出  "],["harvester",[["c"]]],[" 尚未启动采集，这让我非常疑惑，Filebeat 究竟在做什么？"]]},"format":{"copied_from_pointer":{"id":"88f990fb-331a-49aa-8ab1-88c966f20d47","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"88f990fb-331a-49aa-8ab1-88c966f20d47","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"d18194d6-1a62-4342-a6af-a3cf3855dda0":{"value":{"id":"d18194d6-1a62-4342-a6af-a3cf3855dda0","version":1,"type":"text","properties":{"title":[["接着观察日志，发现除开自监控，最后输出一条日志的内容是："]]},"format":{"copied_from_pointer":{"id":"dacdc407-af4e-4f5b-9695-1fe8c7194d4c","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009258,"last_edited_time":1666059009258,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"dacdc407-af4e-4f5b-9695-1fe8c7194d4c","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"2fc5e936-47db-4a0e-bb93-3e05589d9cab":{"value":{"id":"2fc5e936-47db-4a0e-bb93-3e05589d9cab","version":1,"type":"code","properties":{"title":[["2021-05-28T02:46:39.019Z",[["h","red"]]],["\tINFO\tbeater/crawler.go:73\tLoading Inputs: 1"]],"language":[["Plain Text"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"696684ee-8a52-4389-8aea-a8ec717dd217","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"696684ee-8a52-4389-8aea-a8ec717dd217","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"d47fa924-df4b-4254-9952-37de5d8fa0c6":{"value":{"id":"d47fa924-df4b-4254-9952-37de5d8fa0c6","version":1,"type":"text","properties":{"title":[["Loading Inputs",[["c"]]],[" 看起来也是符合逻辑的，短时间没有太多的头绪，放下忙其他工作了。"]]},"format":{"copied_from_pointer":{"id":"6018a4c1-3e85-40bd-a15b-7ca543be89fa","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"6018a4c1-3e85-40bd-a15b-7ca543be89fa","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"bd4bcb3a-6397-4ae2-a5e4-33bc268bc7ae":{"value":{"id":"bd4bcb3a-6397-4ae2-a5e4-33bc268bc7ae","version":1,"type":"text","properties":{"title":[["随着时间推移，当我再次观测 Filebeat 时，发现它已经在正常工作了，但是日志内依旧没有错误输出，找到恢复时间点的最早日志："]]},"format":{"copied_from_pointer":{"id":"c7648948-56d3-498e-b71e-0b9dc12a2793","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"c7648948-56d3-498e-b71e-0b9dc12a2793","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"3a206e28-24ab-446a-a6c9-b5637b357e1e":{"value":{"id":"3a206e28-24ab-446a-a6c9-b5637b357e1e","version":1,"type":"code","properties":{"title":[["2021-05-28T05:55:17.822Z",[["h","red"]]],["\tINFO\tlog/input.go:152\tConfigured paths: [/data/logs/*/*.log* /data/v3logs/*/*/*.log*]\n"],["2021-05-28T05:55:17.822Z",[["h","red"]]],["\tINFO\tinput/input.go:114\tStarting input of type: log; ID: 3062577341473220485\n"],["2021-05-28T05:55:17.822Z",[["h","red"]]],["\tINFO\tbeater/crawler.go:105\tLoading and starting Inputs completed. Enabled inputs: 1"]],"language":[["Plain Text"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"71a673a4-a138-4618-9389-c18ca675f5ff","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"71a673a4-a138-4618-9389-c18ca675f5ff","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"14164461-d36b-44da-b01c-7ddabf249b1c":{"value":{"id":"14164461-d36b-44da-b01c-7ddabf249b1c","version":1,"type":"text","properties":{"title":[["好家伙，从 "],["Loading Inputs",[["c"]]],[" → "],["Loading and starting Inputs completed",[["c"]]],[" 花费了3个多小时，这更让我疑惑了，Filebeat 究竟为什么一直装死？"]]},"format":{"copied_from_pointer":{"id":"e4354535-0019-45b5-a043-0da068680c51","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009258,"last_edited_time":1666059009258,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"e4354535-0019-45b5-a043-0da068680c51","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"c8af4e47-327d-467c-b1af-c6d0b3c85c75":{"value":{"id":"c8af4e47-327d-467c-b1af-c6d0b3c85c75","version":1,"type":"sub_header","properties":{"title":[["原因"]]},"format":{"copied_from_pointer":{"id":"4ac50bd5-a933-4333-9d06-1d1e151af3bc","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"4ac50bd5-a933-4333-9d06-1d1e151af3bc","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"91f1c3ec-86e6-46bd-8de4-3288cad6c36e":{"value":{"id":"91f1c3ec-86e6-46bd-8de4-3288cad6c36e","version":1,"type":"text","properties":{"title":[["根据日志打印翻阅了 Filebeat 源码"]]},"format":{"copied_from_pointer":{"id":"ac46a781-3028-46f4-a6f3-04780093df2c","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"ac46a781-3028-46f4-a6f3-04780093df2c","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"528e7c59-ad7b-425d-a0b5-0d7e0cb42543":{"value":{"id":"528e7c59-ad7b-425d-a0b5-0d7e0cb42543","version":1,"type":"image","properties":{"source":[["https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c55eecdf-b786-4a27-8d0a-af5a9f355d59/Untitled.png"]],"caption":[["https://github.com/elastic/beats/blob/23e4403ae093fcc8f7905345cad2c7ad256976d8/filebeat/beater/crawler.go#L71",[["a","https://github.com/elastic/beats/blob/23e4403ae093fcc8f7905345cad2c7ad256976d8/filebeat/beater/crawler.go#L71"]]]]},"format":{"block_width":1338,"display_source":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c55eecdf-b786-4a27-8d0a-af5a9f355d59/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.5127055306427504,"copied_from_pointer":{"id":"dba0f7d3-dd3a-484b-ab12-d301c242e1d1","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"block_preserve_scale":true},"created_time":1666059009258,"last_edited_time":1666059009258,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"dba0f7d3-dd3a-484b-ab12-d301c242e1d1","file_ids":["c55eecdf-b786-4a27-8d0a-af5a9f355d59"],"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"33e420b7-be02-4b7b-83d8-9f71d509cc1f":{"value":{"id":"33e420b7-be02-4b7b-83d8-9f71d509cc1f","version":1,"type":"image","properties":{"source":[["https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ff54b1b7-4b7d-4054-9a17-0e073d4820bb/Untitled.png"]],"caption":[["https://github.com/elastic/beats/blob/2ee21d95aef89af7f7e7aef8d07f679a24d690b4/filebeat/registrar/registrar.go#L172",[["a","https://github.com/elastic/beats/blob/2ee21d95aef89af7f7e7aef8d07f679a24d690b4/filebeat/registrar/registrar.go#L172"]]]]},"format":{"block_width":1516,"display_source":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ff54b1b7-4b7d-4054-9a17-0e073d4820bb/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.7691292875989446,"copied_from_pointer":{"id":"0ad3c972-3751-482a-bb03-430e0418875b","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"block_preserve_scale":true},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"0ad3c972-3751-482a-bb03-430e0418875b","file_ids":["ff54b1b7-4b7d-4054-9a17-0e073d4820bb"],"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"c57520ac-2c53-4801-9c8e-be47c7f5448b":{"value":{"id":"c57520ac-2c53-4801-9c8e-be47c7f5448b","version":1,"type":"text","properties":{"title":[["Filebeat 使用 "],["registry file",[["c"]]],[" 作为采集的状态存储，实际上就是一个纯文本的 JSON 文件。每次启动时都会检查 JSON 文件中的 "],["states",[["c"]]],[" 是否需要更新（新增或者删除文件），而当任何一个 "],["state",[["c"]]],[" 需要更新， "],["registry file",[["c"]]],[" 将会全量序列化(读) → 持久化(写)，随着 "],["states",[["c"]]],[" 越来越多，JSON 文件会越来越大（接近20MB），每次全量读写都会越来越慢，并且 CPU、内存的使用量都会暴涨。"]]},"format":{"copied_from_pointer":{"id":"db0fe266-89a6-4cba-9d63-e897f6fdd4a9","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009258,"last_edited_time":1666059009258,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"db0fe266-89a6-4cba-9d63-e897f6fdd4a9","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"d50702a4-ca42-4507-b96e-4bbbebdecdd8":{"value":{"id":"d50702a4-ca42-4507-b96e-4bbbebdecdd8","version":1,"type":"image","properties":{"source":[["https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b20f6619-c30b-4392-85ae-fd16c4ca5296/Untitled.png"]]},"format":{"block_width":1856,"display_source":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b20f6619-c30b-4392-85ae-fd16c4ca5296/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.3588362068965517,"copied_from_pointer":{"id":"4a001a54-df2f-4a65-a45c-682e555ea713","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"block_preserve_scale":true},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"4a001a54-df2f-4a65-a45c-682e555ea713","file_ids":["b20f6619-c30b-4392-85ae-fd16c4ca5296"],"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"79a574b4-9ed3-48e8-ad11-8c78803f95f8":{"value":{"id":"79a574b4-9ed3-48e8-ad11-8c78803f95f8","version":1,"type":"text","format":{"copied_from_pointer":{"id":"988004c0-467a-433a-af1c-54e72c05cf98","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"988004c0-467a-433a-af1c-54e72c05cf98","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"3cf9cda1-891f-4383-8ee2-30892a2230e3":{"value":{"id":"3cf9cda1-891f-4383-8ee2-30892a2230e3","version":1,"type":"text","format":{"copied_from_pointer":{"id":"bddae2e5-989a-440a-b09a-89a13df12e90","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"bddae2e5-989a-440a-b09a-89a13df12e90","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"a533684c-7abc-4f51-b4c0-ce0df44d1eb6":{"value":{"id":"a533684c-7abc-4f51-b4c0-ce0df44d1eb6","version":1,"type":"text","properties":{"title":[["总的来说，在当前的数据存储选型下，Filebeat 无法应对过多的文件数据数量，启动时的数据核验时间过长（几小时→几天不等，视数据量而定），就会产生了“假死”的现象。"]]},"format":{"copied_from_pointer":{"id":"ca56b6e1-866d-4294-8f32-1c49d0ae0ce1","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"ca56b6e1-866d-4294-8f32-1c49d0ae0ce1","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"f13c3053-ee0f-4f56-9f93-4e20fb36912c":{"value":{"id":"f13c3053-ee0f-4f56-9f93-4e20fb36912c","version":1,"type":"sub_header","properties":{"title":[["解决方案"]]},"format":{"copied_from_pointer":{"id":"d37eadb3-6f2e-4ee2-a932-33870a579e6d","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009258,"last_edited_time":1666059009258,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"d37eadb3-6f2e-4ee2-a932-33870a579e6d","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"8dcb3548-45b2-4fd9-92ec-1426009155ea":{"value":{"id":"8dcb3548-45b2-4fd9-92ec-1426009155ea","version":1,"type":"sub_sub_header","properties":{"title":[["临时的解决方案"]]},"format":{"copied_from_pointer":{"id":"ccf8b273-62d7-403f-925f-65c2fdff67dd","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"ccf8b273-62d7-403f-925f-65c2fdff67dd","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"ab4203e1-5702-42bd-84c6-c682aea249ac":{"value":{"id":"ab4203e1-5702-42bd-84c6-c682aea249ac","version":1,"type":"text","properties":{"title":[["暂停 Filebeat 进程，删除 "],["registry file",[["c"]]],[" ，重启 Filebeat 进程。这时候由于 JSON 文件是比较小的，所有 "],["state",[["c"]]],[" 均处于增量状态，数据同步是比较快的。但是所有已经发送过的事件将难以"],["避免地重复发送一次，",[["b"]]],["所以这种做法只能应急，不能长久处理。"]]},"format":{"copied_from_pointer":{"id":"9fa9d732-2b39-4f8d-b3bb-c9537c609bdc","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"9fa9d732-2b39-4f8d-b3bb-c9537c609bdc","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"7b92e629-7bc7-4f1c-8a60-df90b33f3bbf":{"value":{"id":"7b92e629-7bc7-4f1c-8a60-df90b33f3bbf","version":1,"type":"text","format":{"copied_from_pointer":{"id":"dc2b4439-e778-4ee7-9910-04de79d4232f","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009258,"last_edited_time":1666059009258,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"dc2b4439-e778-4ee7-9910-04de79d4232f","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"0e800b71-70d8-4241-b08e-10bc1a58b6b7":{"value":{"id":"0e800b71-70d8-4241-b08e-10bc1a58b6b7","version":1,"type":"sub_sub_header","properties":{"title":[["长久的权宜之计"]]},"format":{"copied_from_pointer":{"id":"44c07b01-d7e5-4242-a6d0-e9bbd6c46592","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"44c07b01-d7e5-4242-a6d0-e9bbd6c46592","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"159dd38c-73b6-47b1-8a6c-c197da0c711e":{"value":{"id":"159dd38c-73b6-47b1-8a6c-c197da0c711e","version":1,"type":"text","properties":{"title":[["Filebeat 的纯文本的 JSON 存储选型天生就是存在问题的，社区内也曾做过一些"],["小改进的尝试",[["a","https://github.com/elastic/beats/pull/12908"]]],["，最终并没有被合并到柱分枝。所以 Filebeat 无法应用过多的日志文件，这是一个短期内无法改变的事实。"]]},"format":{"copied_from_pointer":{"id":"34789c2b-8727-49d4-8f93-8e7d4a8763c8","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"34789c2b-8727-49d4-8f93-8e7d4a8763c8","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"e96af924-c175-4091-9600-f1b51f9107e4":{"value":{"id":"e96af924-c175-4091-9600-f1b51f9107e4","version":1,"type":"text","format":{"copied_from_pointer":{"id":"23191a69-c74d-4195-915c-af7b1d649f80","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"23191a69-c74d-4195-915c-af7b1d649f80","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"cca6280a-1691-4985-8cb1-483d569b055f":{"value":{"id":"cca6280a-1691-4985-8cb1-483d569b055f","version":1,"type":"text","properties":{"title":[["而在当前选择的"],["依赖背压的采集方案",[["a","https://emergencyexit.xyz/elk-back-pressure-study.html"]]],[" 中，我们并不倾向将日志文件留在采集管道中，而是将日志留在原处——机器的磁盘上，然后尽量保证管道的通畅，将日志实时采集到 ES 中。"]]},"format":{"copied_from_pointer":{"id":"98086864-ce09-4629-9807-a9e7739ee0a3","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"98086864-ce09-4629-9807-a9e7739ee0a3","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"b042a145-ffa9-487e-aa0d-c623550ba8ed":{"value":{"id":"b042a145-ffa9-487e-aa0d-c623550ba8ed","version":1,"type":"text","properties":{"title":[["这样做的好处，就是避免因为过多的管道传输导致日志丢失（例如 Redis 写满后崩溃）。"]]},"format":{"copied_from_pointer":{"id":"bf009108-0905-4866-916a-07e4cc38a68e","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"bf009108-0905-4866-916a-07e4cc38a68e","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"8b91fed4-dd37-40a9-be53-57eb07bee16e":{"value":{"id":"8b91fed4-dd37-40a9-be53-57eb07bee16e","version":1,"type":"text","properties":{"title":[["同时也会引入另一个问题：如果采集链路阻塞，同时过多的日志（采集条目每日2亿+）大于机器的磁盘承载能力时，日志丢失的风险依旧存在。"]]},"format":{"copied_from_pointer":{"id":"9cc36908-0ce7-40d7-80e8-b5ecd14a947b","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"9cc36908-0ce7-40d7-80e8-b5ecd14a947b","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"c3ac9538-006e-4d30-826a-4fb2723d206b":{"value":{"id":"c3ac9538-006e-4d30-826a-4fb2723d206b","version":1,"type":"text","properties":{"title":[["所以我们需要定期清理过期的日志，但问题也没那么简单："]]},"format":{"copied_from_pointer":{"id":"a6915488-33bc-4eab-ad91-8157369754f4","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"a6915488-33bc-4eab-ad91-8157369754f4","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"2c9f5dd1-7ae6-486c-95d0-0250d4508427":{"value":{"id":"2c9f5dd1-7ae6-486c-95d0-0250d4508427","version":1,"type":"bulleted_list","properties":{"title":[["直接删除日志文件  → 写日志的"],["应用进程无法感知，将向无效文件句柄写日志",[["a","https://stackoverflow.com/a/2031100/6122939"]]],[" → 导致日志丢失"]]},"format":{"copied_from_pointer":{"id":"1bcd2b15-65ac-4d41-aa1b-74adba0728f5","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"1bcd2b15-65ac-4d41-aa1b-74adba0728f5","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"924da4c0-9334-4a95-9f55-2b60adb83120":{"value":{"id":"924da4c0-9334-4a95-9f55-2b60adb83120","version":1,"type":"bulleted_list","properties":{"title":[["清空文件日志内容( "],["echo '' \u003e {}",[["c"]]],[") → 导致文件数量不会减少"]]},"format":{"copied_from_pointer":{"id":"e0a3a711-a609-4cff-b682-7d352eb37c42","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009258,"last_edited_time":1666059009258,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"e0a3a711-a609-4cff-b682-7d352eb37c42","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"910c8a10-0ee4-41d8-bd76-9b3dca9e1ca7":{"value":{"id":"910c8a10-0ee4-41d8-bd76-9b3dca9e1ca7","version":1,"type":"bulleted_list","properties":{"title":[["如果因为硬盘容量限制，删除日志的周期小于"],["产品许诺的日志保存时长",[["i"]]],["，当链路出现堵塞又未能及时处理 → 导致日志丢失"]]},"format":{"copied_from_pointer":{"id":"289b3965-e456-406d-bd4a-cd67f7f49442","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"289b3965-e456-406d-bd4a-cd67f7f49442","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"2257bf30-2f08-4bdc-ba33-0fc49020e1be":{"value":{"id":"2257bf30-2f08-4bdc-ba33-0fc49020e1be","version":1,"type":"text","format":{"copied_from_pointer":{"id":"6eadabef-57c0-4862-bcd5-163310d9303e","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"6eadabef-57c0-4862-bcd5-163310d9303e","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"899e1e0a-06d6-4900-9552-d38f3e8180f4":{"value":{"id":"899e1e0a-06d6-4900-9552-d38f3e8180f4","version":1,"type":"text","properties":{"title":[["所以我写了一个 "],["删除脚本",[["a","https://gist.github.com/IMBlues/2803c02420d01309d33f9d26ee501223"]]],["，在保证清理过期日志的同时，会判断日志文件的句柄使用情况，跳过那些仍在被写入的文件，保证日志不丢失。"]]},"format":{"copied_from_pointer":{"id":"5c0f381f-63bf-4d48-b456-8ed7aa49811d","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"5c0f381f-63bf-4d48-b456-8ed7aa49811d","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"97a1156b-538d-482c-9658-8ad0f429889b":{"value":{"id":"97a1156b-538d-482c-9658-8ad0f429889b","version":1,"type":"code","properties":{"title":[["# -*- coding: utf-8 -*-\nimport datetime\nimport getopt\nimport glob\nimport logging\nimport subprocess\nimport sys\nfrom collections import namedtuple\nfrom pathlib import Path\nfrom typing import Generator, Dict\n\nlogging.basicConfig(level=logging.DEBUG)\n\n\nProcess = namedtuple(\"Process\", \"command,pid,user\")\n\n\ndef get_processes_open(file_regex: str) -\u003e Dict[str, Process]:\n    \"\"\"Find processes with open handles for the specified file(s).\"\"\"\n\n    open_file_process_map = {}\n\n    try:\n        # maybe not safe\n        output = subprocess.getoutput(f\"echo {file_regex} | xargs lsof\")\n    except Exception:\n        logging.exception(\"exec error\")\n        return open_file_process_map\n\n    lines = output.split(\"\\n\")[1:]\n    for line in lines:\n        parts = [x for x in line.split(\" \") if x]\n        open_file_process_map[parts[-1]] = Process(*parts[:3])\n\n    return open_file_process_map\n\n\ndef try_to_delete_files(file_regex: str, minutes: int):\n    \"\"\"Try to delete files\"\"\"\n    skipped_count = deleted_count = 0\n\n    def filter_files_by_expire_minutes() -\u003e Generator[Path, None, None]:\n        \"\"\"Get all expired files\"\"\"\n        now = datetime.datetime.now()\n        for name in glob.glob(file_regex, recursive=True):\n            file_obj = Path(name)\n            updated = datetime.datetime.fromtimestamp(file_obj.stat().st_mtime)\n            if updated \u003c now - datetime.timedelta(minutes=minutes):\n                yield file_obj\n\n    open_file_process_map = get_processes_open(file_regex)\n    for f in filter_files_by_expire_minutes():\n        if str(f) not in open_file_process_map:\n            logging.info(f\"deleting {f}\")\n            try:\n                f.unlink()\n                deleted_count += 1\n            except Exception as e:\n                skipped_count += 1\n                logging.warning(\"failed to delete file: %s, for: %s\", str(f), e)\n                continue\n        else:\n            skipped_count += 1\n            logging.info(f\"skipping {f}, for process: {open_file_process_map[str(f)]}\")\n\n    print(f\"Skipped: {skipped_count}, deleted: {deleted_count}\")\n\n\nif __name__ == \"__main__\":\n    try:\n        opts, args = getopt.getopt(sys.argv[1:], \"hf:m:\", [\"files=\", \"minutes=\"])\n    except getopt.GetoptError:\n        print(\"Example: python delete_files.py -f /data/*/*.log* -m 1440\")\n        sys.exit(2)\n\n    arg_files = \"\"\n    arg_minutes = 1440\n    for opt, arg in opts:\n        if opt == \"-h\":\n            print(\"Usage: python delete_files.py -f /data/*/*.log* -m 1440\")\n            sys.exit(2)\n        elif opt in (\"-f\", \"--files\"):\n            arg_files = arg\n        elif opt in (\"-m\", \"--minutes\"):\n            arg_minutes = int(arg)\n\n    started = datetime.datetime.now()\n    print(f\"Started: {started}\\n\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\")\n    try_to_delete_files(arg_files, arg_minutes)\n    finished = datetime.datetime.now()\n    print(\n        f\"\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\\nFinished: {finished}, total cost: {(finished - started).total_seconds()} seconds \\n\"\n    )"]],"caption":[["delete_files.py"]],"language":[["Python"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"dc8a6ec8-fffd-4a42-b055-75e9dbdb3c38","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009258,"last_edited_time":1666059009258,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"dc8a6ec8-fffd-4a42-b055-75e9dbdb3c38","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"8a68e380-71d3-449e-8fb3-28657f546363":{"value":{"id":"8a68e380-71d3-449e-8fb3-28657f546363","version":1,"type":"text","properties":{"title":[["当然你也可以根据需求用 Bash 实现，这里就不展开了。"],["（其实就是我不会 Bash）",[["s"],["i"]]]]},"format":{"copied_from_pointer":{"id":"858d9eca-b092-4dbd-8a39-f26983b9cf80","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"858d9eca-b092-4dbd-8a39-f26983b9cf80","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"b2e7b975-dcf3-474a-8ffd-0729669c155c":{"value":{"id":"b2e7b975-dcf3-474a-8ffd-0729669c155c","version":1,"type":"text","format":{"copied_from_pointer":{"id":"b910e288-d326-4a7f-aa1e-3a2488f44402","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"b910e288-d326-4a7f-aa1e-3a2488f44402","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"bf4d2695-b5ab-40b2-99f6-8564a33a5244":{"value":{"id":"bf4d2695-b5ab-40b2-99f6-8564a33a5244","version":1,"type":"text","properties":{"title":[["然后我们需要将它跑在集群中的每一个节点上，定期执行清理工作："]]},"format":{"copied_from_pointer":{"id":"bfee6e16-f2a8-4946-a463-210b23ceae29","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"bfee6e16-f2a8-4946-a463-210b23ceae29","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"2a4a9228-b5f9-4d3f-9b4f-d736f1090b42":{"value":{"id":"2a4a9228-b5f9-4d3f-9b4f-d736f1090b42","version":1,"type":"text","properties":{"title":[["首先定义镜像"]]},"format":{"copied_from_pointer":{"id":"72e3b01f-dbe5-420e-b182-b6fa53ccc94d","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"72e3b01f-dbe5-420e-b182-b6fa53ccc94d","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"33dd6e54-0743-4ad8-a509-c9e86b936c30":{"value":{"id":"33dd6e54-0743-4ad8-a509-c9e86b936c30","version":1,"type":"code","properties":{"title":[["FROM python:3\nRUN apt-get update \u0026\u0026 apt-get install -y lsof\nADD delete_files.py /\nCMD [ \"python\", \"./delete_files.py\", \"-f\", \"./*.no\", \"-m\", \"1440\" ]"]],"language":[["Docker"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"0b701694-493d-4bca-9dc8-3207617d745f","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"0b701694-493d-4bca-9dc8-3207617d745f","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"52a3eb5b-750b-4f2c-a178-277a18ece916":{"value":{"id":"52a3eb5b-750b-4f2c-a178-277a18ece916","version":1,"type":"text","format":{"copied_from_pointer":{"id":"a118cd43-88fa-4f7f-a664-8952fb978436","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"a118cd43-88fa-4f7f-a664-8952fb978436","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"840ef338-ca45-4fe5-bc0c-fcfdfb159f66":{"value":{"id":"840ef338-ca45-4fe5-bc0c-fcfdfb159f66","version":1,"type":"text","properties":{"title":[["Kubernetes DaemonSet 定义，在每一个节点上都尝试清理日志："]]},"format":{"copied_from_pointer":{"id":"22189b5b-dd7e-4810-8842-ac5440e395be","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"22189b5b-dd7e-4810-8842-ac5440e395be","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"f21e5ba3-9f5a-4bc3-b28d-6de4bc4bfa73":{"value":{"id":"f21e5ba3-9f5a-4bc3-b28d-6de4bc4bfa73","version":1,"type":"code","properties":{"title":[["apiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: log-cleaner\n  namespace: kube-system\n  labels:\n    k8s-app: log-cleaner\nspec:\n  selector:\n    matchLabels:\n      k8s-app: log-cleaner\n  template:\n    metadata:\n      name: log-cleaner\n      labels:\n        k8s-app: log-cleaner\n    spec:\n      hostPID: true\n      containers:\n      - name: batch-delete-files\n        image: some-registry/batch-delete-files:v1.0.0\n        imagePullPolicy: Always\n        command: [\"bash\"]\n        args: [\"-c\", \"while true; do python delete_files.py -f /some-path/*/*/*.log* -m 1440; sleep 3600; done;\"]\n        resources:\n          limits:\n            cpu: 2560m\n            memory: 256Mi\n          requests:\n            cpu: 25m\n            memory: 32Mi\n        volumeMounts:\n        - mountPath: /some-path/\n          name: some-volume\n      volumes:\n      - name: some-volume\n        hostPath:\n          path: /some-path/"]],"language":[["YAML"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"fa452085-2eec-468e-a7ce-1fbc6cfd5ebd","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009258,"last_edited_time":1666059009258,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"fa452085-2eec-468e-a7ce-1fbc6cfd5ebd","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"8f6a1ee6-7e8a-4538-a50b-b3a38c75a22a":{"value":{"id":"8f6a1ee6-7e8a-4538-a50b-b3a38c75a22a","version":1,"type":"text","properties":{"title":[["值得注意的是，由于我们需要在容器内使用 "],["lsof",[["c"]]],[" 来看查看母机文件的 "],["fd",[["c"]]],[" 使用情况，所以这里需要额外添加 "],["hostPID: true",[["c"]]],[" 来保证能够读取到母机的进程信息。"]]},"format":{"copied_from_pointer":{"id":"441ee5bd-023c-41b2-8a4a-586464cf0999","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"441ee5bd-023c-41b2-8a4a-586464cf0999","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"6dab5d2e-6766-4627-a45e-3926be2f3a3e":{"value":{"id":"6dab5d2e-6766-4627-a45e-3926be2f3a3e","version":1,"type":"text","properties":{"title":[["由于我们需要定时执行，所以通过 "],["while true; do ... sleep 3600; done;",[["c"]]],[" 来要额外控制执行周期。"]]},"format":{"copied_from_pointer":{"id":"a1ba76ad-5d59-4d5a-8c2f-9282ddd4c9a0","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"a1ba76ad-5d59-4d5a-8c2f-9282ddd4c9a0","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"f5dc7655-a4c5-4a4c-9ca3-7bba92be8c13":{"value":{"id":"f5dc7655-a4c5-4a4c-9ca3-7bba92be8c13","version":1,"type":"text","format":{"copied_from_pointer":{"id":"8e98ea56-3399-40aa-b3e6-81a3f3a37160","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"8e98ea56-3399-40aa-b3e6-81a3f3a37160","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"7377dace-c152-40a9-a188-d2c4e3d4fb13":{"value":{"id":"7377dace-c152-40a9-a188-d2c4e3d4fb13","version":1,"type":"sub_header","properties":{"title":[["结语"]]},"format":{"copied_from_pointer":{"id":"ca3a21af-3a99-4c27-9e48-1206b2726616","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"ca3a21af-3a99-4c27-9e48-1206b2726616","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"3c51eb0d-7bbc-41d8-8d64-913bbf47e15e":{"value":{"id":"3c51eb0d-7bbc-41d8-8d64-913bbf47e15e","version":1,"type":"text","properties":{"title":[["由于 Filebeat 存在天生的存储缺陷，我们需要通过额外的脚本较为精确的控制 Filebeat 的输入文件数量，当前的方案断然达不到完善，仍需要我们继续探索。"]]},"format":{"copied_from_pointer":{"id":"beb1acae-ca71-4617-9c2f-013abb1bde6c","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"beb1acae-ca71-4617-9c2f-013abb1bde6c","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"7f0a1a3c-5d84-4372-a19c-f5c0bf4bb404":{"value":{"id":"7f0a1a3c-5d84-4372-a19c-f5c0bf4bb404","version":1,"type":"text","format":{"copied_from_pointer":{"id":"8ce6990f-7571-4724-9108-223f2f44278c","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"8ce6990f-7571-4724-9108-223f2f44278c","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"59cae06d-1085-4ff1-9595-8103340260d8":{"value":{"id":"59cae06d-1085-4ff1-9595-8103340260d8","version":1,"type":"text","properties":{"title":[["参考："]]},"format":{"copied_from_pointer":{"id":"3cb18af6-e02c-4923-958e-c21867660352","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"3cb18af6-e02c-4923-958e-c21867660352","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"aaee6289-a55e-44a1-99da-9199b605f91e":{"value":{"id":"aaee6289-a55e-44a1-99da-9199b605f91e","version":1,"type":"bulleted_list","properties":{"title":[["https://github.com/elastic/beats/issues/16076",[["a","https://github.com/elastic/beats/issues/16076"]]]]},"format":{"copied_from_pointer":{"id":"f0cf96aa-dc35-4706-9b32-1b51910ea4e4","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009258,"last_edited_time":1666059009258,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"f0cf96aa-dc35-4706-9b32-1b51910ea4e4","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"38b560e7-554e-4947-9fac-3f4e4f8f6ad0":{"value":{"id":"38b560e7-554e-4947-9fac-3f4e4f8f6ad0","version":1,"type":"bulleted_list","properties":{"title":[["https://stackoverflow.com/questions/36186630/python-error-subprocess-calledprocesserror-command-returned-non-zero-exit-stat",[["a","https://stackoverflow.com/questions/36186630/python-error-subprocess-calledprocesserror-command-returned-non-zero-exit-stat"]]]]},"format":{"copied_from_pointer":{"id":"56f43b36-4b60-46e1-bc76-fde04a81b9cd","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009256,"last_edited_time":1666059009256,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"56f43b36-4b60-46e1-bc76-fde04a81b9cd","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"df490192-44bb-4946-aba5-5798398e2841":{"value":{"id":"df490192-44bb-4946-aba5-5798398e2841","version":1,"type":"bulleted_list","properties":{"title":[["https://stackoverflow.com/questions/55901375/is-this-possible-to-schedule-cronjob-to-execute-on-each-of-kubernetes-nodes",[["a","https://stackoverflow.com/questions/55901375/is-this-possible-to-schedule-cronjob-to-execute-on-each-of-kubernetes-nodes"]]]]},"format":{"copied_from_pointer":{"id":"06ec0154-e232-4e43-a8e7-11c36a149ada","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009255,"last_edited_time":1666059009255,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"06ec0154-e232-4e43-a8e7-11c36a149ada","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"c6282ec3-a04c-4e8c-8569-9b0f40b7e663":{"value":{"id":"c6282ec3-a04c-4e8c-8569-9b0f40b7e663","version":1,"type":"text","format":{"copied_from_pointer":{"id":"be336461-e503-456e-8ac6-b70efb57c1cc","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666059009257,"last_edited_time":1666059009257,"parent_id":"ebd71155-4a59-46a0-bbb2-40687ddbcf9d","parent_table":"block","alive":true,"copied_from":"be336461-e503-456e-8ac6-b70efb57c1cc","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"}},"collection":{"e34bec60-9b02-4ad8-aaf8-83369409cc9f":{"value":{"id":"e34bec60-9b02-4ad8-aaf8-83369409cc9f","version":97,"name":[["布鲁斯鱼的妙想天开 "]],"schema":{"NX\\Q":{"name":"date","type":"date"},"`gQ~":{"name":"type","type":"select","options":[{"id":"5aff2f95-fd1e-489b-8840-bf10bc9519cb","color":"purple","value":"Post"},{"id":"374d2bc6-a144-4832-8ca4-474aaae0ea1f","color":"orange","value":"Page"}]},"d]hq":{"name":"slug","type":"text"},"sD^m":{"name":"tags","type":"multi_select","options":[{"id":"790180f1-0c2e-4730-a1ef-c5463df34680","color":"brown","value":"python"},{"id":"5d668f5e-7204-4c7e-b57e-5558bd27efaf","color":"gray","value":"pep"},{"id":"9081ab60-29ee-4a5b-9989-f50cf36ecb9b","color":"orange","value":"tech"},{"id":"c0225229-afab-45e4-b69b-b71029b39835","color":"red","value":"django"},{"id":"90084124-d1d5-49fb-86e7-4b133c051d81","color":"default","value":"orm"},{"id":"10ace7d0-10e6-4617-970e-acf2d9348d0f","color":"yellow","value":"best-practice"},{"id":"1b9671ca-93e5-402d-a73e-f9aca38e4358","color":"pink","value":"web"},{"id":"c7015bc7-2283-4b3d-8d19-3075724a10df","color":"blue","value":"blog"},{"id":"22d9ce60-f854-4122-b0fc-4f4c3a41979e","color":"green","value":"guide"},{"id":"6e99d746-1829-43e3-a828-214a1ae79b4a","color":"purple","value":"ELK"},{"id":"45ebe27a-5445-4cc3-91c9-ec1f1296dcf4","color":"brown","value":"pytest"},{"id":"9f679b83-f407-4130-b5b7-f969329300bf","color":"brown","value":"unittest"},{"id":"e30656d1-1ff2-434c-a2cb-8b3c75c9d1a1","color":"gray","value":"fun"},{"id":"5146a8a4-5647-4ce0-8a7b-1a6320adee06","color":"blue","value":"back-pressure"},{"id":"36828c03-3b80-417d-82a3-b1066ad5ca60","color":"green","value":"Dependency injection"},{"id":"9602332d-afbb-41e8-baed-bd0dd39a5e21","color":"brown","value":"k8s"},{"id":"82cd2499-ddd4-43ad-9298-fba21fe29cfa","color":"brown","value":"helm"},{"id":"f0a44444-e52d-4db2-9262-aa29d7ded8e3","color":"blue","value":"celery"},{"id":"a87e284b-1c48-422e-9811-eba8a167f97a","color":"red","value":"amqp"},{"id":"dc50dbb3-8e3a-4747-95d8-c9098e70e088","color":"default","value":"tcp"},{"id":"90b243e4-95f4-459e-b5b7-42f09020978b","color":"gray","value":"graphql"},{"id":"00f0130d-3a96-4e5a-8b5e-77e14e0a3ff7","color":"purple","value":"logstash"},{"id":"a921b879-fcef-4ace-8c96-7a6e11fe2358","color":"orange","value":"konajdk"},{"id":"b8e6dc68-925c-4d32-84d9-580d1a34c3a6","color":"orange","value":"regex"},{"id":"fc66930c-fa10-44b1-b553-5f6acc796321","color":"gray","value":"nfa"},{"id":"f9255cb2-7e85-4bce-8042-472643ff3b58","color":"orange","value":"dfa"},{"id":"e00a51c2-af1c-4bfd-a118-e83e73f3e1a3","color":"purple","value":"security"},{"id":"45105ec0-49be-430b-aead-ef83cfbc8b02","color":"pink","value":"reading"},{"id":"4c3a21fd-3ba5-44a2-8c5e-ef6e9100c32c","color":"brown","value":"software-engineering"},{"id":"4cd1d179-3466-4d7e-baf2-99a4c0250a78","color":"blue","value":"google"},{"id":"22973bbb-4038-4f9b-a30c-c0ab6506d65d","color":"gray","value":"note"},{"id":"1ca18016-ff4e-41e0-af37-6ea457fc4bd8","color":"orange","value":"go"},{"id":"017cb1fb-940d-4281-a078-ea653dc7688a","color":"green","value":"prometheus"},{"id":"35b57024-e3a6-465c-8845-e359d09c72c7","color":"brown","value":"udp"},{"id":"4357722b-be50-481e-ba42-992e73b7b86e","color":"pink","value":"observability"},{"id":"89d067fb-d3d3-4d3f-b855-5f472e28d80b","color":"orange","value":"profiling"},{"id":"74546b53-0289-4df1-8134-aa3fc41775c0","color":"pink","value":"surfing-records"}]},"wz|S":{"name":"summary","type":"text"},"title":{"name":"title","type":"title"},"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":{"name":"status","type":"select","options":[{"id":"22460321-fea2-4c7c-b352-a674760780ac","color":"orange","value":"Idea"},{"id":"41d5f5c6-b53c-42bc-8e0f-fc9402048480","color":"yellow","value":"Draft"},{"id":"c7390b31-9fab-4e21-94ee-7e67ea077a97","color":"blue","value":"Revise"},{"id":"7abc61d4-b405-480d-b699-12588755fa65","color":"red","value":"Published"}]}},"icon":"🗯️","format":{"copied_from_pointer":{"id":"6a42b751-ff40-4f34-aa6a-1830a3344cb7","table":"collection","spaceId":"ac4cb96d-c8f8-4040-9bb2-868d9fc7f526"},"collection_page_properties":[{"visible":false,"property":"NX\\Q"},{"visible":false,"property":"d]hq"},{"visible":false,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"visible":false,"property":"sD^m"},{"visible":false,"property":"wz|S"},{"visible":false,"property":"`gQ~"}]},"parent_id":"a6089909-2d0d-43ef-af93-5e041712e826","parent_table":"block","alive":true,"file_ids":["6cf3dc36-2f98-4f0e-9679-1bdbb1485129","5520bd92-e709-4c0d-ad58-06923f23f7e9","624d393a-62e3-4464-a1bf-1c79ecd4fbda","d52f6766-3e32-4c3d-8529-46e1f214360f"],"copied_from":"6a42b751-ff40-4f34-aa6a-1830a3344cb7","migrated":true,"space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6","deleted_schema":{"0d330ccb-d222-4440-a0de-6cccfe926a33":{"name":"url","type":"text"},"26ff3130-393a-45ac-92b5-7490d9b87515":{"name":"template","type":"select","options":[{"id":"V*ea","color":"purple","value":"post"}]},"29e679ed-47a3-46c2-9eb4-9070171591b8":{"name":"inList","type":"checkbox"},"2af12d30-97f0-4310-b38c-02e6a554245f":{"name":"publish","type":"checkbox"},"2bf55746-6864-4bb6-b585-77b81f140da1":{"name":"inList","type":"checkbox"},"487aab80-eb42-4dd6-a386-d58672ff59fa":{"name":"description","type":"text"},"53819e0d-5bc6-40de-a8bc-498fdf840fbc":{"name":"description","type":"text"},"67c34d44-b9f2-42c1-b35c-4a534c03bdd9":{"name":"inList","type":"checkbox"},"69fb2cd3-221c-476b-86c2-ab74f4490cc9":{"name":"template","type":"select","options":[{"id":"V*ea","color":"purple","value":"post"}]},"ab0a009c-1080-47c3-aecc-b26dc703a4e0":{"name":"url","type":"text"},"ad8f0878-e947-4188-8970-1ca14665f6e3":{"name":"inMenu","type":"checkbox"},"b2c6f9d4-31e2-4230-b57e-4bdb21a3d635":{"name":"template","type":"select","options":[{"id":"V*ea","color":"purple","value":"post"}]},"b387319f-5770-457e-8453-1d2f2708f9f1":{"name":"url","type":"text"},"b6d830ff-ce1d-4e76-a484-f0fc3f148c52":{"name":"publish","type":"checkbox"},"c0b15f23-eddd-4316-95d1-a92a4edbc710":{"name":"publish","type":"checkbox"},"e3660c02-9d93-463b-9495-addeeabd3e80":{"name":"description","type":"text"}}},"role":"reader"}},"space":{},"collection_view":{"065b98d2-d3b4-4dab-8b96-4eb118a3f311":{"value":{"id":"065b98d2-d3b4-4dab-8b96-4eb118a3f311","version":38,"type":"table","name":"Default view","format":{"table_wrap":false,"table_properties":[{"width":371,"visible":true,"property":"title"},{"width":243,"visible":true,"property":"d]hq"},{"width":159,"visible":true,"property":"NX\\Q"},{"width":147,"visible":true,"property":"wz|S"},{"width":356,"visible":true,"property":"sD^m"},{"width":124,"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"width":100,"visible":true,"property":"`gQ~"}]},"parent_id":"a6089909-2d0d-43ef-af93-5e041712e826","parent_table":"block","alive":true,"page_sort":["b1e1d645-db95-42e5-8995-39a80eda6460","e8cd3732-dc1c-43ae-959a-a5a611ec098a","e876558d-e878-47f6-8c95-21be678990a5","5a971ded-d3c5-41be-bef9-ddfff48d43a2","8db8b240-e1c5-4dd7-bf74-72584d7a2ce0","daf94ca4-ec56-47a3-84ed-b1e2479acc4b","d1a2db9b-6820-421e-9b80-017ce7478587","67ea9f83-b9f6-416b-afcb-7c64f7533e6c","45939470-9819-47e8-b12b-999cfefa0aad","c60dc33d-8efb-44be-a863-7a87ad047932","fe4b8d5f-7c49-42c6-a7d5-1cb71c4f7e86","b7233a67-c367-4198-831e-f12089568d1f","4f3bf306-92c4-41b7-a43e-957129a1240a","6a789607-66cf-498e-9b32-eb3fa69a84f4","c9429034-dabd-4a25-8782-97f20c808a60","38c49fe2-37f8-4a7f-a99f-9edb9ddad4c2","474eb638-9f6b-46bf-8004-77668293f199","81d6dfab-69cb-43a0-aa04-e9725f0b67e1","7703d956-84db-46cd-b538-48eae1af68b5","9f937c73-dac9-4ed7-9b01-beefcb321f16","3cf9dcb9-e7db-406c-80ab-c65c11fbf906","5827ab53-e051-455b-b90a-3bdc20158c2c","fa7acd3b-dea9-4fb1-b859-5345f35163c6","696dfc48-62c3-494d-96d0-ec5fa84637e8","79df93cf-9b10-452e-bc62-f39e8cd2d124","9bb8e52d-c459-4528-b1b3-c2378207253a","5da038ef-f419-4a11-aa48-587b3787e040","b4a2c9d4-6a2c-49e6-988d-89a538dfe0f6","c374a479-5cc7-4c54-ba69-6a4d76dc25ad","d470fa67-0e7c-40d8-86ac-9b5a8be88dc8","986be38b-9780-4bb9-bdcd-4e361ddbd888","b7613f56-c2d4-4aae-b967-b7471ade86d0","e357d1fc-7466-4d6a-8d48-71b76ea97cdc","e1735855-4089-4af6-bd4d-0d59f7a76cb4","9b34581a-955a-4229-99d0-8f2a6d0e69ce","b4414811-0599-45cf-b047-fa95eac42d89","c28a8a01-911a-40a2-a607-d3af8cb24017","461d07ae-4b4a-49de-bdcb-341af1153201","3df59023-cb68-4a65-afd1-7f0b8c21cb57","0e3223d1-03df-40fb-90f9-cc8559d776b5","4f45b7d6-cd5b-46ab-b2a6-37ae20bf5f21","fa475a21-5f38-43d4-9a89-67c40b3129ae","97cbc634-fe3a-4b9b-9da6-ac4aaa94772f","8a0d34bc-7e8c-4a68-88a5-5276274f612a","623f8788-a20f-45fd-bb82-08935f59b44d","7ee398f0-450b-47cb-9b53-f5e7736590d2","eae9f077-591e-4841-903b-db395513c834","367d0f2a-0b10-4dbb-b53a-613152f124f9","398e2e28-3997-49bc-a138-0467d4da8531","8aaf4633-e879-44dc-82c8-3c9fb9d3a6f8","1eb5e5f2-8dc9-4ffc-b5e1-09b67be27a83","83465fb9-205b-41fc-83a6-424692ee0a0e","fb1d18d0-6403-4e8a-840e-134553748ff5","4407cb77-3838-4ba5-b474-f15222cd3dba","1880b0f2-e036-42d0-9550-0fb08a962397","d8d60bd6-33f6-458f-a7d6-209ef2fb05a1","29bf65ff-888b-4a76-a8dd-bf54f02c3864","bad1d4ae-fd4a-4671-ae94-dd53d94e0eae","0d59792d-db1c-4ae7-8d7c-4f013be40dcf","337dc259-2805-4b1c-a60f-1b3e6c7badb8","4b1b21a8-c278-4bc6-88f1-1a35d407f4d7","7946aba2-d6d0-45ef-8779-23fa15db8f2d","c18dbce6-9e8c-4f4b-b74a-0994e7c1bc3f","84aa87b7-39e7-493c-87b9-5cae4de95449","1446eadb-8c01-4295-be3a-ecf19361c143","fe8a7d94-e9ba-457d-8f19-10fe53e6ca3c","98a5a0b6-b07b-4065-a73f-2949ad28ac47","099219ec-fb4b-459d-a538-f6c3d54f6ca2","e047becf-e696-42e3-84c9-4f6278c844ae","975051d4-ebbc-4b3f-98cf-1a52e5e4761d","e5d98bee-b2d5-4b45-ab0b-b77da24aebe7","acac2668-1062-4e7a-b095-eda067da8413","179025c4-d8a8-4c47-b621-9fd6a6f3339b","d256e5ed-5eac-43bb-a32e-581774962c23","b843dacf-b655-4b1c-a61c-434b67f18154","56a80c2d-0520-415a-a77a-1db82eff0b3a","9c40a253-b9e8-42cd-8a99-62aaa9789a5e","d3a05020-0948-489a-80ac-fedebc035c58","0ee4f3e9-0451-411f-b903-0c83d30e5b67","769f1163-e45e-4c3b-87a7-3b551895d9be","7e217dcd-e4e5-4bcd-b2de-00fcb5ab7fba","28e3d2f6-abb8-4711-b21e-ce1937e3e546","04d4f00b-9608-4d83-949e-b32313ace34e","41f93fa3-0496-4ea7-8ac3-0a8beaf346da","f0db9e3e-0e99-4465-ae65-6a9a8d8a6468","279e794f-519c-44f5-ab04-422fba916b72","f0b2f8a5-7dfd-48dc-ba1f-419a7fda1fff","e874f269-1938-40be-974b-2e499c1f4590","65265d92-050f-4fb5-b529-a514079cdd83","5fc98358-411a-40d7-a5d0-c4089026ca1f","15fcd77a-6097-4ee9-9835-9d6e85897fd6","6f8b1275-2d88-40e2-b76b-375f3c028b03","33273042-efcc-45bc-8f28-b65a1c2c65ad","c18bd396-be21-4ce2-ab22-32a45c28e37f","ba597bcf-7582-4fd2-8049-6333ef3e4453","4edecef8-106d-489d-be1d-d1b528c4cdc9","b03b3109-e900-4daf-b852-a590324ab747","8cba5326-9daa-4c2c-b763-5476dc8a7a91","9ab4aa63-ce81-415f-bf95-e632006a1aea","e3644bfb-4244-4a82-a7d7-d7cdb65aa1ed","b6a1f5b5-febd-4c26-9e29-520290eb5719","51e53e64-e6dd-4fd6-8062-5d4455f0a1cb","f4ec684b-e5f1-44e9-a8a7-aca27f7ca6f3","177fa228-9099-4dd5-8969-c67f9c78bd0c","d5ab0d7a-0123-473f-84d4-81740defb9b4","548f6d36-c509-4b79-9c4b-59f227c7f550","c0901673-4f5e-4e51-ad87-0217f2d33a0c","0787f8d6-dc99-47c6-946e-2b008814bebc","0ade5216-1103-486a-aff0-a709ff825b02","a2c4dd21-985c-497d-b421-c2d8a9ec0eeb","908a498c-f7e3-4668-8afd-f179a027b4d9","4945e5c3-033d-467c-a8b3-b1479c1fdf0a","854f4584-28d5-43bd-938e-88d0957c78e3","6a6574f8-d63d-4fed-99c5-38f3df0364ac","5639d091-037c-4284-8260-ade765dbbc90","c9669745-2229-4d95-89a1-8f008e8bebc6","78ebe658-6ba5-4478-a53c-ad468984e7e3","c7f44558-498f-44bd-a8a3-504955dde6b1","d928387b-107b-4f27-b0c5-75301ed7fc55","833556aa-d685-488c-88d0-b136b456ff5f","0bfe1b9e-b115-49f4-9279-7b106f7661af","1465efce-6026-4d50-a952-1aff8c10dea1","f8f308d6-f4c4-4b0f-b7a3-df78d41ce55d","ebd71155-4a59-46a0-bbb2-40687ddbcf9d","29fc49e0-b597-4f2e-9d53-b7dd247adf4b","692194e6-08d3-4e36-a94f-dc403d6226e6","da9db882-26ea-4516-815c-75f2f9ddab59","9a08823e-eec6-4cc0-9ec8-890cb0650aa7","f7327b98-b06a-423a-8b9f-646e5ba2123f","a6c3c98f-9ef9-45de-9d52-4baec7327464","9d18b689-cdc2-4d3f-81da-a690c700caee","6ad26f7b-1828-4d64-a948-3cc6367f6901","3927ece3-9931-46e8-8e7e-91d5e0b5c326","f6ba5dfd-5000-4e15-80b4-7d3456bc676a","0c0d5bfd-8642-460a-aedc-5a8277725196","3dd5dfcc-005c-49b5-9cca-96ccded25899","9faa9c16-825a-40c0-898f-7b9f31c30722","4bdc3c4d-327e-49bf-8792-760253dfed83","ff7b6fa3-510b-4ba1-9caa-9f8b4771a90e","fd036365-88c0-4feb-8482-6b4298cacdcc"],"query2":{"filter":{"operator":"and"},"aggregations":[{"property":"title","aggregator":"count"}]},"space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"}},"notion_user":{},"collection_query":{},"signed_urls":{"528e7c59-ad7b-425d-a0b5-0d7e0cb42543":"https://file.notion.so/f/s/c55eecdf-b786-4a27-8d0a-af5a9f355d59/Untitled.png?id=528e7c59-ad7b-425d-a0b5-0d7e0cb42543\u0026table=block\u0026spaceId=b0a64676-90b9-4734-9c63-2d704ee573b6\u0026expirationTimestamp=1686129269810\u0026signature=LoeLzua3EOfuihEcxRkpsI6-g9-3u7I1r0ySbCW2k10","33e420b7-be02-4b7b-83d8-9f71d509cc1f":"https://file.notion.so/f/s/ff54b1b7-4b7d-4054-9a17-0e073d4820bb/Untitled.png?id=33e420b7-be02-4b7b-83d8-9f71d509cc1f\u0026table=block\u0026spaceId=b0a64676-90b9-4734-9c63-2d704ee573b6\u0026expirationTimestamp=1686129269810\u0026signature=8fetlCpK0bgMYyGWUgrknEeJRTHxg7lPzHdAXojYj28","d50702a4-ca42-4507-b96e-4bbbebdecdd8":"https://file.notion.so/f/s/b20f6619-c30b-4392-85ae-fd16c4ca5296/Untitled.png?id=d50702a4-ca42-4507-b96e-4bbbebdecdd8\u0026table=block\u0026spaceId=b0a64676-90b9-4734-9c63-2d704ee573b6\u0026expirationTimestamp=1686129269810\u0026signature=DSndmHhRAHwfomZtQCfdPIZYldK7uB8X0d4UubPixUg"}},"emailHash":"d54f099771ff5f17709b76693f693e2e"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"filebeat-hangs-problem.html"},"buildId":"whNozGoNnKrTnthLemfFf","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>