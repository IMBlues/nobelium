<!DOCTYPE html><html lang="zh-CN"><head><meta name="viewport" content="width=device-width"/><title>几分钟搞清 Django 静态文件处理</title><meta name="robots" content="follow, index"/><meta charSet="UTF-8"/><meta name="keywords" content="Blog, Notion, Tech, Python, Django"/><meta name="description" content="几分钟就能拿捏"/><meta property="og:locale" content="zh-CN"/><meta property="og:title" content="几分钟搞清 Django 静态文件处理"/><meta property="og:description" content="几分钟就能拿捏"/><meta property="og:url" content="https://next.emergencyexit.xyz/"/><meta property="og:image" content="https://og-image-craigary.vercel.app/%E5%87%A0%E5%88%86%E9%92%9F%E6%90%9E%E6%B8%85%20Django%20%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:description" content="几分钟就能拿捏"/><meta name="twitter:title" content="几分钟搞清 Django 静态文件处理"/><meta name="twitter:image" content="https://og-image-craigary.vercel.app/%E5%87%A0%E5%88%86%E9%92%9F%E6%90%9E%E6%B8%85%20Django%20%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg"/><meta property="article:published_time"/><meta property="article:author" content="bluesyu"/><meta name="next-head-count" content="18"/><link rel="preload" href="/fonts/IBMPlexSansVar-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/fonts/IBMPlexSansVar-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="preload" as="style" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/><noscript><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/></noscript><link rel="icon" href="/favicon.svg" type="image/svg+xml"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="192x192" href="/apple-touch-icon.png"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/feed"/><meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)"/><meta name="theme-color" content="#18181B" media="(prefers-color-scheme: dark)"/><link rel="preload" href="/_next/static/css/8e8bd7c50b2739f5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e8bd7c50b2739f5.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6a5815369e10547f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6a5815369e10547f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-c0a56147c8fcef8f.js" defer=""></script><script src="/_next/static/chunks/main-e557dee8cfeafd6c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-44e7ae44283f015e.js" defer=""></script><script src="/_next/static/chunks/b5f2ed29-08db60af0c3043ba.js" defer=""></script><script src="/_next/static/chunks/684-63c1a25e215d8bed.js" defer=""></script><script src="/_next/static/chunks/580-c0214944b9e37cce.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-36397aa552609343.js" defer=""></script><script src="/_next/static/7HSpc6BccLfWKhMTsSEm6/_buildManifest.js" defer=""></script><script src="/_next/static/7HSpc6BccLfWKhMTsSEm6/_ssgManifest.js" defer=""></script><script src="/_next/static/7HSpc6BccLfWKhMTsSEm6/_middlewareManifest.js" defer=""></script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"/></head><body class="bg-day dark:bg-night"><div id="__next" data-reactroot=""><div><div class="wrapper font-sans"><div class="observer-element h-4 md:h-12"></div><div class="sticky-nav m-auto w-full h-6 flex flex-row justify-between items-center mb-2 md:mb-12 py-8 bg-opacity-60 max-w-3xl px-4" id="sticky-nav"><div class="flex items-center"><a aria-label="布鲁斯鱼的妙想天开" href="/"><div class="h-6"><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="14" cy="14" r="14" class="fill-current text-black dark:text-white"></circle><circle cx="14" cy="14" r="14" fill="url(#paint0_radial)"></circle><circle cx="8" cy="8" r="2" fill="white"></circle><defs><radialGradient id="paint0_radial" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="rotate(45) scale(39.598)"><stop stop-color="#7FF72A" stop-opacity="1"></stop><stop offset="1" stop-color="#001FCC" stop-opacity="0.1"></stop></radialGradient></defs></svg></div></a><p class="ml-2 font-medium text-day dark:text-night header-name">几分钟搞清 Django 静态文件处理</p></div><div class="flex-shrink-0"><ul class="flex flex-row"><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/about">关于</a></li><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/tag/surfing">冲浪</a></li><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/search">搜索</a></li></ul></div></div><main class="m-auto flex-grow w-full transition-all max-w-3xl px-4"><article><h1 class="font-bold text-3xl text-black dark:text-white">🤌<!-- --> <!-- -->几分钟搞清 Django 静态文件处理</h1><nav class="flex mt-7 items-start text-gray-500 dark:text-gray-400"><div class="flex mb-4"><a href="https://twitter.com/bluesedenyu" class="flex"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2724%27%20height=%2724%27/%3e"/></span><img alt="bluesyu" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="bluesyu" srcSet="https://gravatar.com/avatar/d54f099771ff5f17709b76693f693e2e?imwidth=32 1x, https://gravatar.com/avatar/d54f099771ff5f17709b76693f693e2e?imwidth=48 2x" src="https://gravatar.com/avatar/d54f099771ff5f17709b76693f693e2e?imwidth=48" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full" loading="lazy"/></noscript></span><p class="ml-2 md:block">bluesyu</p></a><span class="block"> / </span></div><div class="mr-2 mb-4 md:ml-0">2023 年 11 月 13 日</div><div class="flex flex-nowrap max-w-full overflow-x-auto article-tags"><a href="/tag/python"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">python</p></a><a href="/tag/django"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">django</p></a></div></nav><div class="-mt-4"><main class="notion light-mode notion-page notion-block-287065e69c7e44b6ac5cbd2fc390ce56"><div class="notion-viewport"></div><div class="notion-collection-row"><div class="notion-collection-row-body"><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M10.889 5.5H3.11v1.556h7.778V5.5zm1.555-4.444h-.777V0H10.11v1.056H3.89V0H2.333v1.056h-.777c-.864 0-1.548.7-1.548 1.555L0 12.5c0 .856.692 1.5 1.556 1.5h10.888C13.3 14 14 13.356 14 12.5V2.611c0-.855-.7-1.555-1.556-1.555zm0 11.444H1.556V3.944h10.888V12.5zM8.556 8.611H3.11v1.556h5.445V8.61z"></path></svg><div class="notion-collection-column-title-body">date</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-date">Nov 13, 2023</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">slug</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text">django-static-quick-glance</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">status</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"><div class="notion-property-select-item notion-item-red">Published</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M4 3a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zM2 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2z"></path></svg><div class="notion-collection-column-title-body">tags</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-multi_select"><div class="notion-property-multi_select-item notion-item-brown">python</div><div class="notion-property-multi_select-item notion-item-red">django</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">summary</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text">几分钟就能拿捏</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">type</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"><div class="notion-property-select-item notion-item-purple">Post</div></span></div></div></div></div><div class="notion-text notion-block-fb1adfbb5fc043f0bb659f003d7e79db">Django 处理静态文件有一套 Static 机制，它是简单的，但有时又是烦人的。</div><div class="notion-text notion-block-3d0fb2bb585e4b819432049516863a2d">首先，啥是静态文件？<b>不需要服务端计算，直接页面上请求拉取的文件：图片、视频、html、JS、CSS 等等。</b>理论上来说，既然不需要计算，那实际上和 Python 也没啥必然联系了，所以 Django 在这里的职责就是<b>“帮忙托管一下”。</b></div><div class="notion-text notion-block-066b572227164bef8cd07f81ef57346c">说是帮忙，是因为托管静态文件这件事本来就有更专业的组件负责，比如 Nginx、CDN 等等。</div><h4 class="notion-h notion-h3 notion-h-indent-0 notion-block-9fca2a2ba7774b34898df4044200946d" data-id="9fca2a2ba7774b34898df4044200946d"><span><div id="9fca2a2ba7774b34898df4044200946d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#9fca2a2ba7774b34898df4044200946d" title="DEBUG 一时爽"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">DEBUG 一时爽</span></span></h4><div class="notion-text notion-block-5d149e7a927140699dd30235b1a56a8b">如果你还在本地开发阶段，可能觉得下面的内容都挺奇怪，明明不用额外配置就能访问所有静态文件。是的，当 <code class="notion-inline-code">DEBUG=True</code> 的时候，Django 基本都帮你包办了，托管给 WhiteNoise 也会自动刷新静态文件。但如果放到生产，Django 就不再帮忙了，WhiteNoise 也只在程序启动时加载时，以下的内容就需要你自己梳理清楚了。</div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-9e48e098a0d64efbbe1b6594e2eb4a86" data-id="9e48e098a0d64efbbe1b6594e2eb4a86"><span><div id="9e48e098a0d64efbbe1b6594e2eb4a86" class="notion-header-anchor"></div><a class="notion-hash-link" href="#9e48e098a0d64efbbe1b6594e2eb4a86" title="Django 怎么代管"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Django 怎么代管</span></span></h3><div class="notion-text notion-block-b8e395b96de14f13a20baff2c0ca7088">所谓的帮忙代管，总结起来就是三个步骤：</div><ol start="1" class="notion-list notion-list-numbered notion-block-3ff46fcb999347c6a6e5fdf634124613"><li>你要告诉 Django：来自各个不同来源的静态文件分别放在什么位置，比如 Django 模版、前后端分离时的前端独立工程、项目外的视频图片等等。（对应 Django 配置 <code class="notion-inline-code">STATICFILES_DIRS</code> ）</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-e4197934ca664e0da629119ffba45946"><li>你要告诉 Django：最终你想把这些静态文件放到什么位置，这个位置可以就是<b>专业组件</b>能找到的位置。（对应 Django 配置 <code class="notion-inline-code">STATIC_ROOT</code> ）</li></ol><ol start="3" class="notion-list notion-list-numbered notion-block-9b733985876e46768eacf3bcbd774a5c"><li>执行 Django 命令： <code class="notion-inline-code">python manage.py collectstatic</code> ，Django 会忠实地按照你提供的信息把分散的静态文件收集放到同一个位置。</li></ol><div class="notion-text notion-block-c2f50d76b0e14011bac064371152bc7b">这三步搞定，Django 静态文件就处理完了，<b>这些文件怎么被访问到，那就是专业组件的事情了</b>。好奇宝宝们肯定有很多问题想问 Django：</div><ul class="notion-list notion-list-disc notion-block-921db843be1f47b2bb623750887a855d"><li>静态文件来源五花八门，怎么处理？</li><ul class="notion-list notion-list-disc notion-block-921db843be1f47b2bb623750887a855d"><li><code class="notion-inline-code">STATICFILES_FINDERS</code> 实现自定义<code class="notion-inline-code">FINDER</code> 逻辑</li></ul></ul><ul class="notion-list notion-list-disc notion-block-758926ffca47473eb77ecc4c6ccacc28"><li>静态文件怎么直接放云上 CDN 里去？或者远端 Nginx ？</li><ul class="notion-list notion-list-disc notion-block-758926ffca47473eb77ecc4c6ccacc28"><li><code class="notion-inline-code">STATICFILES_STORAGE</code> 实现自定义 <code class="notion-inline-code">STORAGE</code> 逻辑</li></ul></ul><div class="notion-text notion-block-203734e778504410a5aabafb7f33e671">回答完这些问题，<em>Django 双手一摊：“静态文件没我的事了吧” </em>🤷‍♂️。</div><div class="notion-text notion-block-0e5c25513ec142168e672ed4915ad1c8"><b>等等，你这个机灵鬼，我还没说完呢。</b></div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-9f7161e115704552a860cd3167197721" data-id="9f7161e115704552a860cd3167197721"><span><div id="9f7161e115704552a860cd3167197721" class="notion-header-anchor"></div><a class="notion-hash-link" href="#9f7161e115704552a860cd3167197721" title="让 Django 多管点“闲事”"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">让 Django 多管点“闲事”</span></span></h3><div class="notion-text notion-block-efc7a28e7b6d47fda3a2b7d0c86709c2">对于请求量大、地域来源广的服务，将站点的静态文件放到<b>专业组件</b>托管肯定是更好的选择。但有时候我们也需要部署一些体量不大应用——例如一些在公司内部服务的中型 SaaS，这时候把静态文件分离管理反而会增加流程和架构的复杂性（除非有非常完善的基建支持），仅仅是负责静态文件的分发是远远不够的，<b>所以使用 Django 代理静态文件的请求也是很多生产环境的选择。</b></div><div class="notion-text notion-block-d61a6f41ed50409aa9b8e04898c0fbf0">那么谁来做这部份工作呢？<b>专业组件</b>的工作 Django 看了直摆手，这时，【<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://github.com/evansd/whitenoise">白噪声</a>同志】应声而来。</div><div class="notion-text notion-block-ec3f8f321480465d88699d39bf0fd7c5">在安装 WhiteNoise 之后，它将在你的服务内部帮忙 <code class="notion-inline-code">serve</code> 静态文件，代理这些文件的请求以及相关的事务处理（压缩、缓存等等）。相关配置直接看<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://whitenoise.readthedocs.io/en/stable/">官方文档</a>就好，这里就不赘述了。</div><div class="notion-text notion-block-b1b4c956d1f448448865ec62ab5d615f">这么看起来，问题好像就直接解决了？<b>等等，烦人的东西才刚来。</b></div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-e0c442a243944408bb813f7985a39afe" data-id="e0c442a243944408bb813f7985a39afe"><span><div id="e0c442a243944408bb813f7985a39afe" class="notion-header-anchor"></div><a class="notion-hash-link" href="#e0c442a243944408bb813f7985a39afe" title="烦人的子路径问题"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">烦人的子路径问题</span></span></h3><div class="notion-text notion-block-79495554294d45cdb0d4a7a5275f3a18">刚才通过 WhiteNoise 模块，已经将静态文件的访问入口收归到 Django 服务中了，理想状态下，直接访问 <code class="notion-inline-code">https://amazing-fake-app/static/</code> （通过 Django <code class="notion-inline-code">STATIC_URL</code> 确定访问路径）就能寻找到收集好的静态文件了。</div><div class="notion-text notion-block-3cf98af760704b24b74ae6d1c9e49f36">但是很多时候我们的服务并不是直接暴露在域名下的，往往会有“访问路径”作为前缀，例如服务本身访问：<code class="notion-inline-code">https://amazing-fake-app/foo/</code> ，这时如果保持原来的 <code class="notion-inline-code">STATIC_URL=&#x27;/static&#x27;</code> <b>很有可能就有问题</b>。看起来这应该是 Django 应该处理的东西，为什么会有问题呢？</div><div class="notion-text notion-block-d3eddfc60c824c65b300021af8530e9a">首先， <code class="notion-inline-code">/foo/</code> 通常是由外部接入层（例如 Nginx ）转发提供的，Django 理论上是可以感知到它的存在：</div><pre class="notion-code language-python"><code class="language-python">def <span class="token function">get_script_name</span><span class="token punctuation">(</span>environ<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token string">""</span>"
    Return the equivalent <span class="token keyword">of</span> the <span class="token constant">HTTP</span> request's <span class="token constant">SCRIPT_NAME</span> environment
    variable<span class="token punctuation">.</span> If Apache mod_rewrite is used<span class="token punctuation">,</span> <span class="token keyword">return</span> what would have been
    the script name prior to any <span class="token function">rewriting</span> <span class="token punctuation">(</span>so it's the script name <span class="token keyword">as</span> seen
    from the client's perspective<span class="token punctuation">)</span><span class="token punctuation">,</span> unless the <span class="token constant">FORCE_SCRIPT_NAME</span> setting is
    <span class="token function">set</span> <span class="token punctuation">(</span>to anything<span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token string">""</span>"
    <span class="token keyword">if</span> settings<span class="token punctuation">.</span><span class="token constant">FORCE_SCRIPT_NAME</span> is not None<span class="token operator">:</span>
        <span class="token keyword">return</span> settings<span class="token punctuation">.</span><span class="token constant">FORCE_SCRIPT_NAME</span>

    # If Apache's mod_rewrite had a whack at the <span class="token constant">URL</span><span class="token punctuation">,</span> Apache <span class="token keyword">set</span> either
    # <span class="token constant">SCRIPT_URL</span> or <span class="token constant">REDIRECT_URL</span> to the full resource <span class="token constant">URL</span> before applying any
    # rewrites<span class="token punctuation">.</span> Unfortunately not every Web <span class="token function">server</span> <span class="token punctuation">(</span>lighttpd<span class="token operator">!</span><span class="token punctuation">)</span> passes <span class="token keyword">this</span>
    # information through all the time<span class="token punctuation">,</span> so <span class="token constant">FORCE_SCRIPT_NAME</span><span class="token punctuation">,</span> above<span class="token punctuation">,</span> is still
    # needed<span class="token punctuation">.</span>
    script_url <span class="token operator">=</span> <span class="token function">get_bytes_from_wsgi</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> <span class="token string">'SCRIPT_URL'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> or <span class="token function">get_bytes_from_wsgi</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> <span class="token string">'REDIRECT_URL'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token literal-property property">script_url</span><span class="token operator">:</span>
        <span class="token keyword">if</span> b<span class="token string">'//'</span> <span class="token keyword">in</span> <span class="token literal-property property">script_url</span><span class="token operator">:</span>
            # mod_wsgi squashes multiple successive slashes <span class="token keyword">in</span> <span class="token constant">PATH_INFO</span><span class="token punctuation">,</span>
            # <span class="token keyword">do</span> the same <span class="token keyword">with</span> script_url before manipulating <span class="token function">paths</span> <span class="token punctuation">(</span>#<span class="token number">17133</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            script_url <span class="token operator">=</span> _slashes_re<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>b<span class="token string">'/'</span><span class="token punctuation">,</span> script_url<span class="token punctuation">)</span>
        path_info <span class="token operator">=</span> <span class="token function">get_bytes_from_wsgi</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> <span class="token string">'PATH_INFO'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        script_name <span class="token operator">=</span> script_url<span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">-</span><span class="token function">len</span><span class="token punctuation">(</span>path_info<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">if</span> path_info <span class="token keyword">else</span> script_url
    <span class="token keyword">else</span><span class="token operator">:</span>
        script_name <span class="token operator">=</span> <span class="token function">get_bytes_from_wsgi</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> <span class="token string">'SCRIPT_NAME'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> script_name<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="notion-text notion-block-4172af91379f405ab9049d787593ad0e">可以看到 Django 一共可以在三个地方感知到子路径的存在：</div><ul class="notion-list notion-list-disc notion-block-f97e7309f84a45d195c05ddf937f2e7b"><li>用户直接通过 <code class="notion-inline-code">FORCE_SCRIPT_NAME</code> 手动设置</li></ul><ul class="notion-list notion-list-disc notion-block-41697591774a4f9a94b3a59936dc60d8"><li>从 wsgi 信息中获取 <code class="notion-inline-code">SCRIPT_URL</code> 或 <code class="notion-inline-code">REDIRECT_URL</code> ，再转换成 <code class="notion-inline-code">SCRIPT_NAME</code></li></ul><ul class="notion-list notion-list-disc notion-block-1ca246665e2b44e485811cc765343ee0"><li>从 wsgi 信息中获取 <code class="notion-inline-code">SCRIPT_NAME</code> </li></ul><div class="notion-text notion-block-79ccb6bc4c3a460b8560fda2cb70c506">第一个手动设置的我们先不讨论；第二个在代码和注释中说的很清楚了：特定的接入层（例如 Apache ）会稳定提供，但不一定能保证；第三个看起来是缺省的获取方法，理论上它应该能覆盖大部份场景才对。</div><div class="notion-text notion-block-b1acc55257b04eefa5ea82736df77492">然而，假如你的接入层是广泛使用的 Nginx，缺省方法就有问题了：<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://nginx.org/en/docs/http/ngx_http_core_module.html#underscores_in_headers">默认地，Nginx 并不支持在 HTTP Header 中使用包含下划线的变量</a>，也就说 <code class="notion-inline-code">SCRIPT_NAME</code> 默认不合法。</div><ul class="notion-list notion-list-disc notion-block-7e387bdd3b394a1d968628ef37aea0ce"><li>如果你可以修改接入层的配置：可以手动调整 <code class="notion-inline-code">underscores_in_headers</code> 的配置，但不幸的是，Nginx 还有个默认的行为，给 Header 添加 <code class="notion-inline-code">HTTP_</code> ，也就是只能通过变量 <code class="notion-inline-code">HTTP_SCRIPT_NAME</code> 获取，Django 再次 Miss。你可以进一步地修改 Nginx 配置，直接手动添加<code class="notion-inline-code">SCRIPT_NAME</code> ：`<code class="notion-inline-code">uwsgi_param SCRIPT_NAME $http_script_name;</code></li></ul><ul class="notion-list notion-list-disc notion-block-ecea1b40880740ae98d2c1934dde482c"><li>如果你不能手动修改接入层的配置：刚才略过的手动设置 <code class="notion-inline-code">FORCE_SCRIPT_NAME</code> 就派上用场了，手动添加上 <code class="notion-inline-code">FORCE_SCRIPT_NAME=/foo/</code></li></ul><div class="notion-text notion-block-75d31c5f071040aba07d35fee4956051">当然你可以在 Django wsgi 加载时做一个动态的配置，确保接入层的变更能及时更新到配置中：</div><pre class="notion-code language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">DynamicScriptNameWSGIHandler</span><span class="token punctuation">(</span>WSGIHandler<span class="token punctuation">)</span><span class="token operator">:</span>
    def <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token operator">:</span>
        # <span class="token constant">HTTP_X_SCRIPT_NAME</span><span class="token punctuation">(</span>from Nginx<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token constant">SCRIPT_NAME</span><span class="token punctuation">(</span>Django wsgi<span class="token punctuation">)</span>
        script_name <span class="token operator">=</span> environ<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'HTTP_X_SCRIPT_NAME'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> script_name is not None<span class="token operator">:</span>
            environ<span class="token punctuation">[</span><span class="token string">'SCRIPT_NAME'</span><span class="token punctuation">]</span> <span class="token operator">=</span> script_name
            settings<span class="token punctuation">.</span><span class="token constant">FORCE_SCRIPT_NAME</span> <span class="token operator">=</span> settings<span class="token punctuation">.</span><span class="token constant">SITE_URL</span> <span class="token operator">=</span> <span class="token string">'%s/'</span> <span class="token operator">%</span> script_name

        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">__call__</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span></code></pre><div class="notion-text notion-block-6f01f523d0a740e7b6c1c4a161c12928">至此，静态文件处理的流程就很清楚了，挺简单的一件事，就几分钟搞定，打完收工。</div></main></div></article><div class="flex justify-between font-medium text-gray-500 dark:text-gray-400"><a><button class="mt-2 cursor-pointer hover:text-black dark:hover:text-gray-100">← <!-- -->返回</button></a><a><button class="mt-2 cursor-pointer hover:text-black dark:hover:text-gray-100">↑ <!-- -->回到顶部</button></a></div><div></div></main><div class="mt-6 flex-shrink-0 m-auto w-full text-gray-500 dark:text-gray-400 transition-all max-w-3xl px-4"><hr class="border-gray-200 dark:border-gray-600"/><div class="my-4 text-sm leading-6"><div class="flex align-baseline justify-between flex-wrap"><p>© <!-- -->bluesyu<!-- --> <!-- -->2019 - 2023</p><p>powered by <a href="https://github.com/craigary/nobelium"><u>nobelium</u></a></p></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","date":{"start_date":"2023-11-13"},"type":["Post"],"slug":"django-static-quick-glance","tags":["python","django"],"summary":"几分钟就能拿捏","title":"几分钟搞清 Django 静态文件处理","status":["Published"],"createdTime":"Tue Jul 25 2023 03:43:29 GMT+0000 (Coordinated Universal Time)","fullWidth":false,"pageIcon":"🤌","pageCover":null},"blockMap":{"block":{"287065e6-9c7e-44b6-ac5c-bd2fc390ce56":{"value":{"id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","version":569,"type":"page","properties":{"NX\\Q":[["‣",[["d",{"type":"date","start_date":"2023-11-13"}]]]],"`gQ~":[["Post"]],"d]hq":[["django-static-quick-glance"]],"sD^m":[["python,django"]],"wz|S":[["几分钟就能拿捏"]],"title":[["几分钟搞清 Django 静态文件处理"]],"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":[["Published"]]},"content":["fb1adfbb-5fc0-43f0-bb65-9f003d7e79db","3d0fb2bb-585e-4b81-9432-049516863a2d","066b5722-2716-4bef-8cd0-7f81ef57346c","9fca2a2b-a777-4b34-898d-f4044200946d","5d149e7a-9271-4069-9dd3-0235b1a56a8b","9e48e098-a0d6-4efb-be1b-6594e2eb4a86","b8e395b9-6de1-4f13-a20b-aff2c0ca7088","3ff46fcb-9993-47c6-a6e5-fdf634124613","e4197934-ca66-4e0d-a629-119ffba45946","9b733985-876e-4676-8eac-f3bcbd774a5c","c2f50d76-b0e1-4011-bac0-64371152bc7b","921db843-be1f-47b2-bb62-3750887a855d","758926ff-ca47-473e-b77e-cc4c6ccacc28","203734e7-7850-4410-a5aa-bafb7f33e671","0e5c2551-3ec1-4216-8e67-2ed4915ad1c8","9f7161e1-1570-4552-a860-cd3167197721","efc7a28e-7b6d-47fd-a3a2-b7d0c86709c2","d61a6f41-ed50-409a-a9b8-e04898c0fbf0","ec3f8f32-1480-465d-8869-9d39bf0fd7c5","b1b4c956-d1f4-4844-8865-ec62ab5d615f","e0c442a2-4394-4408-bb81-3f7985a39afe","79495554-294d-45cd-b0d4-a7a5275f3a18","3cf98af7-6070-4b24-b74a-e6d1c9e49f36","d3eddfc6-0c82-4c65-b300-021af8530e9a","df4c870f-9802-4657-9820-3728512adb9b","4172af91-379f-405a-b904-9d787593ad0e","f97e7309-f84a-45d1-95c0-5ddf937f2e7b","41697591-774a-4f9a-94b3-a59936dc60d8","1ca24666-5e2b-44e4-8581-1cc765343ee0","79ccb6bc-4c3a-460b-8560-fda2cb70c506","b1acc552-57b0-4eef-a5ea-82736df77492","7e387bdd-3b39-4a1d-9686-28ef37aea0ce","ecea1b40-8807-40ae-98d2-c1934dde482c","75d31c5f-0710-40ab-a07d-35fee4956051","357df011-825e-4e68-ad5f-80ba5928527f","6f01f523-d0a7-40e7-b6c1-c4a161c12928"],"format":{"page_icon":"🤌","page_cover_position":0.6},"created_time":1690256609053,"last_edited_time":1699856746740,"parent_id":"e34bec60-9b02-4ad8-aaf8-83369409cc9f","parent_table":"collection","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"a6089909-2d0d-43ef-af93-5e041712e826":{"value":{"id":"a6089909-2d0d-43ef-af93-5e041712e826","version":124,"type":"collection_view_page","view_ids":["065b98d2-d3b4-4dab-8b96-4eb118a3f311"],"collection_id":"e34bec60-9b02-4ad8-aaf8-83369409cc9f","format":{"block_locked":false,"block_locked_by":"2c0e0b01-f59e-4e03-b7b6-7d706eecada3","collection_pointer":{"id":"e34bec60-9b02-4ad8-aaf8-83369409cc9f","table":"collection","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"copied_from_pointer":{"id":"adc3552c-fc73-442a-b504-8d4b1eb0079a","table":"block","spaceId":"ac4cb96d-c8f8-4040-9bb2-868d9fc7f526"}},"permissions":[{"role":"editor","type":"user_permission","user_id":"f594524b-0941-4aea-99a2-9b9304033287"},{"role":"reader","type":"public_permission","added_timestamp":1666006306008}],"created_time":1665993658476,"last_edited_time":1694487152146,"parent_id":"b0a64676-90b9-4734-9c63-2d704ee573b6","parent_table":"space","alive":true,"copied_from":"adc3552c-fc73-442a-b504-8d4b1eb0079a","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"fb1adfbb-5fc0-43f0-bb65-9f003d7e79db":{"value":{"id":"fb1adfbb-5fc0-43f0-bb65-9f003d7e79db","version":5,"type":"text","properties":{"title":[["Django 处理静态文件有一套 Static 机制，它是简单的，但有时又是烦人的。"]]},"created_time":1690256656380,"last_edited_time":1699606359111,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"3d0fb2bb-585e-4b81-9432-049516863a2d":{"value":{"id":"3d0fb2bb-585e-4b81-9432-049516863a2d","version":770,"type":"text","properties":{"title":[["首先，啥是静态文件？"],["不需要服务端计算，直接页面上请求拉取的文件：图片、视频、html、JS、CSS 等等。",[["b"]]],["理论上来说，既然不需要计算，那实际上和 Python 也没啥必然联系了，所以 Django 在这里的职责就是"],["“帮忙托管一下”。",[["b"]]]]},"created_time":1699605492256,"last_edited_time":1699606066827,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"066b5722-2716-4bef-8cd0-7f81ef57346c":{"value":{"id":"066b5722-2716-4bef-8cd0-7f81ef57346c","version":1548,"type":"text","properties":{"title":[["说是帮忙，是因为托管静态文件这件事本来就有更专业的组件负责，比如 Nginx、CDN 等等。"]]},"created_time":1699606068795,"last_edited_time":1699606514921,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"9fca2a2b-a777-4b34-898d-f4044200946d":{"value":{"id":"9fca2a2b-a777-4b34-898d-f4044200946d","version":20,"type":"sub_sub_header","properties":{"title":[["DEBUG 一时爽"]]},"created_time":1699856416313,"last_edited_time":1699856420347,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"5d149e7a-9271-4069-9dd3-0235b1a56a8b":{"value":{"id":"5d149e7a-9271-4069-9dd3-0235b1a56a8b","version":54,"type":"text","properties":{"title":[["如果你还在本地开发阶段，可能觉得下面的内容都挺奇怪，明明不用额外配置就能访问所有静态文件。是的，当 "],["DEBUG=True",[["c"]]],[" 的时候，Django 基本都帮你包办了，托管给 WhiteNoise 也会自动刷新静态文件。但如果放到生产，Django 就不再帮忙了，WhiteNoise 也只在程序启动时加载时，以下的内容就需要你自己梳理清楚了。"]]},"format":{"copied_from_pointer":{"id":"b1975c7d-3a51-40b6-bfc6-417d1960872b","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1699856416687,"last_edited_time":1699856433778,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"copied_from":"b1975c7d-3a51-40b6-bfc6-417d1960872b","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"9e48e098-a0d6-4efb-be1b-6594e2eb4a86":{"value":{"id":"9e48e098-a0d6-4efb-be1b-6594e2eb4a86","version":183,"type":"sub_header","properties":{"title":[["Django 怎么代管"]]},"created_time":1699606291014,"last_edited_time":1699606493147,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"b8e395b9-6de1-4f13-a20b-aff2c0ca7088":{"value":{"id":"b8e395b9-6de1-4f13-a20b-aff2c0ca7088","version":1213,"type":"text","properties":{"title":[["所谓的帮忙代管，总结起来就是三个步骤："]]},"created_time":1699606353515,"last_edited_time":1699606676108,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"3ff46fcb-9993-47c6-a6e5-fdf634124613":{"value":{"id":"3ff46fcb-9993-47c6-a6e5-fdf634124613","version":700,"type":"numbered_list","properties":{"title":[["你要告诉 Django：来自各个不同来源的静态文件分别放在什么位置，比如 Django 模版、前后端分离时的前端独立工程、项目外的视频图片等等。（对应 Django 配置 "],["STATICFILES_DIRS",[["c"]]],[" ）"]]},"created_time":1699606676106,"last_edited_time":1699607012153,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"e4197934-ca66-4e0d-a629-119ffba45946":{"value":{"id":"e4197934-ca66-4e0d-a629-119ffba45946","version":449,"type":"numbered_list","properties":{"title":[["你要告诉 Django：最终你想把这些静态文件放到什么位置，这个位置可以就是"],["专业组件",[["b"]]],["能找到的位置。（对应 Django 配置 "],["STATIC_ROOT",[["c"]]],[" ）"]]},"created_time":1699606779220,"last_edited_time":1699607059125,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"9b733985-876e-4676-8eac-f3bcbd774a5c":{"value":{"id":"9b733985-876e-4676-8eac-f3bcbd774a5c","version":514,"type":"numbered_list","properties":{"title":[["执行 Django 命令： "],["python manage.py collectstatic",[["c"]]],[" ，Django 会忠实地按照你提供的信息把分散的静态文件收集放到同一个位置。"]]},"created_time":1699606831511,"last_edited_time":1699606927884,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"c2f50d76-b0e1-4011-bac0-64371152bc7b":{"value":{"id":"c2f50d76-b0e1-4011-bac0-64371152bc7b","version":1226,"type":"text","properties":{"title":[["这三步搞定，Django 静态文件就处理完了，"],["这些文件怎么被访问到，那就是专业组件的事情了",[["b"]]],["。好奇宝宝们肯定有很多问题想问 Django："]]},"created_time":1699606963424,"last_edited_time":1699607641267,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"921db843-be1f-47b2-bb62-3750887a855d":{"value":{"id":"921db843-be1f-47b2-bb62-3750887a855d","version":197,"type":"bulleted_list","properties":{"title":[["静态文件来源五花八门，怎么处理？"]]},"content":["33a158f3-04b1-4a30-b4e6-9ef40d061b01"],"created_time":1699607209079,"last_edited_time":1699607292132,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"33a158f3-04b1-4a30-b4e6-9ef40d061b01":{"value":{"id":"33a158f3-04b1-4a30-b4e6-9ef40d061b01","version":196,"type":"bulleted_list","properties":{"title":[["STATICFILES_FINDERS",[["c"]]],[" 实现自定义"],["FINDER",[["c"]]],[" 逻辑"]]},"created_time":1699607265849,"last_edited_time":1699607516240,"parent_id":"921db843-be1f-47b2-bb62-3750887a855d","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"758926ff-ca47-473e-b77e-cc4c6ccacc28":{"value":{"id":"758926ff-ca47-473e-b77e-cc4c6ccacc28","version":271,"type":"bulleted_list","properties":{"title":[["静态文件怎么直接放云上 CDN 里去？或者远端 Nginx ？"]]},"content":["dac358c9-ebae-4949-8934-ded498aa4b80"],"created_time":1699607290855,"last_edited_time":1699607565086,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"dac358c9-ebae-4949-8934-ded498aa4b80":{"value":{"id":"dac358c9-ebae-4949-8934-ded498aa4b80","version":142,"type":"bulleted_list","properties":{"title":[["STATICFILES_STORAGE",[["c"]]],[" 实现自定义 "],["STORAGE",[["c"]]],[" 逻辑"]]},"created_time":1699607416316,"last_edited_time":1699607471509,"parent_id":"758926ff-ca47-473e-b77e-cc4c6ccacc28","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"203734e7-7850-4410-a5aa-bafb7f33e671":{"value":{"id":"203734e7-7850-4410-a5aa-bafb7f33e671","version":299,"type":"text","properties":{"title":[["回答完这些问题，"],["Django 双手一摊：“静态文件没我的事了吧” ",[["i"]]],["🤷‍♂️。"]]},"created_time":1699607563564,"last_edited_time":1699607648603,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"0e5c2551-3ec1-4216-8e67-2ed4915ad1c8":{"value":{"id":"0e5c2551-3ec1-4216-8e67-2ed4915ad1c8","version":49,"type":"text","properties":{"title":[["等等，你这个机灵鬼，我还没说完呢。",[["b"]]]]},"created_time":1699607613596,"last_edited_time":1699607633017,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"9f7161e1-1570-4552-a860-cd3167197721":{"value":{"id":"9f7161e1-1570-4552-a860-cd3167197721","version":153,"type":"sub_header","properties":{"title":[["让 Django 多管点“闲事”"]]},"created_time":1699606483002,"last_edited_time":1699607543301,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"efc7a28e-7b6d-47fd-a3a2-b7d0c86709c2":{"value":{"id":"efc7a28e-7b6d-47fd-a3a2-b7d0c86709c2","version":434,"type":"text","properties":{"title":[["对于请求量大、地域来源广的服务，将站点的静态文件放到"],["专业组件",[["b"]]],["托管肯定是更好的选择。但有时候我们也需要部署一些体量不大应用——例如一些在公司内部服务的中型 SaaS，这时候把静态文件分离管理反而会增加流程和架构的复杂性（除非有非常完善的基建支持），仅仅是负责静态文件的分发是远远不够的，"],["所以使用 Django 代理静态文件的请求也是很多生产环境的选择。",[["b"]]]]},"created_time":1699606505888,"last_edited_time":1699607707952,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"d61a6f41-ed50-409a-a9b8-e04898c0fbf0":{"value":{"id":"d61a6f41-ed50-409a-a9b8-e04898c0fbf0","version":852,"type":"text","properties":{"title":[["那么谁来做这部份工作呢？"],["专业组件",[["b"]]],["的工作 Django 看了直摆手，这时，【"],["白噪声",[["a","https://github.com/evansd/whitenoise"]]],["同志】应声而来。"]]},"created_time":1699606338859,"last_edited_time":1699608374105,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"ec3f8f32-1480-465d-8869-9d39bf0fd7c5":{"value":{"id":"ec3f8f32-1480-465d-8869-9d39bf0fd7c5","version":1483,"type":"text","properties":{"title":[["在安装 WhiteNoise 之后，它将在你的服务内部帮忙 "],["serve",[["c"]]],[" 静态文件，代理这些文件的请求以及相关的事务处理（压缩、缓存等等）。相关配置直接看"],["官方文档",[["a","https://whitenoise.readthedocs.io/en/stable/"]]],["就好，这里就不赘述了。"]]},"created_time":1699607833653,"last_edited_time":1699608404689,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"b1b4c956-d1f4-4844-8865-ec62ab5d615f":{"value":{"id":"b1b4c956-d1f4-4844-8865-ec62ab5d615f","version":277,"type":"text","properties":{"title":[["这么看起来，问题好像就直接解决了？"],["等等，烦人的东西才刚来。",[["b"]]]]},"created_time":1699608418728,"last_edited_time":1699608443036,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"e0c442a2-4394-4408-bb81-3f7985a39afe":{"value":{"id":"e0c442a2-4394-4408-bb81-3f7985a39afe","version":74,"type":"sub_header","properties":{"title":[["烦人的子路径问题"]]},"created_time":1699607852014,"last_edited_time":1699607863521,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"79495554-294d-45cd-b0d4-a7a5275f3a18":{"value":{"id":"79495554-294d-45cd-b0d4-a7a5275f3a18","version":1309,"type":"text","properties":{"title":[["刚才通过 WhiteNoise 模块，已经将静态文件的访问入口收归到 Django 服务中了，理想状态下，直接访问 "],["https://amazing-fake-app/static/",[["c"]]],[" （通过 Django "],["STATIC_URL",[["c"]]],[" 确定访问路径）就能寻找到收集好的静态文件了。"]]},"created_time":1699607864145,"last_edited_time":1699608717311,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"3cf98af7-6070-4b24-b74a-e6d1c9e49f36":{"value":{"id":"3cf98af7-6070-4b24-b74a-e6d1c9e49f36","version":620,"type":"text","properties":{"title":[["但是很多时候我们的服务并不是直接暴露在域名下的，往往会有“访问路径”作为前缀，例如服务本身访问："],["https://amazing-fake-app/foo/",[["c"]]],[" ，这时如果保持原来的 "],["STATIC_URL='/static'",[["c"]]],[" "],["很有可能就有问题",[["b"]]],["。看起来这应该是 Django 应该处理的东西，为什么会有问题呢？"]]},"created_time":1699608595699,"last_edited_time":1699843759428,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"d3eddfc6-0c82-4c65-b300-021af8530e9a":{"value":{"id":"d3eddfc6-0c82-4c65-b300-021af8530e9a","version":426,"type":"text","properties":{"title":[["首先， "],["/foo/",[["c"]]],[" 通常是由外部接入层（例如 Nginx ）转发提供的，Django 理论上是可以感知到它的存在："]]},"created_time":1699842796546,"last_edited_time":1699843377234,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"df4c870f-9802-4657-9820-3728512adb9b":{"value":{"id":"df4c870f-9802-4657-9820-3728512adb9b","version":18,"type":"code","properties":{"title":[["def get_script_name(environ):\n    \"\"\"\n    Return the equivalent of the HTTP request's SCRIPT_NAME environment\n    variable. If Apache mod_rewrite is used, return what would have been\n    the script name prior to any rewriting (so it's the script name as seen\n    from the client's perspective), unless the FORCE_SCRIPT_NAME setting is\n    set (to anything).\n    \"\"\"\n    if settings.FORCE_SCRIPT_NAME is not None:\n        return settings.FORCE_SCRIPT_NAME\n\n    # If Apache's mod_rewrite had a whack at the URL, Apache set either\n    # SCRIPT_URL or REDIRECT_URL to the full resource URL before applying any\n    # rewrites. Unfortunately not every Web server (lighttpd!) passes this\n    # information through all the time, so FORCE_SCRIPT_NAME, above, is still\n    # needed.\n    script_url = get_bytes_from_wsgi(environ, 'SCRIPT_URL', '') or get_bytes_from_wsgi(environ, 'REDIRECT_URL', '')\n\n    if script_url:\n        if b'//' in script_url:\n            # mod_wsgi squashes multiple successive slashes in PATH_INFO,\n            # do the same with script_url before manipulating paths (#17133).\n            script_url = _slashes_re.sub(b'/', script_url)\n        path_info = get_bytes_from_wsgi(environ, 'PATH_INFO', '')\n        script_name = script_url[:-len(path_info)] if path_info else script_url\n    else:\n        script_name = get_bytes_from_wsgi(environ, 'SCRIPT_NAME', '')\n\n    return script_name.decode()"]],"language":[["Python"]]},"created_time":1699843377740,"last_edited_time":1699843389001,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"4172af91-379f-405a-b904-9d787593ad0e":{"value":{"id":"4172af91-379f-405a-b904-9d787593ad0e","version":381,"type":"text","properties":{"title":[["可以看到 Django 一共可以在三个地方感知到子路径的存在："]]},"created_time":1699607864145,"last_edited_time":1699843455819,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"f97e7309-f84a-45d1-95c0-5ddf937f2e7b":{"value":{"id":"f97e7309-f84a-45d1-95c0-5ddf937f2e7b","version":150,"type":"bulleted_list","properties":{"title":[["用户直接通过 "],["FORCE_SCRIPT_NAME",[["c"]]],[" 手动设置"]]},"created_time":1699843456205,"last_edited_time":1699843471923,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"41697591-774a-4f9a-94b3-a59936dc60d8":{"value":{"id":"41697591-774a-4f9a-94b3-a59936dc60d8","version":294,"type":"bulleted_list","properties":{"title":[["从 wsgi 信息中获取 "],["SCRIPT_URL",[["c"]]],[" 或 "],["REDIRECT_URL",[["c"]]],[" ，再转换成 "],["SCRIPT_NAME",[["c"]]]]},"created_time":1699843472212,"last_edited_time":1699843726056,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"1ca24666-5e2b-44e4-8581-1cc765343ee0":{"value":{"id":"1ca24666-5e2b-44e4-8581-1cc765343ee0","version":129,"type":"bulleted_list","properties":{"title":[["从 wsgi 信息中获取 "],["SCRIPT_NAME",[["c"]]],[" "]]},"created_time":1699843517753,"last_edited_time":1699843707381,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"79ccb6bc-4c3a-460b-8560-fda2cb70c506":{"value":{"id":"79ccb6bc-4c3a-460b-8560-fda2cb70c506","version":901,"type":"text","properties":{"title":[["第一个手动设置的我们先不讨论；第二个在代码和注释中说的很清楚了：特定的接入层（例如 Apache ）会稳定提供，但不一定能保证；第三个看起来是缺省的获取方法，理论上它应该能覆盖大部份场景才对。"]]},"created_time":1699843728686,"last_edited_time":1699843912479,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"b1acc552-57b0-4eef-a5ea-82736df77492":{"value":{"id":"b1acc552-57b0-4eef-a5ea-82736df77492","version":1289,"type":"text","properties":{"title":[["然而，假如你的接入层是广泛使用的 Nginx，缺省方法就有问题了："],["默认地，Nginx 并不支持在 HTTP Header 中使用包含下划线的变量",[["a","https://nginx.org/en/docs/http/ngx_http_core_module.html#underscores_in_headers"]]],["，也就说 "],["SCRIPT_NAME",[["c"]]],[" 默认不合法。"]]},"created_time":1699843914974,"last_edited_time":1699844341344,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"7e387bdd-3b39-4a1d-9686-28ef37aea0ce":{"value":{"id":"7e387bdd-3b39-4a1d-9686-28ef37aea0ce","version":468,"type":"bulleted_list","properties":{"title":[["如果你可以修改接入层的配置：可以手动调整 "],["underscores_in_headers",[["c"]]],[" 的配置，但不幸的是，Nginx 还有个默认的行为，给 Header 添加 "],["HTTP_",[["c"]]],[" ，也就是只能通过变量 "],["HTTP_SCRIPT_NAME",[["c"]]],[" 获取，Django 再次 Miss。你可以进一步地修改 Nginx 配置，直接手动添加"],["SCRIPT_NAME",[["c"]]],[" ：`"],["uwsgi_param SCRIPT_NAME $http_script_name;",[["c"]]]]},"created_time":1699844293269,"last_edited_time":1699844366829,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"ecea1b40-8807-40ae-98d2-c1934dde482c":{"value":{"id":"ecea1b40-8807-40ae-98d2-c1934dde482c","version":506,"type":"bulleted_list","properties":{"title":[["如果你不能手动修改接入层的配置：刚才略过的手动设置 "],["FORCE_SCRIPT_NAME",[["c"]]],[" 就派上用场了，手动添加上 "],["FORCE_SCRIPT_NAME=/foo/",[["c"]]]]},"created_time":1699844367447,"last_edited_time":1699844438058,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"75d31c5f-0710-40ab-a07d-35fee4956051":{"value":{"id":"75d31c5f-0710-40ab-a07d-35fee4956051","version":375,"type":"text","properties":{"title":[["当然你可以在 Django wsgi 加载时做一个动态的配置，确保接入层的变更能及时更新到配置中："]]},"created_time":1699848047388,"last_edited_time":1699848177283,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"357df011-825e-4e68-ad5f-80ba5928527f":{"value":{"id":"357df011-825e-4e68-ad5f-80ba5928527f","version":252,"type":"code","properties":{"title":[["class DynamicScriptNameWSGIHandler(WSGIHandler):\n    def __call__(self, environ, start_response):\n        # HTTP_X_SCRIPT_NAME(from Nginx) -\u003e SCRIPT_NAME(Django wsgi)\n        script_name = environ.get('HTTP_X_SCRIPT_NAME')\n        if script_name is not None:\n            environ['SCRIPT_NAME'] = script_name\n            settings.FORCE_SCRIPT_NAME = settings.SITE_URL = '%s/' % script_name\n\n        return super().__call__(environ, start_response)"]],"language":[["Python"]]},"created_time":1699848079877,"last_edited_time":1699848167508,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"},"6f01f523-d0a7-40e7-b6c1-c4a161c12928":{"value":{"id":"6f01f523-d0a7-40e7-b6c1-c4a161c12928","version":788,"type":"text","properties":{"title":[["至此，静态文件处理的流程就很清楚了，挺简单的一件事，就几分钟搞定，打完收工。"]]},"created_time":1699605472739,"last_edited_time":1699856642727,"parent_id":"287065e6-9c7e-44b6-ac5c-bd2fc390ce56","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"}},"collection":{"e34bec60-9b02-4ad8-aaf8-83369409cc9f":{"value":{"id":"e34bec60-9b02-4ad8-aaf8-83369409cc9f","version":98,"name":[["布鲁斯鱼的妙想天开 "]],"schema":{"NX\\Q":{"name":"date","type":"date"},"`gQ~":{"name":"type","type":"select","options":[{"id":"5aff2f95-fd1e-489b-8840-bf10bc9519cb","color":"purple","value":"Post"},{"id":"374d2bc6-a144-4832-8ca4-474aaae0ea1f","color":"orange","value":"Page"}]},"d]hq":{"name":"slug","type":"text"},"sD^m":{"name":"tags","type":"multi_select","options":[{"id":"790180f1-0c2e-4730-a1ef-c5463df34680","color":"brown","value":"python"},{"id":"5d668f5e-7204-4c7e-b57e-5558bd27efaf","color":"gray","value":"pep"},{"id":"9081ab60-29ee-4a5b-9989-f50cf36ecb9b","color":"orange","value":"tech"},{"id":"c0225229-afab-45e4-b69b-b71029b39835","color":"red","value":"django"},{"id":"90084124-d1d5-49fb-86e7-4b133c051d81","color":"default","value":"orm"},{"id":"10ace7d0-10e6-4617-970e-acf2d9348d0f","color":"yellow","value":"best-practice"},{"id":"1b9671ca-93e5-402d-a73e-f9aca38e4358","color":"pink","value":"web"},{"id":"c7015bc7-2283-4b3d-8d19-3075724a10df","color":"blue","value":"blog"},{"id":"22d9ce60-f854-4122-b0fc-4f4c3a41979e","color":"green","value":"guide"},{"id":"6e99d746-1829-43e3-a828-214a1ae79b4a","color":"purple","value":"ELK"},{"id":"45ebe27a-5445-4cc3-91c9-ec1f1296dcf4","color":"brown","value":"pytest"},{"id":"9f679b83-f407-4130-b5b7-f969329300bf","color":"brown","value":"unittest"},{"id":"e30656d1-1ff2-434c-a2cb-8b3c75c9d1a1","color":"gray","value":"fun"},{"id":"5146a8a4-5647-4ce0-8a7b-1a6320adee06","color":"blue","value":"back-pressure"},{"id":"36828c03-3b80-417d-82a3-b1066ad5ca60","color":"green","value":"Dependency injection"},{"id":"9602332d-afbb-41e8-baed-bd0dd39a5e21","color":"brown","value":"k8s"},{"id":"82cd2499-ddd4-43ad-9298-fba21fe29cfa","color":"brown","value":"helm"},{"id":"f0a44444-e52d-4db2-9262-aa29d7ded8e3","color":"blue","value":"celery"},{"id":"a87e284b-1c48-422e-9811-eba8a167f97a","color":"red","value":"amqp"},{"id":"dc50dbb3-8e3a-4747-95d8-c9098e70e088","color":"default","value":"tcp"},{"id":"90b243e4-95f4-459e-b5b7-42f09020978b","color":"gray","value":"graphql"},{"id":"00f0130d-3a96-4e5a-8b5e-77e14e0a3ff7","color":"purple","value":"logstash"},{"id":"a921b879-fcef-4ace-8c96-7a6e11fe2358","color":"orange","value":"konajdk"},{"id":"b8e6dc68-925c-4d32-84d9-580d1a34c3a6","color":"orange","value":"regex"},{"id":"fc66930c-fa10-44b1-b553-5f6acc796321","color":"gray","value":"nfa"},{"id":"f9255cb2-7e85-4bce-8042-472643ff3b58","color":"orange","value":"dfa"},{"id":"e00a51c2-af1c-4bfd-a118-e83e73f3e1a3","color":"purple","value":"security"},{"id":"45105ec0-49be-430b-aead-ef83cfbc8b02","color":"pink","value":"reading"},{"id":"4c3a21fd-3ba5-44a2-8c5e-ef6e9100c32c","color":"brown","value":"software-engineering"},{"id":"4cd1d179-3466-4d7e-baf2-99a4c0250a78","color":"blue","value":"google"},{"id":"22973bbb-4038-4f9b-a30c-c0ab6506d65d","color":"gray","value":"note"},{"id":"1ca18016-ff4e-41e0-af37-6ea457fc4bd8","color":"orange","value":"go"},{"id":"017cb1fb-940d-4281-a078-ea653dc7688a","color":"green","value":"prometheus"},{"id":"35b57024-e3a6-465c-8845-e359d09c72c7","color":"brown","value":"udp"},{"id":"4357722b-be50-481e-ba42-992e73b7b86e","color":"pink","value":"observability"},{"id":"89d067fb-d3d3-4d3f-b855-5f472e28d80b","color":"orange","value":"profiling"},{"id":"74546b53-0289-4df1-8134-aa3fc41775c0","color":"pink","value":"surfing"}]},"wz|S":{"name":"summary","type":"text"},"title":{"name":"title","type":"title"},"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":{"name":"status","type":"select","options":[{"id":"22460321-fea2-4c7c-b352-a674760780ac","color":"orange","value":"Idea"},{"id":"41d5f5c6-b53c-42bc-8e0f-fc9402048480","color":"yellow","value":"Draft"},{"id":"c7390b31-9fab-4e21-94ee-7e67ea077a97","color":"blue","value":"Revise"},{"id":"7abc61d4-b405-480d-b699-12588755fa65","color":"red","value":"Published"}]}},"icon":"🗯️","format":{"copied_from_pointer":{"id":"6a42b751-ff40-4f34-aa6a-1830a3344cb7","table":"collection","spaceId":"ac4cb96d-c8f8-4040-9bb2-868d9fc7f526"},"collection_page_properties":[{"visible":false,"property":"NX\\Q"},{"visible":false,"property":"d]hq"},{"visible":false,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"visible":false,"property":"sD^m"},{"visible":false,"property":"wz|S"},{"visible":false,"property":"`gQ~"}]},"parent_id":"a6089909-2d0d-43ef-af93-5e041712e826","parent_table":"block","alive":true,"file_ids":["6cf3dc36-2f98-4f0e-9679-1bdbb1485129","5520bd92-e709-4c0d-ad58-06923f23f7e9","624d393a-62e3-4464-a1bf-1c79ecd4fbda","d52f6766-3e32-4c3d-8529-46e1f214360f"],"copied_from":"6a42b751-ff40-4f34-aa6a-1830a3344cb7","migrated":true,"space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6","deleted_schema":{"0d330ccb-d222-4440-a0de-6cccfe926a33":{"name":"url","type":"text"},"26ff3130-393a-45ac-92b5-7490d9b87515":{"name":"template","type":"select","options":[{"id":"V*ea","color":"purple","value":"post"}]},"29e679ed-47a3-46c2-9eb4-9070171591b8":{"name":"inList","type":"checkbox"},"2af12d30-97f0-4310-b38c-02e6a554245f":{"name":"publish","type":"checkbox"},"2bf55746-6864-4bb6-b585-77b81f140da1":{"name":"inList","type":"checkbox"},"487aab80-eb42-4dd6-a386-d58672ff59fa":{"name":"description","type":"text"},"53819e0d-5bc6-40de-a8bc-498fdf840fbc":{"name":"description","type":"text"},"67c34d44-b9f2-42c1-b35c-4a534c03bdd9":{"name":"inList","type":"checkbox"},"69fb2cd3-221c-476b-86c2-ab74f4490cc9":{"name":"template","type":"select","options":[{"id":"V*ea","color":"purple","value":"post"}]},"ab0a009c-1080-47c3-aecc-b26dc703a4e0":{"name":"url","type":"text"},"ad8f0878-e947-4188-8970-1ca14665f6e3":{"name":"inMenu","type":"checkbox"},"b2c6f9d4-31e2-4230-b57e-4bdb21a3d635":{"name":"template","type":"select","options":[{"id":"V*ea","color":"purple","value":"post"}]},"b387319f-5770-457e-8453-1d2f2708f9f1":{"name":"url","type":"text"},"b6d830ff-ce1d-4e76-a484-f0fc3f148c52":{"name":"publish","type":"checkbox"},"c0b15f23-eddd-4316-95d1-a92a4edbc710":{"name":"publish","type":"checkbox"},"e3660c02-9d93-463b-9495-addeeabd3e80":{"name":"description","type":"text"}}},"role":"reader"}},"space":{},"collection_view":{"065b98d2-d3b4-4dab-8b96-4eb118a3f311":{"value":{"id":"065b98d2-d3b4-4dab-8b96-4eb118a3f311","version":43,"type":"table","name":"Default view","format":{"table_wrap":false,"table_properties":[{"width":371,"visible":true,"property":"title"},{"width":243,"visible":true,"property":"d]hq"},{"width":159,"visible":true,"property":"NX\\Q"},{"width":147,"visible":true,"property":"wz|S"},{"width":356,"visible":true,"property":"sD^m"},{"width":124,"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"width":100,"visible":true,"property":"`gQ~"}]},"parent_id":"a6089909-2d0d-43ef-af93-5e041712e826","parent_table":"block","alive":true,"page_sort":["b1e1d645-db95-42e5-8995-39a80eda6460","e8cd3732-dc1c-43ae-959a-a5a611ec098a","e876558d-e878-47f6-8c95-21be678990a5","5a971ded-d3c5-41be-bef9-ddfff48d43a2","8db8b240-e1c5-4dd7-bf74-72584d7a2ce0","daf94ca4-ec56-47a3-84ed-b1e2479acc4b","d1a2db9b-6820-421e-9b80-017ce7478587","67ea9f83-b9f6-416b-afcb-7c64f7533e6c","45939470-9819-47e8-b12b-999cfefa0aad","c60dc33d-8efb-44be-a863-7a87ad047932","fe4b8d5f-7c49-42c6-a7d5-1cb71c4f7e86","b7233a67-c367-4198-831e-f12089568d1f","4f3bf306-92c4-41b7-a43e-957129a1240a","6a789607-66cf-498e-9b32-eb3fa69a84f4","c9429034-dabd-4a25-8782-97f20c808a60","38c49fe2-37f8-4a7f-a99f-9edb9ddad4c2","474eb638-9f6b-46bf-8004-77668293f199","81d6dfab-69cb-43a0-aa04-e9725f0b67e1","7703d956-84db-46cd-b538-48eae1af68b5","9f937c73-dac9-4ed7-9b01-beefcb321f16","3cf9dcb9-e7db-406c-80ab-c65c11fbf906","5827ab53-e051-455b-b90a-3bdc20158c2c","fa7acd3b-dea9-4fb1-b859-5345f35163c6","696dfc48-62c3-494d-96d0-ec5fa84637e8","79df93cf-9b10-452e-bc62-f39e8cd2d124","9bb8e52d-c459-4528-b1b3-c2378207253a","5da038ef-f419-4a11-aa48-587b3787e040","b4a2c9d4-6a2c-49e6-988d-89a538dfe0f6","c374a479-5cc7-4c54-ba69-6a4d76dc25ad","d470fa67-0e7c-40d8-86ac-9b5a8be88dc8","986be38b-9780-4bb9-bdcd-4e361ddbd888","b7613f56-c2d4-4aae-b967-b7471ade86d0","e357d1fc-7466-4d6a-8d48-71b76ea97cdc","e1735855-4089-4af6-bd4d-0d59f7a76cb4","9b34581a-955a-4229-99d0-8f2a6d0e69ce","b4414811-0599-45cf-b047-fa95eac42d89","c28a8a01-911a-40a2-a607-d3af8cb24017","461d07ae-4b4a-49de-bdcb-341af1153201","3df59023-cb68-4a65-afd1-7f0b8c21cb57","0e3223d1-03df-40fb-90f9-cc8559d776b5","4f45b7d6-cd5b-46ab-b2a6-37ae20bf5f21","fa475a21-5f38-43d4-9a89-67c40b3129ae","97cbc634-fe3a-4b9b-9da6-ac4aaa94772f","8a0d34bc-7e8c-4a68-88a5-5276274f612a","623f8788-a20f-45fd-bb82-08935f59b44d","7ee398f0-450b-47cb-9b53-f5e7736590d2","eae9f077-591e-4841-903b-db395513c834","367d0f2a-0b10-4dbb-b53a-613152f124f9","398e2e28-3997-49bc-a138-0467d4da8531","8aaf4633-e879-44dc-82c8-3c9fb9d3a6f8","1eb5e5f2-8dc9-4ffc-b5e1-09b67be27a83","83465fb9-205b-41fc-83a6-424692ee0a0e","fb1d18d0-6403-4e8a-840e-134553748ff5","4407cb77-3838-4ba5-b474-f15222cd3dba","1880b0f2-e036-42d0-9550-0fb08a962397","d8d60bd6-33f6-458f-a7d6-209ef2fb05a1","29bf65ff-888b-4a76-a8dd-bf54f02c3864","bad1d4ae-fd4a-4671-ae94-dd53d94e0eae","0d59792d-db1c-4ae7-8d7c-4f013be40dcf","337dc259-2805-4b1c-a60f-1b3e6c7badb8","4b1b21a8-c278-4bc6-88f1-1a35d407f4d7","7946aba2-d6d0-45ef-8779-23fa15db8f2d","c18dbce6-9e8c-4f4b-b74a-0994e7c1bc3f","84aa87b7-39e7-493c-87b9-5cae4de95449","1446eadb-8c01-4295-be3a-ecf19361c143","fe8a7d94-e9ba-457d-8f19-10fe53e6ca3c","98a5a0b6-b07b-4065-a73f-2949ad28ac47","099219ec-fb4b-459d-a538-f6c3d54f6ca2","e047becf-e696-42e3-84c9-4f6278c844ae","975051d4-ebbc-4b3f-98cf-1a52e5e4761d","e5d98bee-b2d5-4b45-ab0b-b77da24aebe7","acac2668-1062-4e7a-b095-eda067da8413","179025c4-d8a8-4c47-b621-9fd6a6f3339b","d256e5ed-5eac-43bb-a32e-581774962c23","b843dacf-b655-4b1c-a61c-434b67f18154","56a80c2d-0520-415a-a77a-1db82eff0b3a","9c40a253-b9e8-42cd-8a99-62aaa9789a5e","d3a05020-0948-489a-80ac-fedebc035c58","0ee4f3e9-0451-411f-b903-0c83d30e5b67","769f1163-e45e-4c3b-87a7-3b551895d9be","7e217dcd-e4e5-4bcd-b2de-00fcb5ab7fba","28e3d2f6-abb8-4711-b21e-ce1937e3e546","04d4f00b-9608-4d83-949e-b32313ace34e","41f93fa3-0496-4ea7-8ac3-0a8beaf346da","f0db9e3e-0e99-4465-ae65-6a9a8d8a6468","279e794f-519c-44f5-ab04-422fba916b72","f0b2f8a5-7dfd-48dc-ba1f-419a7fda1fff","e874f269-1938-40be-974b-2e499c1f4590","65265d92-050f-4fb5-b529-a514079cdd83","5fc98358-411a-40d7-a5d0-c4089026ca1f","15fcd77a-6097-4ee9-9835-9d6e85897fd6","6f8b1275-2d88-40e2-b76b-375f3c028b03","33273042-efcc-45bc-8f28-b65a1c2c65ad","c18bd396-be21-4ce2-ab22-32a45c28e37f","ba597bcf-7582-4fd2-8049-6333ef3e4453","4edecef8-106d-489d-be1d-d1b528c4cdc9","b03b3109-e900-4daf-b852-a590324ab747","8cba5326-9daa-4c2c-b763-5476dc8a7a91","9ab4aa63-ce81-415f-bf95-e632006a1aea","e3644bfb-4244-4a82-a7d7-d7cdb65aa1ed","b6a1f5b5-febd-4c26-9e29-520290eb5719","51e53e64-e6dd-4fd6-8062-5d4455f0a1cb","f4ec684b-e5f1-44e9-a8a7-aca27f7ca6f3","177fa228-9099-4dd5-8969-c67f9c78bd0c","d5ab0d7a-0123-473f-84d4-81740defb9b4","548f6d36-c509-4b79-9c4b-59f227c7f550","c0901673-4f5e-4e51-ad87-0217f2d33a0c","0787f8d6-dc99-47c6-946e-2b008814bebc","0ade5216-1103-486a-aff0-a709ff825b02","a2c4dd21-985c-497d-b421-c2d8a9ec0eeb","908a498c-f7e3-4668-8afd-f179a027b4d9","4945e5c3-033d-467c-a8b3-b1479c1fdf0a","854f4584-28d5-43bd-938e-88d0957c78e3","6a6574f8-d63d-4fed-99c5-38f3df0364ac","5639d091-037c-4284-8260-ade765dbbc90","c9669745-2229-4d95-89a1-8f008e8bebc6","78ebe658-6ba5-4478-a53c-ad468984e7e3","c7f44558-498f-44bd-a8a3-504955dde6b1","d928387b-107b-4f27-b0c5-75301ed7fc55","833556aa-d685-488c-88d0-b136b456ff5f","0bfe1b9e-b115-49f4-9279-7b106f7661af","1465efce-6026-4d50-a952-1aff8c10dea1","f8f308d6-f4c4-4b0f-b7a3-df78d41ce55d","ebd71155-4a59-46a0-bbb2-40687ddbcf9d","29fc49e0-b597-4f2e-9d53-b7dd247adf4b","692194e6-08d3-4e36-a94f-dc403d6226e6","da9db882-26ea-4516-815c-75f2f9ddab59","9a08823e-eec6-4cc0-9ec8-890cb0650aa7","f7327b98-b06a-423a-8b9f-646e5ba2123f","a6c3c98f-9ef9-45de-9d52-4baec7327464","9d18b689-cdc2-4d3f-81da-a690c700caee","6ad26f7b-1828-4d64-a948-3cc6367f6901","3927ece3-9931-46e8-8e7e-91d5e0b5c326","f6ba5dfd-5000-4e15-80b4-7d3456bc676a","0c0d5bfd-8642-460a-aedc-5a8277725196","3dd5dfcc-005c-49b5-9cca-96ccded25899","9faa9c16-825a-40c0-898f-7b9f31c30722","75cd1dc0-c250-437f-bb87-62fda63ed092","7af0f28c-2ee3-4083-9df0-1790796cac80","62ece551-8a43-4a55-9c1c-307fd527381e","74120379-4bfb-4a08-b92f-c971f1369359","4bdc3c4d-327e-49bf-8792-760253dfed83","ff7b6fa3-510b-4ba1-9caa-9f8b4771a90e","fd036365-88c0-4feb-8482-6b4298cacdcc"],"query2":{"filter":{"operator":"and"},"aggregations":[{"property":"title","aggregator":"count"}]},"space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"role":"reader"}},"notion_user":{},"collection_query":{},"signed_urls":{}},"emailHash":"d54f099771ff5f17709b76693f693e2e"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"django-static-quick-glance"},"buildId":"7HSpc6BccLfWKhMTsSEm6","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>