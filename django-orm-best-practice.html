<!DOCTYPE html><html lang="zh-CN"><head><meta name="viewport" content="width=device-width"/><title>Django ORM：天使与魔鬼</title><meta name="robots" content="follow, index"/><meta charSet="UTF-8"/><meta name="keywords" content="Blog, Website, Notion"/><meta name="description" content="平时是小天使，出了问题就是大撒旦"/><meta property="og:locale" content="zh-CN"/><meta property="og:title" content="Django ORM：天使与魔鬼"/><meta property="og:description" content="平时是小天使，出了问题就是大撒旦"/><meta property="og:url" content="https://next.emergencyexit.xyz/"/><meta property="og:image" content="https://og-image-craigary.vercel.app/Django%20ORM%EF%BC%9A%E5%A4%A9%E4%BD%BF%E4%B8%8E%E9%AD%94%E9%AC%BC.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:description" content="平时是小天使，出了问题就是大撒旦"/><meta name="twitter:title" content="Django ORM：天使与魔鬼"/><meta name="twitter:image" content="https://og-image-craigary.vercel.app/Django%20ORM%EF%BC%9A%E5%A4%A9%E4%BD%BF%E4%B8%8E%E9%AD%94%E9%AC%BC.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg"/><meta property="article:published_time"/><meta property="article:author" content="bluesyu"/><meta name="next-head-count" content="18"/><link rel="preload" href="/fonts/IBMPlexSansVar-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/fonts/IBMPlexSansVar-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="preload" as="style" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/><noscript><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/></noscript><link rel="icon" href="/favicon.svg" type="image/svg+xml"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="192x192" href="/apple-touch-icon.png"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/feed"/><meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)"/><meta name="theme-color" content="#18181B" media="(prefers-color-scheme: dark)"/><link rel="preload" href="/_next/static/css/60da561f991c2132.css" as="style"/><link rel="stylesheet" href="/_next/static/css/60da561f991c2132.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6a5815369e10547f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6a5815369e10547f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-a8e4a2662f5d619d.js" defer=""></script><script src="/_next/static/chunks/main-e557dee8cfeafd6c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3f1f8aca4dac6786.js" defer=""></script><script src="/_next/static/chunks/b5f2ed29-08db60af0c3043ba.js" defer=""></script><script src="/_next/static/chunks/684-63c1a25e215d8bed.js" defer=""></script><script src="/_next/static/chunks/580-c0214944b9e37cce.js" defer=""></script><script src="/_next/static/chunks/818-6b9da8a8c865d7d5.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-097086ca2ead5d58.js" defer=""></script><script src="/_next/static/Jh7yzD5faY7830085HB7W/_buildManifest.js" defer=""></script><script src="/_next/static/Jh7yzD5faY7830085HB7W/_ssgManifest.js" defer=""></script><script src="/_next/static/Jh7yzD5faY7830085HB7W/_middlewareManifest.js" defer=""></script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"/></head><body class="bg-day dark:bg-night"><div id="__next" data-reactroot=""><div><div class="wrapper font-sans"><div class="observer-element h-4 md:h-12"></div><div class="sticky-nav m-auto w-full h-6 flex flex-row justify-between items-center mb-2 md:mb-12 py-8 bg-opacity-60 max-w-3xl px-4" id="sticky-nav"><div class="flex items-center"><a aria-label="布鲁斯鱼的妙想天开" href="/"><div class="h-6"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" class="fill-current text-black dark:text-white"></rect><rect width="24" height="24" fill="url(#paint0_radial)"></rect><defs><radialGradient id="paint0_radial" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="rotate(45) scale(39.598)"><stop stop-color="#CFCFCF" stop-opacity="0.6"></stop><stop offset="1" stop-color="#E9E9E9" stop-opacity="0"></stop></radialGradient></defs></svg></div></a><p class="ml-2 font-medium text-day dark:text-night header-name">Django ORM：天使与魔鬼</p></div><div class="flex-shrink-0"><ul class="flex flex-row"><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/">博客</a></li><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/about">关于</a></li><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/feed">订阅</a></li><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/search">搜索</a></li></ul></div></div><main class="m-auto flex-grow w-full transition-all max-w-2xl px-4"><article><h1 class="font-bold text-3xl text-black dark:text-white">Django ORM：天使与魔鬼</h1><nav class="flex mt-7 items-start text-gray-500 dark:text-gray-400"><div class="flex mb-4"><a href="https://twitter.com/bluesedenyu" class="flex"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2724%27%20height=%2724%27/%3e"/></span><img alt="bluesyu" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="bluesyu" srcSet="https://gravatar.com/avatar/d54f099771ff5f17709b76693f693e2e?imwidth=32 1x, https://gravatar.com/avatar/d54f099771ff5f17709b76693f693e2e?imwidth=48 2x" src="https://gravatar.com/avatar/d54f099771ff5f17709b76693f693e2e?imwidth=48" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full" loading="lazy"/></noscript></span><p class="ml-2 md:block">bluesyu</p></a><span class="block"> / </span></div><div class="mr-2 mb-4 md:ml-0">2020 年 11 月 27 日</div><div class="flex flex-nowrap max-w-full overflow-x-auto article-tags"><a href="/tag/tech"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">tech</p></a><a href="/tag/django"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">django</p></a><a href="/tag/orm"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">orm</p></a><a href="/tag/best-practice"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">best-practice</p></a><a href="/tag/web"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">web</p></a></div></nav><div class="-mt-4"><main class="notion light-mode notion-page notion-small-text notion-block-c7f44558498f44bda8a3504955dde6b1"><div class="notion-viewport"></div><div class="notion-collection-row"><div class="notion-collection-row-body"><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M10.889 5.5H3.11v1.556h7.778V5.5zm1.555-4.444h-.777V0H10.11v1.056H3.89V0H2.333v1.056h-.777c-.864 0-1.548.7-1.548 1.555L0 12.5c0 .856.692 1.5 1.556 1.5h10.888C13.3 14 14 13.356 14 12.5V2.611c0-.855-.7-1.555-1.556-1.555zm0 11.444H1.556V3.944h10.888V12.5zM8.556 8.611H3.11v1.556h5.445V8.61z"></path></svg><div class="notion-collection-column-title-body">date</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-date">Nov 27, 2020</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">slug</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text">django-orm-best-practice</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">status</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"><div class="notion-property-select-item notion-item-red">Published</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M4 3a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zM2 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2z"></path></svg><div class="notion-collection-column-title-body">tags</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-multi_select"><div class="notion-property-multi_select-item notion-item-orange">tech</div><div class="notion-property-multi_select-item notion-item-red">django</div><div class="notion-property-multi_select-item notion-item-default">orm</div><div class="notion-property-multi_select-item notion-item-yellow">best-practice</div><div class="notion-property-multi_select-item notion-item-pink">web</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">summary</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text">平时是小天使，出了问题就是大撒旦</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">type</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"><div class="notion-property-select-item notion-item-purple">Post</div></span></div></div></div></div><div class="notion-blank notion-block-936c275f907f43c0aab6f8abc6b3442b"> </div><div class="notion-table-of-contents notion-gray notion-block-1fe63a309077427593afc9e803c46bdc"><a href="#e3e85db98a024f2e89c27724a85cdff7" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">魔鬼的陷阱</span></a><a href="#c0a60e3865e141aa958b8b0859d297d1" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">QuerySet 的类型</span></a><a href="#40ae1b8f705c4b74b78c34e0d375ed3f" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:48px">有时候希望它简单一点</span></a><a href="#83f4bca1ceec4b1196a851b58aa280b7" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:48px">有时候希望它坚持自我</span></a><a href="#37626933f62a4d4a87e3ec09f39c507d" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">多对多和 values()</span></a><a href="#fe6231d4a0f34ef0b6a468b68518714b" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">ORM 终究只是 ORM</span></a><a href="#ea605c0bde9c45f0a0b7365205455b9d" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:48px">隐式转换</span></a><a href="#d7206662fde34ea3be2fec4872dad2d3" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:48px">Mysql 低版本时间精度问题</span></a><a href="#9689bbbc7f974606b07f55eaf57f3729" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">虚假的 .query</span></a><a href="#dcb90849e2a9421abe5cf17738f42353" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">天使的眼泪</span></a><a href="#d7db0cec6b5749b7a65120d16431a336" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">巧用 extra</span></a><a href="#60b7217f697e48b08e609220cd013abf" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">JsonField 的福音—— JSON_SEARCH</span></a><a href="#ad759940e9fb47719c3a68cab8cec2f7" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">行锁的支持</span></a></div><div class="notion-blank notion-block-f2eed844359641699f98b4b652d48ac2"> </div><blockquote class="notion-quote notion-block-79e6698b2b374b4ba0185e5b03611a6d">作为一只以 Django 作为主力开发框架的 CRUD Boy ，时常和它的 ORM 缠绵悱恻、纠缠不清，特此记录一下这些笑与泪的记忆。</blockquote><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-e3e85db98a024f2e89c27724a85cdff7" data-id="e3e85db98a024f2e89c27724a85cdff7"><span><div id="e3e85db98a024f2e89c27724a85cdff7" class="notion-header-anchor"></div><a class="notion-hash-link" href="#e3e85db98a024f2e89c27724a85cdff7" title="魔鬼的陷阱"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">魔鬼的陷阱</span></span></h2><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-c0a60e3865e141aa958b8b0859d297d1" data-id="c0a60e3865e141aa958b8b0859d297d1"><span><div id="c0a60e3865e141aa958b8b0859d297d1" class="notion-header-anchor"></div><a class="notion-hash-link" href="#c0a60e3865e141aa958b8b0859d297d1" title="QuerySet 的类型"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title"><code class="notion-inline-code">QuerySet</code> 的类型</span></span></h3><h4 class="notion-h notion-h3 notion-h-indent-2 notion-block-40ae1b8f705c4b74b78c34e0d375ed3f" data-id="40ae1b8f705c4b74b78c34e0d375ed3f"><span><div id="40ae1b8f705c4b74b78c34e0d375ed3f" class="notion-header-anchor"></div><a class="notion-hash-link" href="#40ae1b8f705c4b74b78c34e0d375ed3f" title="有时候希望它简单一点"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">有时候希望它简单一点</span></span></h4><div class="notion-text notion-block-5c6edeab0daf47d290d346761ee0a478"> <code class="notion-inline-code">objects.values()</code> 返回的并不是简单类型的数据，而是 <code class="notion-inline-code">QuerySet</code>。一般直接用来做 <code class="notion-inline-code">Response</code> 没有问题，但是要知道 <code class="notion-inline-code">QuerySet</code> 是不能被 <code class="notion-inline-code">pickle</code> 的，如果使用到 <code class="notion-inline-code">Django Cache</code> 之类功能，直接用 <code class="notion-inline-code">values()</code> 当作返回会死得很惨。</div><div class="notion-blank notion-block-fc3cacf1f5f64584aa7378a6ed6eb534"> </div><h4 class="notion-h notion-h3 notion-h-indent-2 notion-block-83f4bca1ceec4b1196a851b58aa280b7" data-id="83f4bca1ceec4b1196a851b58aa280b7"><span><div id="83f4bca1ceec4b1196a851b58aa280b7" class="notion-header-anchor"></div><a class="notion-hash-link" href="#83f4bca1ceec4b1196a851b58aa280b7" title="有时候希望它坚持自我"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">有时候希望它坚持自我</span></span></h4><div class="notion-text notion-block-56564acd288843739c32a6e943f2df96">很多时候我们需要限制 <code class="notion-inline-code">QuerySet</code> 返回的字段以加快 DB 查询的速度（比如一些没索引的长字段)，这时候可能的两个方法： <code class="notion-inline-code">only()</code> &amp; <code class="notion-inline-code">values()</code> 。</div><div class="notion-text notion-block-a9c1f10f227c441ea40c390997431a51">但实际情况是，使用 <code class="notion-inline-code">values()</code> 会改变 <code class="notion-inline-code">queryset._iterable_class</code> ，如果后面还有更多的级联查询，会导致最后的结果为 <code class="notion-inline-code">Dict</code> 而不是 <code class="notion-inline-code">QuerySet</code>。</div><div class="notion-blank notion-block-f9796d63a4f547cba320179ba9fd2942"> </div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-37626933f62a4d4a87e3ec09f39c507d" data-id="37626933f62a4d4a87e3ec09f39c507d"><span><div id="37626933f62a4d4a87e3ec09f39c507d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#37626933f62a4d4a87e3ec09f39c507d" title="多对多和 values()"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">多对多和 <code class="notion-inline-code">values()</code></span></span></h3><div class="notion-text notion-block-2f9bc4612597486286fb55f704988d2c">存在一个模型</div><pre class="notion-code language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token operator">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token function">CharField</span><span class="token punctuation">(</span><span class="token operator">**</span>some_params<span class="token punctuation">)</span>
    bars <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token function">ManyToManyField</span><span class="token punctuation">(</span><span class="token operator">**</span>some_params<span class="token punctuation">)</span></code></pre><div class="notion-text notion-block-77a12c0e5dfa49e38f8de3a7bb2880ef">存在一条记录</div><pre class="notion-code language-python"><code class="language-python"><span class="token literal-property property">foo</span><span class="token operator">:</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> tom
  <span class="token literal-property property">bars</span><span class="token operator">:</span>
    <span class="token operator">-</span> a
    <span class="token operator">-</span> b </code></pre><div class="notion-text notion-block-207ec4627bde4514b4ed47bf31fb3a21"> <code class="notion-inline-code">values()</code> 预期返回</div><pre class="notion-code language-json"><code class="language-json"><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"tom"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"bars"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre><div class="notion-text notion-block-2c1a79a3370b4eadb28bd9d8caed2a6b">实际返回</div><pre class="notion-code language-json"><code class="language-json"><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"tom"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"bars"</span><span class="token operator">:</span> <span class="token string">"a"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"tom"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"bars"</span><span class="token operator">:</span> <span class="token string">"b"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre><div class="notion-blank notion-block-db7d5fe48d1e479cbbddaf92429cb0f3"> </div><div class="notion-text notion-block-9e89de42062b47d195dac95681c63af9">没有什么太好的调整办法，只能注意 + 规避，详见: </div><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-69e0816293c54488935d483e27c9e8e5" href="https://docs.djangoproject.com/en/1.11/ref/models/querysets/#values"><div><div class="notion-bookmark-title">QuerySet API reference | Django documentation | Django</div><div class="notion-bookmark-description">Django provides a range of refinement methods that modify either the types of results returned by the or the way its SQL query is executed. Returns a new containing objects that do not match the given lookup parameters. The lookup parameters () should be in the format described in Field lookups below.</div><div class="notion-bookmark-link"><img src="https://static.djangoproject.com/img/favicon.6dbf28c0650e.ico" alt="QuerySet API reference | Django documentation | Django" loading="lazy"/><div>https://docs.djangoproject.com/en/1.11/ref/models/querysets/#values</div></div></div></a></div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-687363468dda45278fee4529018ff7c5"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fd55d79b9-fe83-43dd-8194-f02c9fea19d8%2FUntitled.png?table=block&amp;id=68736346-8dda-4527-8fee-4529018ff7c5&amp;cache=v2" loading="lazy" alt="notion image" decoding="async"/></div></figure><div class="notion-blank notion-block-cb1c449218664166a3637abdbc2f7c40"> </div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-fe6231d4a0f34ef0b6a468b68518714b" data-id="fe6231d4a0f34ef0b6a468b68518714b"><span><div id="fe6231d4a0f34ef0b6a468b68518714b" class="notion-header-anchor"></div><a class="notion-hash-link" href="#fe6231d4a0f34ef0b6a468b68518714b" title="ORM 终究只是 ORM"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">ORM 终究只是 ORM</span></span></h3><div class="notion-blank notion-block-f6064d5616214ebfa3fc4d15e2f61df7"> </div><div class="notion-text notion-block-0b349c093a954cadbc9bdceda7438089">我们要时刻记住, <code class="notion-inline-code">orm</code> 只是做一个映射，有时候拿到的对象和我们预想并不能完全一致。</div><h4 class="notion-h notion-h3 notion-h-indent-2 notion-block-ea605c0bde9c45f0a0b7365205455b9d" data-id="ea605c0bde9c45f0a0b7365205455b9d"><span><div id="ea605c0bde9c45f0a0b7365205455b9d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#ea605c0bde9c45f0a0b7365205455b9d" title="隐式转换"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">隐式转换</span></span></h4><pre class="notion-code language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token operator">:</span>
    created <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token function">DateTimeField</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

# 这里先忽略 timezone 问题
f1 <span class="token operator">=</span> <span class="token function">Foo</span><span class="token punctuation">(</span>created<span class="token operator">=</span><span class="token string">'2020-09-18 09:46:23.544799'</span><span class="token punctuation">)</span>

# 字符串会被存储，Django 做了隐式转换
f1<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

# str
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span>created<span class="token punctuation">)</span><span class="token punctuation">)</span>

f2 <span class="token operator">=</span> Foo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pk<span class="token operator">=</span>f1<span class="token punctuation">.</span>pk<span class="token punctuation">)</span>

# Datetime 对象！
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span>created<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><div class="notion-blank notion-block-1c90c81defb74e5495c0eaa76b5c5b7b"> </div><div class="notion-text notion-block-f10859c31227476789ab82b52a004a7c">通过以上的例子就能知道，我们自己创建的内存对象 <code class="notion-inline-code">f1</code> 和通过 <code class="notion-inline-code">orm</code> 拿出来的内存对象 <code class="notion-inline-code">f2</code> 完全不是同一个东西，虽然他们都可以操作同一条数据库记录，但如果在内存对象里做比较就会有很多问题，比如下面的例子</div><div class="notion-blank notion-block-f4a427e734fb499891d55cd04f330f81"> </div><h4 class="notion-h notion-h3 notion-h-indent-2 notion-block-d7206662fde34ea3be2fec4872dad2d3" data-id="d7206662fde34ea3be2fec4872dad2d3"><span><div id="d7206662fde34ea3be2fec4872dad2d3" class="notion-header-anchor"></div><a class="notion-hash-link" href="#d7206662fde34ea3be2fec4872dad2d3" title="Mysql 低版本时间精度问题"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Mysql 低版本时间精度问题</span></span></h4><pre class="notion-code language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token operator">:</span>
    created <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token function">DateTimeField</span><span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span>True<span class="token punctuation">)</span>

# 假定 Foo 表中已经存在了比较多的记录
f <span class="token operator">=</span> Foo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

# 我们预期是获取按照时间来排序，f 的前一条记录
o <span class="token operator">=</span> Foo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>created_lt<span class="token operator">=</span>f<span class="token punctuation">.</span>created<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">latest</span><span class="token punctuation">(</span><span class="token string">'created'</span><span class="token punctuation">)</span>

assert o<span class="token punctuation">.</span>pk <span class="token operator">==</span> f<span class="token punctuation">.</span>pk
# mysql 版本大于 <span class="token number">5.6</span><span class="token number">.4</span> 时 <span class="token operator">-</span><span class="token operator">></span> False
# mysql 版本小于 <span class="token number">5.6</span><span class="token number">.4</span> 时 <span class="token operator">-</span><span class="token operator">></span> True</code></pre><div class="notion-text notion-block-de49709555a14596b1622a537a3024f1">原因很简单，当 <code class="notion-inline-code">mysql</code> 版本小于 <code class="notion-inline-code">5.6.4</code> 时是不支持 <code class="notion-inline-code">microseconds</code> 的，由于我们的 <code class="notion-inline-code">f</code> 是内存对象，拿到的 <code class="notion-inline-code">created</code> 又是有 <code class="notion-inline-code">microseconds</code> 的，相当于我们在用 <code class="notion-inline-code">2020-09-18 09:24:38.260779</code> 和 <code class="notion-inline-code">2020-09-18 09:24:38.000000</code> 做比较， <code class="notion-inline-code">o</code> 一直拿到的就是 <code class="notion-inline-code">f</code> 对应的记录...</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-ffbce2a666df43e38c89a4b3bcd5900d"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:432px;max-width:100%;flex-direction:column"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F53b61d4b-0742-48a9-ac2c-54311236400f%2FUntitled.png?table=block&amp;id=ffbce2a6-66df-43e3-8c89-a4b3bcd5900d&amp;cache=v2" loading="lazy" alt="notion image" decoding="async"/></div></figure><div class="notion-blank notion-block-64fd0798053d4d7eafb44993b51e5670"> </div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-9689bbbc7f974606b07f55eaf57f3729" data-id="9689bbbc7f974606b07f55eaf57f3729"><span><div id="9689bbbc7f974606b07f55eaf57f3729" class="notion-header-anchor"></div><a class="notion-hash-link" href="#9689bbbc7f974606b07f55eaf57f3729" title="虚假的 .query"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">虚假的 <code class="notion-inline-code">.query</code></span></span></h3><div class="notion-blank notion-block-376518bae236405bb9388f711116cba5"> </div><div class="notion-text notion-block-157e2ee7ba934f50b42c014a4b0d2825">我们常常用 <code class="notion-inline-code">queryset.query</code> 去检查复杂的查询语句，但实际上 <code class="notion-inline-code">query</code> 属性并不能真实反应提交到 DB 中的 <code class="notion-inline-code">sql</code> ，可以参考如下链接：</div><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-7693a13cccc74f6983d714291a1243c7" href="https://code.djangoproject.com/ticket/17741"><div><div class="notion-bookmark-title">QuerySet.query.__str__() does not generate valid MySQL query with dates</div><div class="notion-bookmark-description">If you have a date parameter in a QuerySet, the string of the query is not valid SQL in MySQL and will generate a warning.</div><div class="notion-bookmark-link"><img src="https://code.djangoproject.com/favicon.ico" alt="QuerySet.query.__str__() does not generate valid MySQL query with dates" loading="lazy"/><div>https://code.djangoproject.com/ticket/17741</div></div></div></a></div><div class="notion-blank notion-block-7801ab17d17d413c80cb3d31712c22a4"> </div><div class="notion-text notion-block-5fa8497e330a4e789ad2e79f7b8c89c3">那么如何调试提交到 DB 中的具体语句呢？</div><pre class="notion-code language-python"><code class="language-python">from django<span class="token punctuation">.</span>db <span class="token keyword">import</span> connection

# 在语句提交之后，立即打印
# 同时需要记得开启 <span class="token constant">DEBUG</span> <span class="token operator">=</span> True
<span class="token function">print</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span>queries<span class="token punctuation">)</span></code></pre><div class="notion-text notion-block-3cc35a64ab6c477ea23af2c38fdda0fa">再或者，直接<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://stackoverflow.com/questions/650238/how-to-show-the-last-queries-executed-on-mysql">在 DB 中开启 general_log</a> 。</div><div class="notion-blank notion-block-79ca90d41606452abaa5442e8b96bac6"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-dcb90849e2a9421abe5cf17738f42353" data-id="dcb90849e2a9421abe5cf17738f42353"><span><div id="dcb90849e2a9421abe5cf17738f42353" class="notion-header-anchor"></div><a class="notion-hash-link" href="#dcb90849e2a9421abe5cf17738f42353" title="天使的眼泪"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">天使的眼泪</span></span></h2><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-d7db0cec6b5749b7a65120d16431a336" data-id="d7db0cec6b5749b7a65120d16431a336"><span><div id="d7db0cec6b5749b7a65120d16431a336" class="notion-header-anchor"></div><a class="notion-hash-link" href="#d7db0cec6b5749b7a65120d16431a336" title="巧用 extra"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">巧用 extra</span></span></h3><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-6fcd68be858949ccb4bbefbad5eeefc2" href="https://docs.djangoproject.com/en/1.11/ref/models/querysets/#extra"><div><div class="notion-bookmark-title">QuerySet API reference | Django documentation | Django</div><div class="notion-bookmark-description">Django provides a range of refinement methods that modify either the types of results returned by the or the way its SQL query is executed. Returns a new containing objects that do not match the given lookup parameters. The lookup parameters () should be in the format described in Field lookups below.</div><div class="notion-bookmark-link"><img src="https://static.djangoproject.com/img/favicon.6dbf28c0650e.ico" alt="QuerySet API reference | Django documentation | Django" loading="lazy"/><div>https://docs.djangoproject.com/en/1.11/ref/models/querysets/#extra</div></div></div></a></div><div class="notion-blank notion-block-fbd54699ed2848d784423481581d7509"> </div><div class="notion-text notion-block-a0312ff2738140f58917c4d869008216"><code class="notion-inline-code">extra()</code> 可以利用 <code class="notion-inline-code">sql</code> 在数据库中做数据处理，而不用放到内存中，在数据量较大时有比较好的效果，比如：</div><div class="notion-blank notion-block-046dc19cfb1642ad9b56bdbd2437116b"> </div><pre class="notion-code language-python"><code class="language-python">queryset <span class="token operator">=</span> queryset<span class="token punctuation">.</span><span class="token function">extra</span><span class="token punctuation">(</span>select<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string-property property">'username'</span><span class="token operator">:</span> <span class="token string">"CONCAT(username, '@', domain)"</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><div class="notion-blank notion-block-eda135b0f9fb4ae48977d411b912794d"> </div><div class="notion-text notion-block-9982532ed1894d3b926964e634c6991c">在模糊查询时，匹配最短结果</div><pre class="notion-code language-python"><code class="language-python">MyModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token function">extra</span><span class="token punctuation">(</span>select<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string-property property">'myfield_length'</span><span class="token operator">:</span><span class="token string">'Length(myfield)'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order_by</span><span class="token punctuation">(</span><span class="token string">'myfield_length'</span><span class="token punctuation">)</span></code></pre><div class="notion-blank notion-block-8348268adaa84ffba45bca8f31e06b0c"> </div><div class="notion-text notion-block-5903bfac203448b386f59223cc490378">但在同时需要格外小心， <code class="notion-inline-code">extra()</code> 在参数上存在注入风险，所有可能的用户输入的 SQL 拼接，都应该交给 Django 处理。</div><pre class="notion-code language-python"><code class="language-python"># 有注入风险<span class="token punctuation">,</span> username 不会被转义，可以直接注入
Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token function">extra</span><span class="token punctuation">(</span>where<span class="token operator">=</span><span class="token punctuation">[</span>f<span class="token string">"headline='{username}'"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

# 安全，Django 会将 username 内容转义
Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token function">extra</span><span class="token punctuation">(</span>where<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'headline=%s'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-60b7217f697e48b08e609220cd013abf" data-id="60b7217f697e48b08e609220cd013abf"><span><div id="60b7217f697e48b08e609220cd013abf" class="notion-header-anchor"></div><a class="notion-hash-link" href="#60b7217f697e48b08e609220cd013abf" title="JsonField 的福音—— JSON_SEARCH"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title"><code class="notion-inline-code">JsonField</code> 的福音—— <code class="notion-inline-code">JSON_SEARCH</code></span></span></h3><div class="notion-text notion-block-650e9bea3381488aa8d69976db8941b8">有时候我们需要使用动态字段，并且保证动态字段的值全表唯一。动态字段我们使用 <code class="notion-inline-code">LONGTEXT</code> 存储，格式为 <code class="notion-inline-code">JSON</code> 。如果手动处理，需要将整个表的字段放到内存，并做唯一校验，非常麻烦且耗时。</div><div class="notion-text notion-block-276cb92d6bba4a5ba5381c4cd1b18c8e">所以还是一个道理，把这个逻辑交给 DB</div><pre class="notion-code language-sql"><code class="language-sql">select <span class="token operator">*</span> from profiles_profile where <span class="token constant">JSON_SEARCH</span><span class="token punctuation">(</span>extras<span class="token punctuation">,</span> <span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token string">"aaa"</span><span class="token punctuation">)</span> is not <span class="token keyword">null</span><span class="token punctuation">;</span></code></pre><div class="notion-blank notion-block-807facbd4a2a4aa2a8259ebd70797821"> </div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-ad759940e9fb47719c3a68cab8cec2f7" data-id="ad759940e9fb47719c3a68cab8cec2f7"><span><div id="ad759940e9fb47719c3a68cab8cec2f7" class="notion-header-anchor"></div><a class="notion-hash-link" href="#ad759940e9fb47719c3a68cab8cec2f7" title="行锁的支持"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">行锁的支持</span></span></h3><div class="notion-text notion-block-1ead05f1017b4e248e94d2140384f6e5">多个操作互斥的情况下，可以使用 <code class="notion-inline-code">select_for_update</code> 行锁保证正确性。</div><pre class="notion-code language-python"><code class="language-python"><span class="token keyword">with</span> transaction<span class="token punctuation">.</span><span class="token function">atomic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    # 仅在 transaction 内生效
    Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token function">select_for_update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"Hello"</span><span class="token punctuation">)</span></code></pre><div class="notion-blank notion-block-20c6dac34a044308b9459224f65ac73e"> </div><div class="notion-text notion-block-4b00d0373e554411b80a6b53392e1c4d">但是同时需要注意，上锁的顺序，避免产生死锁。</div></main></div></article><div class="flex justify-between font-medium text-gray-500 dark:text-gray-400"><a><button class="mt-2 cursor-pointer hover:text-black dark:hover:text-gray-100">← <!-- -->返回</button></a><a><button class="mt-2 cursor-pointer hover:text-black dark:hover:text-gray-100">↑ <!-- -->回到顶部</button></a></div><div></div></main><div class="mt-6 flex-shrink-0 m-auto w-full text-gray-500 dark:text-gray-400 transition-all max-w-2xl px-4"><hr class="border-gray-200 dark:border-gray-600"/><div class="my-4 text-sm leading-6"><div class="flex align-baseline justify-between flex-wrap"><p>© <!-- -->bluesyu<!-- --> <!-- -->2021 - 2022</p><a href="https://vercel.com?utm_source=Craigary&amp;utm_campaign=oss" target="_blank" rel="noreferrer" aria-label="Vercel"><svg width="135" height="28" viewBox="0 0 135 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline-block"><g clip-path="url(#clip0)"><path d="M129.818 0H5.09091C2.27928 0 0 2.27928 0 5.09091V22.9091C0 25.7207 2.27928 28 5.09091 28H129.818C132.63 28 134.909 25.7207 134.909 22.9091V5.09091C134.909 2.27928 132.63 0 129.818 0Z" fill="black"></path><path d="M38.4601 9.68997V16.8639H39.355V14.3036H41.1597C42.507 14.3036 43.4665 13.354 43.4665 12.0117C43.4665 10.6445 42.5268 9.68997 41.1696 9.68997H38.4601ZM39.355 10.4854H40.9359C41.975 10.4854 42.5467 11.0273 42.5467 12.0117C42.5467 12.9613 41.9551 13.5081 40.9359 13.5081H39.355V10.4854ZM46.6734 16.9584C48.1996 16.9584 49.1442 15.9044 49.1442 14.1843C49.1442 12.4591 48.1996 11.4101 46.6734 11.4101C45.1471 11.4101 44.2025 12.4591 44.2025 14.1843C44.2025 15.9044 45.1471 16.9584 46.6734 16.9584ZM46.6734 16.1878C45.6591 16.1878 45.0874 15.452 45.0874 14.1843C45.0874 12.9116 45.6591 12.1807 46.6734 12.1807C47.6875 12.1807 48.2593 12.9116 48.2593 14.1843C48.2593 15.452 47.6875 16.1878 46.6734 16.1878ZM56.8255 11.5046H55.9654L54.9115 15.7901H54.8319L53.6338 11.5046H52.8135L51.6153 15.7901H51.5358L50.4818 11.5046H49.6167L51.1182 16.8639H51.9832L53.1764 12.7177H53.2559L54.4541 16.8639H55.3241L56.8255 11.5046ZM59.7043 12.1658C60.5544 12.1658 61.1212 12.7922 61.1411 13.7418H58.1879C58.2526 12.7922 58.8492 12.1658 59.7043 12.1658ZM61.1162 15.4769C60.8925 15.9492 60.4252 16.2027 59.7341 16.2027C58.8243 16.2027 58.2327 15.5315 58.1879 14.4726V14.4328H62.0409V14.1047C62.0409 12.4392 61.161 11.4101 59.7142 11.4101C58.2427 11.4101 57.298 12.5038 57.298 14.1892C57.298 15.8845 58.2277 16.9584 59.7142 16.9584C60.8875 16.9584 61.7227 16.3916 61.9714 15.4769H61.1162ZM63.1796 16.8639H64.0346V13.5429C64.0346 12.7873 64.6264 12.2404 65.4416 12.2404C65.6109 12.2404 65.9189 12.2702 65.9889 12.2901V11.435C65.8794 11.42 65.6999 11.4101 65.5612 11.4101C64.8504 11.4101 64.2338 11.778 64.0747 12.3H63.9951V11.5046H63.1796V16.8639ZM68.8423 12.1658C69.6925 12.1658 70.2595 12.7922 70.2792 13.7418H67.3259C67.3908 12.7922 67.9877 12.1658 68.8423 12.1658ZM70.2544 15.4769C70.0304 15.9492 69.5633 16.2027 68.8722 16.2027C67.9622 16.2027 67.371 15.5315 67.3259 14.4726V14.4328H71.179V14.1047C71.179 12.4392 70.2989 11.4101 68.8525 11.4101C67.3806 11.4101 66.4362 12.5038 66.4362 14.1892C66.4362 15.8845 67.3659 16.9584 68.8525 16.9584C70.0259 16.9584 70.8609 16.3916 71.1097 15.4769H70.2544ZM74.3017 16.9584C75.0424 16.9584 75.6788 16.6055 76.0167 16.0088H76.0962V16.8639H76.9114V9.37675H76.0568V12.3497H75.9817C75.6788 11.7631 75.0475 11.4101 74.3017 11.4101C72.9392 11.4101 72.0496 12.5038 72.0496 14.1843C72.0496 15.8696 72.929 16.9584 74.3017 16.9584ZM74.5002 12.1807C75.47 12.1807 76.0765 12.9563 76.0765 14.1843C76.0765 15.4222 75.4745 16.1878 74.5002 16.1878C73.5209 16.1878 72.9341 15.4371 72.9341 14.1843C72.9341 12.9364 73.5259 12.1807 74.5002 12.1807ZM83.7033 16.9584C85.0607 16.9584 85.9503 15.8597 85.9503 14.1843C85.9503 12.4989 85.0651 11.4101 83.7033 11.4101C82.9677 11.4101 82.316 11.773 82.0227 12.3497H81.9431V9.37675H81.0879V16.8639H81.9037V16.0088H81.9832C82.3211 16.6055 82.9575 16.9584 83.7033 16.9584ZM83.5041 12.1807C84.4835 12.1807 85.0651 12.9314 85.0651 14.1843C85.0651 15.4371 84.4835 16.1878 83.5041 16.1878C82.5299 16.1878 81.9234 15.4222 81.9234 14.1843C81.9234 12.9464 82.5299 12.1807 83.5041 12.1807ZM87.3478 18.8029C88.2972 18.8029 88.7249 18.435 89.1818 17.1921L91.2754 11.5046H90.3654L88.8986 15.9144H88.819L87.3478 11.5046H86.4231L88.4067 16.8689L88.3068 17.1871C88.0834 17.8334 87.8149 18.0671 87.3229 18.0671C87.2033 18.0671 87.069 18.0621 86.9647 18.0422V18.773C87.0843 18.7929 87.2332 18.8029 87.3478 18.8029ZM98.4148 16.8639L100.895 9.68997H99.5284L97.7383 15.3675H97.6543L95.8496 9.68997H94.4324L96.9384 16.8639H98.4148ZM103.516 12.295C104.257 12.295 104.744 12.8121 104.769 13.6175H102.208C102.263 12.822 102.78 12.295 103.516 12.295ZM104.778 15.3675C104.6 15.7702 104.177 15.9939 103.565 15.9939C102.755 15.9939 102.233 15.4272 102.203 14.5223V14.4577H106.001V14.06C106.001 12.3447 105.072 11.3156 103.521 11.3156C101.945 11.3156 100.965 12.4144 100.965 14.1644C100.965 15.9144 101.93 16.9733 103.53 16.9733C104.813 16.9733 105.723 16.3568 105.947 15.3675H104.778ZM107.036 16.8639H108.269V13.7219C108.269 12.9613 108.826 12.4641 109.626 12.4641C109.835 12.4641 110.163 12.4989 110.257 12.5337V11.3902C110.143 11.3555 109.924 11.3355 109.745 11.3355C109.045 11.3355 108.458 11.7333 108.308 12.2702H108.224V11.425H107.036V16.8639ZM115.627 13.2546C115.498 12.1111 114.652 11.3156 113.255 11.3156C111.62 11.3156 110.66 12.3647 110.66 14.1296C110.66 15.9193 111.625 16.9733 113.26 16.9733C114.638 16.9733 115.493 16.2077 115.627 15.0692H114.454C114.324 15.636 113.897 15.9392 113.255 15.9392C112.415 15.9392 111.908 15.273 111.908 14.1296C111.908 13.001 112.41 12.3497 113.255 12.3497C113.932 12.3497 114.339 12.7276 114.454 13.2546H115.627ZM118.883 12.295C119.624 12.295 120.112 12.8121 120.136 13.6175H117.576C117.63 12.822 118.148 12.295 118.883 12.295ZM120.147 15.3675C119.967 15.7702 119.545 15.9939 118.933 15.9939C118.123 15.9939 117.601 15.4272 117.571 14.5223V14.4577H121.369V14.06C121.369 12.3447 120.439 11.3156 118.888 11.3156C117.312 11.3156 116.333 12.4144 116.333 14.1644C116.333 15.9144 117.298 16.9733 118.899 16.9733C120.181 16.9733 121.091 16.3568 121.314 15.3675H120.147ZM122.453 16.8639H123.686V9.32202H122.453V16.8639Z" fill="white"></path><path d="M14.8431 8.27271L20.7772 18.4545H8.90918L14.8431 8.27271Z" fill="white"></path><path d="M27.6819 0V28" stroke="#5E5E5E" stroke-width="0.636364"></path></g><defs><clipPath id="clip0"><rect width="134.909" height="28" fill="white"></rect></clipPath></defs></svg></a></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"c7f44558-498f-44bd-a8a3-504955dde6b1","date":{"start_date":"2020-11-27"},"type":["Post"],"slug":"django-orm-best-practice","tags":["tech","django","orm","best-practice","web"],"summary":"平时是小天使，出了问题就是大撒旦","title":"Django ORM：天使与魔鬼","status":["Published"],"createdTime":"Mon Oct 17 2022 18:22:51 GMT+0000 (Coordinated Universal Time)","fullWidth":false},"blockMap":{"block":{"c7f44558-498f-44bd-a8a3-504955dde6b1":{"role":"reader","value":{"id":"c7f44558-498f-44bd-a8a3-504955dde6b1","version":18,"type":"page","properties":{"NX\\Q":[["‣",[["d",{"type":"date","start_date":"2020-11-27"}]]]],"`gQ~":[["Post"]],"d]hq":[["django-orm-best-practice"]],"sD^m":[["tech,django,orm,best-practice,web"]],"wz|S":[["平时是小天使，出了问题就是大撒旦"]],"title":[["Django ORM：天使与魔鬼"]],"0d330ccb-d222-4440-a0de-6cccfe926a33":[["django-orm-best-practice"]],"2bf55746-6864-4bb6-b585-77b81f140da1":[["Yes"]],"b2c6f9d4-31e2-4230-b57e-4bdb21a3d635":[["post"]],"c0b15f23-eddd-4316-95d1-a92a4edbc710":[["Yes"]],"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":[["Published"]]},"content":["936c275f-907f-43c0-aab6-f8abc6b3442b","1fe63a30-9077-4275-93af-c9e803c46bdc","f2eed844-3596-4169-9f98-b4b652d48ac2","79e6698b-2b37-4b4b-a018-5e5b03611a6d","e3e85db9-8a02-4f2e-89c2-7724a85cdff7","c0a60e38-65e1-41aa-958b-8b0859d297d1","40ae1b8f-705c-4b74-b78c-34e0d375ed3f","5c6edeab-0daf-47d2-90d3-46761ee0a478","fc3cacf1-f5f6-4584-aa73-78a6ed6eb534","83f4bca1-ceec-4b11-96a8-51b58aa280b7","56564acd-2888-4373-9c32-a6e943f2df96","a9c1f10f-227c-441e-a40c-390997431a51","f9796d63-a4f5-47cb-a320-179ba9fd2942","37626933-f62a-4d4a-87e3-ec09f39c507d","2f9bc461-2597-4862-86fb-55f704988d2c","a9ede1bf-401a-46f1-b5c7-9e345a8d1f54","77a12c0e-5dfa-49e3-8f8d-e3a7bb2880ef","6d7fbd7f-9399-4d49-a1cb-0727a8bccc0a","207ec462-7bde-4514-b4ed-47bf31fb3a21","ed7f40c4-0030-45ec-8aa5-bff149c425d0","2c1a79a3-370b-4ead-b28b-d9d8caed2a6b","bef14558-c34d-4da6-8ffd-9dfde85990bb","db7d5fe4-8d1e-479c-bbdd-af92429cb0f3","9e89de42-062b-47d1-95da-c95681c63af9","69e08162-93c5-4488-935d-483e27c9e8e5","68736346-8dda-4527-8fee-4529018ff7c5","cb1c4492-1866-4166-a363-7abdbc2f7c40","fe6231d4-a0f3-4ef0-b6a4-68b68518714b","f6064d56-1621-4ebf-a3fc-4d15e2f61df7","0b349c09-3a95-4cad-bc9b-dceda7438089","ea605c0b-de9c-45f0-a0b7-365205455b9d","d53b617f-7e36-48ba-9525-0ad1284e736d","1c90c81d-efb7-4e54-95c0-eaa76b5c5b7b","f10859c3-1227-4767-89ab-82b52a004a7c","f4a427e7-34fb-4998-91d5-5cd04f330f81","d7206662-fde3-4ea3-be2f-ec4872dad2d3","130fb25e-713c-473d-bb72-27365c30743f","de497095-55a1-4596-b162-2a537a3024f1","ffbce2a6-66df-43e3-8c89-a4b3bcd5900d","64fd0798-053d-4d7e-afb4-4993b51e5670","9689bbbc-7f97-4606-b07f-55eaf57f3729","376518ba-e236-405b-b938-8f711116cba5","157e2ee7-ba93-4f50-b42c-014a4b0d2825","7693a13c-ccc7-4f69-83d7-14291a1243c7","7801ab17-d17d-413c-80cb-3d31712c22a4","5fa8497e-330a-4e78-9ad2-e79f7b8c89c3","a66be089-52cc-46e3-9bbb-8611bbe44407","3cc35a64-ab6c-477e-a23a-f2c38fdda0fa","79ca90d4-1606-452a-baa5-442e8b96bac6","dcb90849-e2a9-421a-be5c-f17738f42353","d7db0cec-6b57-49b7-a651-20d16431a336","6fcd68be-8589-49cc-b4bb-efbad5eeefc2","fbd54699-ed28-48d7-8442-3481581d7509","a0312ff2-7381-40f5-8917-c4d869008216","046dc19c-fb16-42ad-9b56-bdbd2437116b","3d7c56fd-3487-40d2-9c49-4baef2da8003","eda135b0-f9fb-4ae4-8977-d411b912794d","9982532e-d189-4d3b-9269-64e634c6991c","0f736186-a891-4951-b65d-c109eaeebd02","8348268a-daa8-4ffb-a45b-ca8f31e06b0c","5903bfac-2034-48b3-86f5-9223cc490378","a0eae44a-d0fd-40ab-aac4-769bd1739dfc","60b7217f-697e-48b0-8e60-9220cd013abf","650e9bea-3381-488a-a8d6-9976db8941b8","276cb92d-6bba-4a5b-a538-1c4cd1b18c8e","11f7c961-6d4a-4f32-9b71-6e7f8f92f497","807facbd-4a2a-4aa2-a825-9ebd70797821","ad759940-e9fb-4771-9c3a-68cab8cec2f7","1ead05f1-017b-4e24-8e94-d2140384f6e5","caa84549-36da-47c4-83d5-54874af9e712","20c6dac3-4a04-4308-b945-9224f65ac73e","4b00d037-3e55-4411-b80a-6b53392e1c4d"],"format":{"page_icon":"👹","page_cover":"https://images.unsplash.com/photo-1561411996-3794338f63cc?ixlib=rb-1.2.1\u0026q=85\u0026fm=jpg\u0026crop=entropy\u0026cs=srgb\u0026ixid=eyJhcHBfaWQiOjYzOTIxfQ","page_full_width":false,"page_small_text":true,"copied_from_pointer":{"id":"982e294c-abb2-47aa-8781-34d8bb6fd6ce","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"page_cover_position":0.7072},"created_time":1666030971351,"last_edited_time":1666031100000,"parent_id":"e34bec60-9b02-4ad8-aaf8-83369409cc9f","parent_table":"collection","alive":true,"copied_from":"982e294c-abb2-47aa-8781-34d8bb6fd6ce","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"a6089909-2d0d-43ef-af93-5e041712e826":{"role":"reader","value":{"id":"a6089909-2d0d-43ef-af93-5e041712e826","version":59,"type":"collection_view_page","view_ids":["065b98d2-d3b4-4dab-8b96-4eb118a3f311"],"collection_id":"e34bec60-9b02-4ad8-aaf8-83369409cc9f","format":{"block_locked":false,"block_locked_by":"2c0e0b01-f59e-4e03-b7b6-7d706eecada3","collection_pointer":{"id":"e34bec60-9b02-4ad8-aaf8-83369409cc9f","table":"collection","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"copied_from_pointer":{"id":"adc3552c-fc73-442a-b504-8d4b1eb0079a","table":"block","spaceId":"ac4cb96d-c8f8-4040-9bb2-868d9fc7f526"}},"permissions":[{"role":"editor","type":"user_permission","user_id":"f594524b-0941-4aea-99a2-9b9304033287"},{"role":"reader","type":"public_permission","added_timestamp":1666006306008}],"created_time":1665993658476,"last_edited_time":1666031141858,"parent_id":"b0a64676-90b9-4734-9c63-2d704ee573b6","parent_table":"space","alive":true,"copied_from":"adc3552c-fc73-442a-b504-8d4b1eb0079a","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"936c275f-907f-43c0-aab6-f8abc6b3442b":{"role":"reader","value":{"id":"936c275f-907f-43c0-aab6-f8abc6b3442b","version":1,"type":"text","format":{"copied_from_pointer":{"id":"65eb3916-5001-42db-8115-b161d79ad878","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"65eb3916-5001-42db-8115-b161d79ad878","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"1fe63a30-9077-4275-93af-c9e803c46bdc":{"role":"reader","value":{"id":"1fe63a30-9077-4275-93af-c9e803c46bdc","version":1,"type":"table_of_contents","format":{"block_color":"gray","copied_from_pointer":{"id":"ae374395-8978-43c3-b068-26ed14984083","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"ae374395-8978-43c3-b068-26ed14984083","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"f2eed844-3596-4169-9f98-b4b652d48ac2":{"role":"reader","value":{"id":"f2eed844-3596-4169-9f98-b4b652d48ac2","version":1,"type":"text","format":{"copied_from_pointer":{"id":"1df92409-ac02-4080-b676-fc7d3bdd70f1","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"1df92409-ac02-4080-b676-fc7d3bdd70f1","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"79e6698b-2b37-4b4b-a018-5e5b03611a6d":{"role":"reader","value":{"id":"79e6698b-2b37-4b4b-a018-5e5b03611a6d","version":1,"type":"quote","properties":{"title":[["作为一只以 Django 作为主力开发框架的 CRUD Boy ，时常和它的 ORM 缠绵悱恻、纠缠不清，特此记录一下这些笑与泪的记忆。"]]},"format":{"copied_from_pointer":{"id":"4a306f5e-d2fc-4f81-bb02-3f2c5beaabfa","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"4a306f5e-d2fc-4f81-bb02-3f2c5beaabfa","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"e3e85db9-8a02-4f2e-89c2-7724a85cdff7":{"role":"reader","value":{"id":"e3e85db9-8a02-4f2e-89c2-7724a85cdff7","version":1,"type":"header","properties":{"title":[["魔鬼的陷阱"]]},"format":{"copied_from_pointer":{"id":"6c1bbcd6-6e4d-4e77-8284-4ab050c1219b","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"6c1bbcd6-6e4d-4e77-8284-4ab050c1219b","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"c0a60e38-65e1-41aa-958b-8b0859d297d1":{"role":"reader","value":{"id":"c0a60e38-65e1-41aa-958b-8b0859d297d1","version":1,"type":"sub_header","properties":{"title":[["QuerySet",[["c"]]],[" 的类型"]]},"format":{"copied_from_pointer":{"id":"c436ae0e-bfb3-4819-bc4f-b3fbe9246a57","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"c436ae0e-bfb3-4819-bc4f-b3fbe9246a57","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"40ae1b8f-705c-4b74-b78c-34e0d375ed3f":{"role":"reader","value":{"id":"40ae1b8f-705c-4b74-b78c-34e0d375ed3f","version":1,"type":"sub_sub_header","properties":{"title":[["有时候希望它简单一点"]]},"format":{"copied_from_pointer":{"id":"120a19e1-3232-487f-9622-5b1ae3e82b96","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971347,"last_edited_time":1666030971347,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"120a19e1-3232-487f-9622-5b1ae3e82b96","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"5c6edeab-0daf-47d2-90d3-46761ee0a478":{"role":"reader","value":{"id":"5c6edeab-0daf-47d2-90d3-46761ee0a478","version":1,"type":"text","properties":{"title":[[" "],["objects.values()",[["c"]]],[" 返回的并不是简单类型的数据，而是 "],["QuerySet",[["c"]]],["。一般直接用来做 "],["Response",[["c"]]],[" 没有问题，但是要知道 "],["QuerySet",[["c"]]],[" 是不能被 "],["pickle",[["c"]]],[" 的，如果使用到 "],["Django Cache",[["c"]]],[" 之类功能，直接用 "],["values()",[["c"]]],[" 当作返回会死得很惨。"]]},"format":{"copied_from_pointer":{"id":"e8e3441e-58f6-4808-a572-17549b7d07ef","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"e8e3441e-58f6-4808-a572-17549b7d07ef","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"fc3cacf1-f5f6-4584-aa73-78a6ed6eb534":{"role":"reader","value":{"id":"fc3cacf1-f5f6-4584-aa73-78a6ed6eb534","version":1,"type":"text","format":{"copied_from_pointer":{"id":"ff5f9408-39bc-48d8-9ae0-16731aa9c6ed","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"ff5f9408-39bc-48d8-9ae0-16731aa9c6ed","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"83f4bca1-ceec-4b11-96a8-51b58aa280b7":{"role":"reader","value":{"id":"83f4bca1-ceec-4b11-96a8-51b58aa280b7","version":1,"type":"sub_sub_header","properties":{"title":[["有时候希望它坚持自我"]]},"format":{"copied_from_pointer":{"id":"f603f2fb-d032-4a84-99a7-3d36b96392f8","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"f603f2fb-d032-4a84-99a7-3d36b96392f8","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"56564acd-2888-4373-9c32-a6e943f2df96":{"role":"reader","value":{"id":"56564acd-2888-4373-9c32-a6e943f2df96","version":1,"type":"text","properties":{"title":[["很多时候我们需要限制 "],["QuerySet",[["c"]]],[" 返回的字段以加快 DB 查询的速度（比如一些没索引的长字段)，这时候可能的两个方法： "],["only()",[["c"]]],[" \u0026 "],["values()",[["c"]]],[" 。"]]},"format":{"copied_from_pointer":{"id":"0e3ffa2a-8eab-498d-a16d-8858bc82861c","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971347,"last_edited_time":1666030971347,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"0e3ffa2a-8eab-498d-a16d-8858bc82861c","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"a9c1f10f-227c-441e-a40c-390997431a51":{"role":"reader","value":{"id":"a9c1f10f-227c-441e-a40c-390997431a51","version":1,"type":"text","properties":{"title":[["但实际情况是，使用 "],["values()",[["c"]]],[" 会改变 "],["queryset._iterable_class",[["c"]]],[" ，如果后面还有更多的级联查询，会导致最后的结果为 "],["Dict",[["c"]]],[" 而不是 "],["QuerySet",[["c"]]],["。"]]},"format":{"copied_from_pointer":{"id":"1a76639d-83a6-4d25-81c9-40d2f6b2fcb7","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"1a76639d-83a6-4d25-81c9-40d2f6b2fcb7","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"f9796d63-a4f5-47cb-a320-179ba9fd2942":{"role":"reader","value":{"id":"f9796d63-a4f5-47cb-a320-179ba9fd2942","version":1,"type":"text","format":{"copied_from_pointer":{"id":"df8188cb-b2bc-4446-b331-07f9dbff5f45","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"df8188cb-b2bc-4446-b331-07f9dbff5f45","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"37626933-f62a-4d4a-87e3-ec09f39c507d":{"role":"reader","value":{"id":"37626933-f62a-4d4a-87e3-ec09f39c507d","version":1,"type":"sub_header","properties":{"title":[["多对多和 "],["values()",[["c"]]]]},"format":{"copied_from_pointer":{"id":"6db8e2a3-ed26-4249-93cb-9663b65027db","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"6db8e2a3-ed26-4249-93cb-9663b65027db","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"2f9bc461-2597-4862-86fb-55f704988d2c":{"role":"reader","value":{"id":"2f9bc461-2597-4862-86fb-55f704988d2c","version":1,"type":"text","properties":{"title":[["存在一个模型"]]},"format":{"copied_from_pointer":{"id":"2312ce96-c541-4a7a-baa0-6aabeea7b424","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"2312ce96-c541-4a7a-baa0-6aabeea7b424","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"a9ede1bf-401a-46f1-b5c7-9e345a8d1f54":{"role":"reader","value":{"id":"a9ede1bf-401a-46f1-b5c7-9e345a8d1f54","version":1,"type":"code","properties":{"title":[["class Foo(models.Model):\n    name = models.CharField(**some_params)\n    bars = models.ManyToManyField(**some_params)"]],"language":[["Python"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"516ac619-6479-4145-9525-fa359a8e25ce","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"516ac619-6479-4145-9525-fa359a8e25ce","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"77a12c0e-5dfa-49e3-8f8d-e3a7bb2880ef":{"role":"reader","value":{"id":"77a12c0e-5dfa-49e3-8f8d-e3a7bb2880ef","version":1,"type":"text","properties":{"title":[["存在一条记录"]]},"format":{"copied_from_pointer":{"id":"a594144a-4bfa-4a12-99f9-cd22b8cb05d9","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"a594144a-4bfa-4a12-99f9-cd22b8cb05d9","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"6d7fbd7f-9399-4d49-a1cb-0727a8bccc0a":{"role":"reader","value":{"id":"6d7fbd7f-9399-4d49-a1cb-0727a8bccc0a","version":1,"type":"code","properties":{"title":[["foo:\n  name: tom\n  bars:\n    - a\n    - b "]],"language":[["Python"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"ce72c123-4015-44e8-ba02-381db0d0a755","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"ce72c123-4015-44e8-ba02-381db0d0a755","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"207ec462-7bde-4514-b4ed-47bf31fb3a21":{"role":"reader","value":{"id":"207ec462-7bde-4514-b4ed-47bf31fb3a21","version":1,"type":"text","properties":{"title":[[" "],["values()",[["c"]]],[" 预期返回"]]},"format":{"copied_from_pointer":{"id":"7f8fd448-c9c5-46f5-990c-d3cf99b47855","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"7f8fd448-c9c5-46f5-990c-d3cf99b47855","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"ed7f40c4-0030-45ec-8aa5-bff149c425d0":{"role":"reader","value":{"id":"ed7f40c4-0030-45ec-8aa5-bff149c425d0","version":1,"type":"code","properties":{"title":[["[\n    {\n        \"name\": \"tom\",\n        \"bars\": [\"a\", \"b\"]\n    }\n]"]],"language":[["JSON"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"47d04002-f095-4b63-8a2f-e2d0c273586c","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"47d04002-f095-4b63-8a2f-e2d0c273586c","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"2c1a79a3-370b-4ead-b28b-d9d8caed2a6b":{"role":"reader","value":{"id":"2c1a79a3-370b-4ead-b28b-d9d8caed2a6b","version":1,"type":"text","properties":{"title":[["实际返回"]]},"format":{"copied_from_pointer":{"id":"0d8a49ef-dc9a-4ea8-a01d-3a66f92ef8ad","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971347,"last_edited_time":1666030971347,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"0d8a49ef-dc9a-4ea8-a01d-3a66f92ef8ad","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"bef14558-c34d-4da6-8ffd-9dfde85990bb":{"role":"reader","value":{"id":"bef14558-c34d-4da6-8ffd-9dfde85990bb","version":1,"type":"code","properties":{"title":[["[\n    {\n        \"name\": \"tom\",\n        \"bars\": \"a\"\n    },\n    {\n        \"name\": \"tom\",\n        \"bars\": \"b\"\n    }\n]"]],"language":[["JSON"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"376ac1aa-ae6a-490b-a7f1-c4293e6d3c6f","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"376ac1aa-ae6a-490b-a7f1-c4293e6d3c6f","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"db7d5fe4-8d1e-479c-bbdd-af92429cb0f3":{"role":"reader","value":{"id":"db7d5fe4-8d1e-479c-bbdd-af92429cb0f3","version":1,"type":"text","format":{"copied_from_pointer":{"id":"2fa597b3-038e-4882-8349-30f673a51010","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"2fa597b3-038e-4882-8349-30f673a51010","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"9e89de42-062b-47d1-95da-c95681c63af9":{"role":"reader","value":{"id":"9e89de42-062b-47d1-95da-c95681c63af9","version":1,"type":"text","properties":{"title":[["没有什么太好的调整办法，只能注意 + 规避，详见: "]]},"format":{"copied_from_pointer":{"id":"31904386-08db-4193-921b-84728cfdef7c","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"31904386-08db-4193-921b-84728cfdef7c","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"69e08162-93c5-4488-935d-483e27c9e8e5":{"role":"reader","value":{"id":"69e08162-93c5-4488-935d-483e27c9e8e5","version":1,"type":"bookmark","properties":{"link":[["https://docs.djangoproject.com/en/1.11/ref/models/querysets/#values"]],"title":[["QuerySet API reference | Django documentation | Django"]],"description":[["Django provides a range of refinement methods that modify either the types of results returned by the or the way its SQL query is executed. Returns a new containing objects that do not match the given lookup parameters. The lookup parameters () should be in the format described in Field lookups below."]]},"format":{"bookmark_icon":"https://static.djangoproject.com/img/favicon.6dbf28c0650e.ico","copied_from_pointer":{"id":"ed9afc00-e697-47ce-940c-ca0c9bc3ce0d","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"ed9afc00-e697-47ce-940c-ca0c9bc3ce0d","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"68736346-8dda-4527-8fee-4529018ff7c5":{"role":"reader","value":{"id":"68736346-8dda-4527-8fee-4529018ff7c5","version":1,"type":"image","properties":{"source":[["https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d55d79b9-fe83-43dd-8194-f02c9fea19d8/Untitled.png"]]},"format":{"block_width":873,"display_source":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d55d79b9-fe83-43dd-8194-f02c9fea19d8/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.14776632302405499,"copied_from_pointer":{"id":"f26dd53e-313f-4959-86af-a0be00dbaf06","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"block_preserve_scale":true},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"f26dd53e-313f-4959-86af-a0be00dbaf06","file_ids":["d55d79b9-fe83-43dd-8194-f02c9fea19d8"],"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"cb1c4492-1866-4166-a363-7abdbc2f7c40":{"role":"reader","value":{"id":"cb1c4492-1866-4166-a363-7abdbc2f7c40","version":1,"type":"text","format":{"copied_from_pointer":{"id":"26a0e17b-df14-4da9-beb8-c803ff731926","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"26a0e17b-df14-4da9-beb8-c803ff731926","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"fe6231d4-a0f3-4ef0-b6a4-68b68518714b":{"role":"reader","value":{"id":"fe6231d4-a0f3-4ef0-b6a4-68b68518714b","version":1,"type":"sub_header","properties":{"title":[["ORM 终究只是 ORM"]]},"format":{"copied_from_pointer":{"id":"6c9af6e6-75e4-48fe-a225-e5a014efe4e5","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"6c9af6e6-75e4-48fe-a225-e5a014efe4e5","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"f6064d56-1621-4ebf-a3fc-4d15e2f61df7":{"role":"reader","value":{"id":"f6064d56-1621-4ebf-a3fc-4d15e2f61df7","version":1,"type":"text","format":{"copied_from_pointer":{"id":"c4515a80-83a4-4225-9f29-3ef3c0e3ab38","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"c4515a80-83a4-4225-9f29-3ef3c0e3ab38","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"0b349c09-3a95-4cad-bc9b-dceda7438089":{"role":"reader","value":{"id":"0b349c09-3a95-4cad-bc9b-dceda7438089","version":1,"type":"text","properties":{"title":[["我们要时刻记住, "],["orm",[["c"]]],[" 只是做一个映射，有时候拿到的对象和我们预想并不能完全一致。"]]},"format":{"copied_from_pointer":{"id":"72e813d0-12b1-403f-8ec3-cf7c158dd7c5","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"72e813d0-12b1-403f-8ec3-cf7c158dd7c5","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"ea605c0b-de9c-45f0-a0b7-365205455b9d":{"role":"reader","value":{"id":"ea605c0b-de9c-45f0-a0b7-365205455b9d","version":1,"type":"sub_sub_header","properties":{"title":[["隐式转换"]]},"format":{"copied_from_pointer":{"id":"701ba0fe-2137-4e35-bd15-9414d89b92b3","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"701ba0fe-2137-4e35-bd15-9414d89b92b3","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"d53b617f-7e36-48ba-9525-0ad1284e736d":{"role":"reader","value":{"id":"d53b617f-7e36-48ba-9525-0ad1284e736d","version":1,"type":"code","properties":{"title":[["class Foo(models.Model):\n    created = models.DateTimeField()\n\n# 这里先忽略 timezone 问题\nf1 = Foo(created='2020-09-18 09:46:23.544799')\n\n# 字符串会被存储，Django 做了隐式转换\nf1.save()\n\n# str\nprint(type(f1.created))\n\nf2 = Foo.objects.get(pk=f1.pk)\n\n# Datetime 对象！\nprint(type(f2.created))"]],"language":[["Python"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"9fd7c1a9-f5ce-4591-a7a8-316455423263","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"9fd7c1a9-f5ce-4591-a7a8-316455423263","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"1c90c81d-efb7-4e54-95c0-eaa76b5c5b7b":{"role":"reader","value":{"id":"1c90c81d-efb7-4e54-95c0-eaa76b5c5b7b","version":1,"type":"text","format":{"copied_from_pointer":{"id":"34abe9dc-3682-4f97-bf4b-46f29816ac85","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"34abe9dc-3682-4f97-bf4b-46f29816ac85","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"f10859c3-1227-4767-89ab-82b52a004a7c":{"role":"reader","value":{"id":"f10859c3-1227-4767-89ab-82b52a004a7c","version":1,"type":"text","properties":{"title":[["通过以上的例子就能知道，我们自己创建的内存对象 "],["f1",[["c"]]],[" 和通过 "],["orm",[["c"]]],[" 拿出来的内存对象 "],["f2",[["c"]]],[" 完全不是同一个东西，虽然他们都可以操作同一条数据库记录，但如果在内存对象里做比较就会有很多问题，比如下面的例子"]]},"format":{"copied_from_pointer":{"id":"83a9e6e0-d99f-4295-a673-b051a47669dd","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"83a9e6e0-d99f-4295-a673-b051a47669dd","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"f4a427e7-34fb-4998-91d5-5cd04f330f81":{"role":"reader","value":{"id":"f4a427e7-34fb-4998-91d5-5cd04f330f81","version":1,"type":"text","format":{"copied_from_pointer":{"id":"ba597644-6ab8-4f75-8736-43606d6035ca","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"ba597644-6ab8-4f75-8736-43606d6035ca","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"d7206662-fde3-4ea3-be2f-ec4872dad2d3":{"role":"reader","value":{"id":"d7206662-fde3-4ea3-be2f-ec4872dad2d3","version":1,"type":"sub_sub_header","properties":{"title":[["Mysql 低版本时间精度问题"]]},"format":{"copied_from_pointer":{"id":"d4c35226-3bb6-4a00-8bc8-1cba9941d68c","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"d4c35226-3bb6-4a00-8bc8-1cba9941d68c","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"130fb25e-713c-473d-bb72-27365c30743f":{"role":"reader","value":{"id":"130fb25e-713c-473d-bb72-27365c30743f","version":1,"type":"code","properties":{"title":[["class Foo(models.Model):\n    created = models.DateTimeField(auto_now_add=True)\n\n# 假定 Foo 表中已经存在了比较多的记录\nf = Foo.objects.create()\n\n# 我们预期是获取按照时间来排序，f 的前一条记录\no = Foo.objects.filter(created_lt=f.created).latest('created')\n\nassert o.pk == f.pk\n# mysql 版本大于 5.6.4 时 -\u003e False\n# mysql 版本小于 5.6.4 时 -\u003e True"]],"language":[["Python"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"85486655-3124-422a-a2c6-c9bd317148b8","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"85486655-3124-422a-a2c6-c9bd317148b8","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"de497095-55a1-4596-b162-2a537a3024f1":{"role":"reader","value":{"id":"de497095-55a1-4596-b162-2a537a3024f1","version":1,"type":"text","properties":{"title":[["原因很简单，当 "],["mysql",[["c"]]],[" 版本小于 "],["5.6.4",[["c"]]],[" 时是不支持 "],["microseconds",[["c"]]],[" 的，由于我们的 "],["f",[["c"]]],[" 是内存对象，拿到的 "],["created",[["c"]]],[" 又是有 "],["microseconds",[["c"]]],[" 的，相当于我们在用 "],["2020-09-18 09:24:38.260779",[["c"]]],[" 和 "],["2020-09-18 09:24:38.000000",[["c"]]],[" 做比较， "],["o",[["c"]]],[" 一直拿到的就是 "],["f",[["c"]]],[" 对应的记录..."]]},"format":{"copied_from_pointer":{"id":"c8504db6-20c6-4ef2-9ab1-69a63ea1320b","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"c8504db6-20c6-4ef2-9ab1-69a63ea1320b","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"ffbce2a6-66df-43e3-8c89-a4b3bcd5900d":{"role":"reader","value":{"id":"ffbce2a6-66df-43e3-8c89-a4b3bcd5900d","version":1,"type":"image","properties":{"source":[["https://s3-us-west-2.amazonaws.com/secure.notion-static.com/53b61d4b-0742-48a9-ac2c-54311236400f/Untitled.png"]]},"format":{"block_width":432,"display_source":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/53b61d4b-0742-48a9-ac2c-54311236400f/Untitled.png","block_full_width":false,"block_page_width":false,"block_aspect_ratio":0.37254901960784315,"copied_from_pointer":{"id":"abb45429-6588-4cd4-8b07-04b7543b06c8","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"},"block_preserve_scale":true},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"abb45429-6588-4cd4-8b07-04b7543b06c8","file_ids":["53b61d4b-0742-48a9-ac2c-54311236400f"],"created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"64fd0798-053d-4d7e-afb4-4993b51e5670":{"role":"reader","value":{"id":"64fd0798-053d-4d7e-afb4-4993b51e5670","version":1,"type":"text","format":{"copied_from_pointer":{"id":"e770841d-a565-4cbe-b6d4-d6119198f395","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"e770841d-a565-4cbe-b6d4-d6119198f395","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"9689bbbc-7f97-4606-b07f-55eaf57f3729":{"role":"reader","value":{"id":"9689bbbc-7f97-4606-b07f-55eaf57f3729","version":1,"type":"sub_header","properties":{"title":[["虚假的 "],[".query",[["c"]]]]},"format":{"copied_from_pointer":{"id":"f618f11c-eb5f-4e6e-b7cd-69cc151f026b","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"f618f11c-eb5f-4e6e-b7cd-69cc151f026b","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"376518ba-e236-405b-b938-8f711116cba5":{"role":"reader","value":{"id":"376518ba-e236-405b-b938-8f711116cba5","version":1,"type":"text","format":{"copied_from_pointer":{"id":"bcfcf9ae-9941-4f86-a116-a21fbbd7fd0f","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"bcfcf9ae-9941-4f86-a116-a21fbbd7fd0f","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"157e2ee7-ba93-4f50-b42c-014a4b0d2825":{"role":"reader","value":{"id":"157e2ee7-ba93-4f50-b42c-014a4b0d2825","version":1,"type":"text","properties":{"title":[["我们常常用 "],["queryset.query",[["c"]]],[" 去检查复杂的查询语句，但实际上 "],["query",[["c"]]],[" 属性并不能真实反应提交到 DB 中的 "],["sql",[["c"]]],[" ，可以参考如下链接："]]},"format":{"copied_from_pointer":{"id":"a692a669-d955-4f99-97df-85f289c8ac84","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"a692a669-d955-4f99-97df-85f289c8ac84","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"7693a13c-ccc7-4f69-83d7-14291a1243c7":{"role":"reader","value":{"id":"7693a13c-ccc7-4f69-83d7-14291a1243c7","version":1,"type":"bookmark","properties":{"link":[["https://code.djangoproject.com/ticket/17741"]],"title":[["QuerySet.query.__str__() does not generate valid MySQL query with dates"]],"description":[["If you have a date parameter in a QuerySet, the string of the query is not valid SQL in MySQL and will generate a warning."]]},"format":{"bookmark_icon":"https://code.djangoproject.com/favicon.ico","copied_from_pointer":{"id":"dadcf3b3-611d-47c0-9032-bc3866edee31","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"dadcf3b3-611d-47c0-9032-bc3866edee31","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"7801ab17-d17d-413c-80cb-3d31712c22a4":{"role":"reader","value":{"id":"7801ab17-d17d-413c-80cb-3d31712c22a4","version":1,"type":"text","format":{"copied_from_pointer":{"id":"f8033d2a-cf7a-419b-a31e-4302c024ef6c","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"f8033d2a-cf7a-419b-a31e-4302c024ef6c","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"5fa8497e-330a-4e78-9ad2-e79f7b8c89c3":{"role":"reader","value":{"id":"5fa8497e-330a-4e78-9ad2-e79f7b8c89c3","version":1,"type":"text","properties":{"title":[["那么如何调试提交到 DB 中的具体语句呢？"]]},"format":{"copied_from_pointer":{"id":"f35f10b1-8b21-4aad-8383-e122260b182d","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"f35f10b1-8b21-4aad-8383-e122260b182d","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"a66be089-52cc-46e3-9bbb-8611bbe44407":{"role":"reader","value":{"id":"a66be089-52cc-46e3-9bbb-8611bbe44407","version":1,"type":"code","properties":{"title":[["from django.db import connection\n\n# 在语句提交之后，立即打印\n# 同时需要记得开启 DEBUG = True\nprint(connection.queries)"]],"language":[["Python"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"dbb143ee-8380-465e-a587-73d6184445db","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"dbb143ee-8380-465e-a587-73d6184445db","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"3cc35a64-ab6c-477e-a23a-f2c38fdda0fa":{"role":"reader","value":{"id":"3cc35a64-ab6c-477e-a23a-f2c38fdda0fa","version":1,"type":"text","properties":{"title":[["再或者，直接"],["在 DB 中开启 general_log",[["a","https://stackoverflow.com/questions/650238/how-to-show-the-last-queries-executed-on-mysql"]]],[" 。"]]},"format":{"copied_from_pointer":{"id":"4039d41f-0f20-48bd-8f36-2b2bf8074361","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"4039d41f-0f20-48bd-8f36-2b2bf8074361","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"79ca90d4-1606-452a-baa5-442e8b96bac6":{"role":"reader","value":{"id":"79ca90d4-1606-452a-baa5-442e8b96bac6","version":1,"type":"text","format":{"copied_from_pointer":{"id":"4c22b1b1-5bf0-4ca9-ab2d-4d5749343835","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"4c22b1b1-5bf0-4ca9-ab2d-4d5749343835","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"dcb90849-e2a9-421a-be5c-f17738f42353":{"role":"reader","value":{"id":"dcb90849-e2a9-421a-be5c-f17738f42353","version":1,"type":"header","properties":{"title":[["天使的眼泪"]]},"format":{"copied_from_pointer":{"id":"1ea4c6d5-33ef-44b0-8d83-64ea11a16bb8","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"1ea4c6d5-33ef-44b0-8d83-64ea11a16bb8","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"d7db0cec-6b57-49b7-a651-20d16431a336":{"role":"reader","value":{"id":"d7db0cec-6b57-49b7-a651-20d16431a336","version":1,"type":"sub_header","properties":{"title":[["巧用 extra"]]},"format":{"copied_from_pointer":{"id":"162617b0-46c9-41da-9973-4d9bc18c8eca","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971347,"last_edited_time":1666030971347,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"162617b0-46c9-41da-9973-4d9bc18c8eca","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"6fcd68be-8589-49cc-b4bb-efbad5eeefc2":{"role":"reader","value":{"id":"6fcd68be-8589-49cc-b4bb-efbad5eeefc2","version":1,"type":"bookmark","properties":{"link":[["https://docs.djangoproject.com/en/1.11/ref/models/querysets/#extra"]],"title":[["QuerySet API reference | Django documentation | Django"]],"description":[["Django provides a range of refinement methods that modify either the types of results returned by the or the way its SQL query is executed. Returns a new containing objects that do not match the given lookup parameters. The lookup parameters () should be in the format described in Field lookups below."]]},"format":{"bookmark_icon":"https://static.djangoproject.com/img/favicon.6dbf28c0650e.ico","copied_from_pointer":{"id":"f12494a7-a8bc-4c25-8898-6d5052d0b457","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"f12494a7-a8bc-4c25-8898-6d5052d0b457","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"fbd54699-ed28-48d7-8442-3481581d7509":{"role":"reader","value":{"id":"fbd54699-ed28-48d7-8442-3481581d7509","version":1,"type":"text","format":{"copied_from_pointer":{"id":"403186d6-8af1-4bd4-9add-2428bb10df36","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"403186d6-8af1-4bd4-9add-2428bb10df36","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"a0312ff2-7381-40f5-8917-c4d869008216":{"role":"reader","value":{"id":"a0312ff2-7381-40f5-8917-c4d869008216","version":1,"type":"text","properties":{"title":[["extra()",[["c"]]],[" 可以利用 "],["sql",[["c"]]],[" 在数据库中做数据处理，而不用放到内存中，在数据量较大时有比较好的效果，比如："]]},"format":{"copied_from_pointer":{"id":"7005ffc7-17ee-4130-bc43-297c3b2aafd5","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"7005ffc7-17ee-4130-bc43-297c3b2aafd5","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"046dc19c-fb16-42ad-9b56-bdbd2437116b":{"role":"reader","value":{"id":"046dc19c-fb16-42ad-9b56-bdbd2437116b","version":1,"type":"text","format":{"copied_from_pointer":{"id":"a3ed25e3-5d9b-4c56-8e84-ed89d614787d","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"a3ed25e3-5d9b-4c56-8e84-ed89d614787d","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"3d7c56fd-3487-40d2-9c49-4baef2da8003":{"role":"reader","value":{"id":"3d7c56fd-3487-40d2-9c49-4baef2da8003","version":1,"type":"code","properties":{"title":[["queryset = queryset.extra(select={'username': \"CONCAT(username, '@', domain)\"})"]],"language":[["Python"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"4e74cfc4-290f-4cf3-880b-1ce716f2fd81","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"4e74cfc4-290f-4cf3-880b-1ce716f2fd81","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"eda135b0-f9fb-4ae4-8977-d411b912794d":{"role":"reader","value":{"id":"eda135b0-f9fb-4ae4-8977-d411b912794d","version":1,"type":"text","format":{"copied_from_pointer":{"id":"f51be009-8d88-4db1-a0b8-0443262781f4","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"f51be009-8d88-4db1-a0b8-0443262781f4","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"9982532e-d189-4d3b-9269-64e634c6991c":{"role":"reader","value":{"id":"9982532e-d189-4d3b-9269-64e634c6991c","version":1,"type":"text","properties":{"title":[["在模糊查询时，匹配最短结果"]]},"format":{"copied_from_pointer":{"id":"78702bc4-1685-42bf-8f1d-77913cb25ac1","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"78702bc4-1685-42bf-8f1d-77913cb25ac1","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"0f736186-a891-4951-b65d-c109eaeebd02":{"role":"reader","value":{"id":"0f736186-a891-4951-b65d-c109eaeebd02","version":1,"type":"code","properties":{"title":[["MyModel.objects.extra(select={'myfield_length':'Length(myfield)'}).order_by('myfield_length')"]],"language":[["Python"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"f75715e8-c09c-42b6-af63-05e5800e1622","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"f75715e8-c09c-42b6-af63-05e5800e1622","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"8348268a-daa8-4ffb-a45b-ca8f31e06b0c":{"role":"reader","value":{"id":"8348268a-daa8-4ffb-a45b-ca8f31e06b0c","version":1,"type":"text","format":{"copied_from_pointer":{"id":"049161c4-4319-4efb-bc90-c78469ce4674","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971347,"last_edited_time":1666030971347,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"049161c4-4319-4efb-bc90-c78469ce4674","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"5903bfac-2034-48b3-86f5-9223cc490378":{"role":"reader","value":{"id":"5903bfac-2034-48b3-86f5-9223cc490378","version":1,"type":"text","properties":{"title":[["但在同时需要格外小心， "],["extra()",[["c"]]],[" 在参数上存在注入风险，所有可能的用户输入的 SQL 拼接，都应该交给 Django 处理。"]]},"format":{"copied_from_pointer":{"id":"ebfff28f-8890-470e-ac3b-1f29f03ed1c3","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"ebfff28f-8890-470e-ac3b-1f29f03ed1c3","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"a0eae44a-d0fd-40ab-aac4-769bd1739dfc":{"role":"reader","value":{"id":"a0eae44a-d0fd-40ab-aac4-769bd1739dfc","version":1,"type":"code","properties":{"title":[["# 有注入风险, username 不会被转义，可以直接注入\nEntry.objects.extra(where=[f\"headline='{username}'\"])\n\n# 安全，Django 会将 username 内容转义\nEntry.objects.extra(where=['headline=%s'], params=[username])"]],"language":[["Python"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"9f2f462d-ece7-4c03-aa64-3fe99cac1985","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"9f2f462d-ece7-4c03-aa64-3fe99cac1985","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"60b7217f-697e-48b0-8e60-9220cd013abf":{"role":"reader","value":{"id":"60b7217f-697e-48b0-8e60-9220cd013abf","version":1,"type":"sub_header","properties":{"title":[["JsonField",[["c"]]],[" 的福音—— "],["JSON_SEARCH",[["c"]]]]},"format":{"copied_from_pointer":{"id":"acc07a2e-8c4e-425b-b3a3-f3a7f48cf0cc","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"acc07a2e-8c4e-425b-b3a3-f3a7f48cf0cc","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"650e9bea-3381-488a-a8d6-9976db8941b8":{"role":"reader","value":{"id":"650e9bea-3381-488a-a8d6-9976db8941b8","version":1,"type":"text","properties":{"title":[["有时候我们需要使用动态字段，并且保证动态字段的值全表唯一。动态字段我们使用 "],["LONGTEXT",[["c"]]],[" 存储，格式为 "],["JSON",[["c"]]],[" 。如果手动处理，需要将整个表的字段放到内存，并做唯一校验，非常麻烦且耗时。"]]},"format":{"copied_from_pointer":{"id":"dbdb29f2-6067-48aa-b873-230f4e581bb5","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971350,"last_edited_time":1666030971350,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"dbdb29f2-6067-48aa-b873-230f4e581bb5","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"276cb92d-6bba-4a5b-a538-1c4cd1b18c8e":{"role":"reader","value":{"id":"276cb92d-6bba-4a5b-a538-1c4cd1b18c8e","version":1,"type":"text","properties":{"title":[["所以还是一个道理，把这个逻辑交给 DB"]]},"format":{"copied_from_pointer":{"id":"1ab7b6b7-335d-42d9-ad36-3862e1e044b8","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"1ab7b6b7-335d-42d9-ad36-3862e1e044b8","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"11f7c961-6d4a-4f32-9b71-6e7f8f92f497":{"role":"reader","value":{"id":"11f7c961-6d4a-4f32-9b71-6e7f8f92f497","version":1,"type":"code","properties":{"title":[["select * from profiles_profile where JSON_SEARCH(extras, \"one\", \"aaa\") is not null;"]],"language":[["SQL"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"7c451391-7905-4983-b5ef-c9ceaa50b6f6","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"7c451391-7905-4983-b5ef-c9ceaa50b6f6","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"807facbd-4a2a-4aa2-a825-9ebd70797821":{"role":"reader","value":{"id":"807facbd-4a2a-4aa2-a825-9ebd70797821","version":1,"type":"text","format":{"copied_from_pointer":{"id":"c1660190-9fca-4a63-ab73-cb94f27d905b","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"c1660190-9fca-4a63-ab73-cb94f27d905b","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"ad759940-e9fb-4771-9c3a-68cab8cec2f7":{"role":"reader","value":{"id":"ad759940-e9fb-4771-9c3a-68cab8cec2f7","version":1,"type":"sub_header","properties":{"title":[["行锁的支持"]]},"format":{"copied_from_pointer":{"id":"4d5853a0-7d6d-48a1-97c3-cd1e428933a7","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"4d5853a0-7d6d-48a1-97c3-cd1e428933a7","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"1ead05f1-017b-4e24-8e94-d2140384f6e5":{"role":"reader","value":{"id":"1ead05f1-017b-4e24-8e94-d2140384f6e5","version":1,"type":"text","properties":{"title":[["多个操作互斥的情况下，可以使用 "],["select_for_update",[["c"]]],[" 行锁保证正确性。"]]},"format":{"copied_from_pointer":{"id":"bce18671-696b-47df-8fde-1c582cccdd32","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"bce18671-696b-47df-8fde-1c582cccdd32","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"caa84549-36da-47c4-83d5-54874af9e712":{"role":"reader","value":{"id":"caa84549-36da-47c4-83d5-54874af9e712","version":1,"type":"code","properties":{"title":[["with transaction.atomic():\n    # 仅在 transaction 内生效\n    Entry.objects.select_for_update().filter(name=\"Hello\")"]],"language":[["Python"]]},"format":{"code_wrap":true,"copied_from_pointer":{"id":"7851b7be-70b9-43b7-a130-68b159696e33","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971349,"last_edited_time":1666030971349,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"7851b7be-70b9-43b7-a130-68b159696e33","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"20c6dac3-4a04-4308-b945-9224f65ac73e":{"role":"reader","value":{"id":"20c6dac3-4a04-4308-b945-9224f65ac73e","version":1,"type":"text","format":{"copied_from_pointer":{"id":"145c0edd-05d4-429a-829e-f581838006b3","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971347,"last_edited_time":1666030971347,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"145c0edd-05d4-429a-829e-f581838006b3","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"4b00d037-3e55-4411-b80a-6b53392e1c4d":{"role":"reader","value":{"id":"4b00d037-3e55-4411-b80a-6b53392e1c4d","version":1,"type":"text","properties":{"title":[["但是同时需要注意，上锁的顺序，避免产生死锁。"]]},"format":{"copied_from_pointer":{"id":"5b48843a-1a93-4ade-8495-125e2e246d07","table":"block","spaceId":"b0a64676-90b9-4734-9c63-2d704ee573b6"}},"created_time":1666030971348,"last_edited_time":1666030971348,"parent_id":"c7f44558-498f-44bd-a8a3-504955dde6b1","parent_table":"block","alive":true,"copied_from":"5b48843a-1a93-4ade-8495-125e2e246d07","created_by_table":"notion_user","created_by_id":"f594524b-0941-4aea-99a2-9b9304033287","last_edited_by_table":"notion_user","last_edited_by_id":"f594524b-0941-4aea-99a2-9b9304033287","space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}}},"collection":{"e34bec60-9b02-4ad8-aaf8-83369409cc9f":{"role":"reader","value":{"id":"e34bec60-9b02-4ad8-aaf8-83369409cc9f","version":43,"name":[["布鲁斯鱼的妙想天开 "]],"schema":{"NX\\Q":{"name":"date","type":"date"},"`gQ~":{"name":"type","type":"select","options":[{"id":"5aff2f95-fd1e-489b-8840-bf10bc9519cb","color":"purple","value":"Post"},{"id":"374d2bc6-a144-4832-8ca4-474aaae0ea1f","color":"orange","value":"Page"}]},"d]hq":{"name":"slug","type":"text"},"sD^m":{"name":"tags","type":"multi_select","options":[{"id":"790180f1-0c2e-4730-a1ef-c5463df34680","color":"brown","value":"python"},{"id":"5d668f5e-7204-4c7e-b57e-5558bd27efaf","color":"gray","value":"pep"},{"id":"9081ab60-29ee-4a5b-9989-f50cf36ecb9b","color":"orange","value":"tech"},{"id":"c0225229-afab-45e4-b69b-b71029b39835","color":"red","value":"django"},{"id":"90084124-d1d5-49fb-86e7-4b133c051d81","color":"default","value":"orm"},{"id":"10ace7d0-10e6-4617-970e-acf2d9348d0f","color":"yellow","value":"best-practice"},{"id":"1b9671ca-93e5-402d-a73e-f9aca38e4358","color":"pink","value":"web"}]},"wz|S":{"name":"summary","type":"text"},"title":{"name":"title","type":"title"},"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":{"name":"status","type":"select","options":[{"id":"22460321-fea2-4c7c-b352-a674760780ac","color":"orange","value":"Idea"},{"id":"41d5f5c6-b53c-42bc-8e0f-fc9402048480","color":"yellow","value":"Draft"},{"id":"c7390b31-9fab-4e21-94ee-7e67ea077a97","color":"blue","value":"Revise"},{"id":"7abc61d4-b405-480d-b699-12588755fa65","color":"red","value":"Published"}]}},"icon":"🗯️","format":{"copied_from_pointer":{"id":"6a42b751-ff40-4f34-aa6a-1830a3344cb7","table":"collection","spaceId":"ac4cb96d-c8f8-4040-9bb2-868d9fc7f526"},"collection_page_properties":[{"visible":false,"property":"NX\\Q"},{"visible":false,"property":"d]hq"},{"visible":false,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"visible":false,"property":"sD^m"},{"visible":false,"property":"wz|S"},{"visible":false,"property":"`gQ~"}]},"parent_id":"a6089909-2d0d-43ef-af93-5e041712e826","parent_table":"block","alive":true,"file_ids":["6cf3dc36-2f98-4f0e-9679-1bdbb1485129","5520bd92-e709-4c0d-ad58-06923f23f7e9","624d393a-62e3-4464-a1bf-1c79ecd4fbda","d52f6766-3e32-4c3d-8529-46e1f214360f"],"copied_from":"6a42b751-ff40-4f34-aa6a-1830a3344cb7","migrated":true,"space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6","deleted_schema":{"0d330ccb-d222-4440-a0de-6cccfe926a33":{"name":"url","type":"text"},"2bf55746-6864-4bb6-b585-77b81f140da1":{"name":"inList","type":"checkbox"},"ad8f0878-e947-4188-8970-1ca14665f6e3":{"name":"inMenu","type":"checkbox"},"b2c6f9d4-31e2-4230-b57e-4bdb21a3d635":{"name":"template","type":"select","options":[{"id":"V*ea","color":"purple","value":"post"}]},"c0b15f23-eddd-4316-95d1-a92a4edbc710":{"name":"publish","type":"checkbox"},"e3660c02-9d93-463b-9495-addeeabd3e80":{"name":"description","type":"text"}}}}},"space":{},"collection_view":{"065b98d2-d3b4-4dab-8b96-4eb118a3f311":{"role":"reader","value":{"id":"065b98d2-d3b4-4dab-8b96-4eb118a3f311","version":5,"type":"table","name":"Default view","format":{"table_wrap":false,"table_properties":[{"width":416,"visible":true,"property":"title"},{"width":186,"visible":true,"property":"d]hq"},{"width":211,"visible":true,"property":"NX\\Q"},{"width":147,"visible":true,"property":"wz|S"},{"width":222,"visible":true,"property":"sD^m"},{"width":124,"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"width":100,"visible":true,"property":"`gQ~"},{"width":200,"visible":true,"property":"gY~W"},{"width":200,"visible":true,"property":"pzWp"},{"visible":true,"property":"B;[p"}]},"parent_id":"a6089909-2d0d-43ef-af93-5e041712e826","parent_table":"block","alive":true,"page_sort":["b1e1d645-db95-42e5-8995-39a80eda6460","e8cd3732-dc1c-43ae-959a-a5a611ec098a","e876558d-e878-47f6-8c95-21be678990a5","5a971ded-d3c5-41be-bef9-ddfff48d43a2","8db8b240-e1c5-4dd7-bf74-72584d7a2ce0","daf94ca4-ec56-47a3-84ed-b1e2479acc4b","d1a2db9b-6820-421e-9b80-017ce7478587","67ea9f83-b9f6-416b-afcb-7c64f7533e6c","45939470-9819-47e8-b12b-999cfefa0aad","c60dc33d-8efb-44be-a863-7a87ad047932","fe4b8d5f-7c49-42c6-a7d5-1cb71c4f7e86","b7233a67-c367-4198-831e-f12089568d1f","4f3bf306-92c4-41b7-a43e-957129a1240a","6a789607-66cf-498e-9b32-eb3fa69a84f4","c9429034-dabd-4a25-8782-97f20c808a60","38c49fe2-37f8-4a7f-a99f-9edb9ddad4c2","474eb638-9f6b-46bf-8004-77668293f199","81d6dfab-69cb-43a0-aa04-e9725f0b67e1","7703d956-84db-46cd-b538-48eae1af68b5","9f937c73-dac9-4ed7-9b01-beefcb321f16","3cf9dcb9-e7db-406c-80ab-c65c11fbf906","5827ab53-e051-455b-b90a-3bdc20158c2c","fa7acd3b-dea9-4fb1-b859-5345f35163c6","696dfc48-62c3-494d-96d0-ec5fa84637e8","79df93cf-9b10-452e-bc62-f39e8cd2d124","9bb8e52d-c459-4528-b1b3-c2378207253a","5da038ef-f419-4a11-aa48-587b3787e040","b4a2c9d4-6a2c-49e6-988d-89a538dfe0f6","c374a479-5cc7-4c54-ba69-6a4d76dc25ad","d470fa67-0e7c-40d8-86ac-9b5a8be88dc8","986be38b-9780-4bb9-bdcd-4e361ddbd888","b7613f56-c2d4-4aae-b967-b7471ade86d0","e357d1fc-7466-4d6a-8d48-71b76ea97cdc","e1735855-4089-4af6-bd4d-0d59f7a76cb4","9b34581a-955a-4229-99d0-8f2a6d0e69ce","b4414811-0599-45cf-b047-fa95eac42d89","c28a8a01-911a-40a2-a607-d3af8cb24017","461d07ae-4b4a-49de-bdcb-341af1153201","3df59023-cb68-4a65-afd1-7f0b8c21cb57","0e3223d1-03df-40fb-90f9-cc8559d776b5","4f45b7d6-cd5b-46ab-b2a6-37ae20bf5f21","fa475a21-5f38-43d4-9a89-67c40b3129ae","97cbc634-fe3a-4b9b-9da6-ac4aaa94772f","8a0d34bc-7e8c-4a68-88a5-5276274f612a","623f8788-a20f-45fd-bb82-08935f59b44d","7ee398f0-450b-47cb-9b53-f5e7736590d2","eae9f077-591e-4841-903b-db395513c834","367d0f2a-0b10-4dbb-b53a-613152f124f9","398e2e28-3997-49bc-a138-0467d4da8531","8aaf4633-e879-44dc-82c8-3c9fb9d3a6f8","1eb5e5f2-8dc9-4ffc-b5e1-09b67be27a83","83465fb9-205b-41fc-83a6-424692ee0a0e","fb1d18d0-6403-4e8a-840e-134553748ff5","4407cb77-3838-4ba5-b474-f15222cd3dba","1880b0f2-e036-42d0-9550-0fb08a962397","d8d60bd6-33f6-458f-a7d6-209ef2fb05a1","29bf65ff-888b-4a76-a8dd-bf54f02c3864","bad1d4ae-fd4a-4671-ae94-dd53d94e0eae","0d59792d-db1c-4ae7-8d7c-4f013be40dcf","337dc259-2805-4b1c-a60f-1b3e6c7badb8","4b1b21a8-c278-4bc6-88f1-1a35d407f4d7","7946aba2-d6d0-45ef-8779-23fa15db8f2d","c18dbce6-9e8c-4f4b-b74a-0994e7c1bc3f","84aa87b7-39e7-493c-87b9-5cae4de95449","1446eadb-8c01-4295-be3a-ecf19361c143","fe8a7d94-e9ba-457d-8f19-10fe53e6ca3c","98a5a0b6-b07b-4065-a73f-2949ad28ac47","099219ec-fb4b-459d-a538-f6c3d54f6ca2","e047becf-e696-42e3-84c9-4f6278c844ae","975051d4-ebbc-4b3f-98cf-1a52e5e4761d","e5d98bee-b2d5-4b45-ab0b-b77da24aebe7","acac2668-1062-4e7a-b095-eda067da8413","179025c4-d8a8-4c47-b621-9fd6a6f3339b","d256e5ed-5eac-43bb-a32e-581774962c23","b843dacf-b655-4b1c-a61c-434b67f18154","56a80c2d-0520-415a-a77a-1db82eff0b3a","9c40a253-b9e8-42cd-8a99-62aaa9789a5e","d3a05020-0948-489a-80ac-fedebc035c58","0ee4f3e9-0451-411f-b903-0c83d30e5b67","769f1163-e45e-4c3b-87a7-3b551895d9be","7e217dcd-e4e5-4bcd-b2de-00fcb5ab7fba","28e3d2f6-abb8-4711-b21e-ce1937e3e546","04d4f00b-9608-4d83-949e-b32313ace34e","41f93fa3-0496-4ea7-8ac3-0a8beaf346da","f0db9e3e-0e99-4465-ae65-6a9a8d8a6468","279e794f-519c-44f5-ab04-422fba916b72","f0b2f8a5-7dfd-48dc-ba1f-419a7fda1fff","e874f269-1938-40be-974b-2e499c1f4590","65265d92-050f-4fb5-b529-a514079cdd83","5fc98358-411a-40d7-a5d0-c4089026ca1f","15fcd77a-6097-4ee9-9835-9d6e85897fd6","6f8b1275-2d88-40e2-b76b-375f3c028b03","33273042-efcc-45bc-8f28-b65a1c2c65ad","c18bd396-be21-4ce2-ab22-32a45c28e37f","ba597bcf-7582-4fd2-8049-6333ef3e4453","4edecef8-106d-489d-be1d-d1b528c4cdc9","b03b3109-e900-4daf-b852-a590324ab747","8cba5326-9daa-4c2c-b763-5476dc8a7a91","9ab4aa63-ce81-415f-bf95-e632006a1aea","e3644bfb-4244-4a82-a7d7-d7cdb65aa1ed","b6a1f5b5-febd-4c26-9e29-520290eb5719","51e53e64-e6dd-4fd6-8062-5d4455f0a1cb","f4ec684b-e5f1-44e9-a8a7-aca27f7ca6f3","177fa228-9099-4dd5-8969-c67f9c78bd0c","d5ab0d7a-0123-473f-84d4-81740defb9b4","548f6d36-c509-4b79-9c4b-59f227c7f550","c0901673-4f5e-4e51-ad87-0217f2d33a0c","0787f8d6-dc99-47c6-946e-2b008814bebc","0ade5216-1103-486a-aff0-a709ff825b02","a2c4dd21-985c-497d-b421-c2d8a9ec0eeb","908a498c-f7e3-4668-8afd-f179a027b4d9","4945e5c3-033d-467c-a8b3-b1479c1fdf0a","854f4584-28d5-43bd-938e-88d0957c78e3","6a6574f8-d63d-4fed-99c5-38f3df0364ac"],"query2":{"filter":{"operator":"and"},"aggregations":[{"property":"title","aggregator":"count"}]},"space_id":"b0a64676-90b9-4734-9c63-2d704ee573b6"}}},"notion_user":{},"collection_query":{},"signed_urls":{}},"emailHash":"d54f099771ff5f17709b76693f693e2e"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"django-orm-best-practice"},"buildId":"Jh7yzD5faY7830085HB7W","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>